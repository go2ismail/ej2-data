/*!
*  filename: ej2-data.umd.min.js.map
*  version : 1.0.19
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/

{"version":3,"sources":["ej2-data.umd.js"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE_2__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","undefined","manager_1","query_1","adaptors_1","util_1","__export","hasOwnProperty","Object","defineProperty","value","apply","ej2_base_1","ej2_base_2","DataManager","dataSource","query","adaptor","_this","dateParse","requests","data","Array","json","offline","url","insertUrl","removeUrl","updateUrl","crudUrl","batchUrl","headers","accept","timeTillExpiration","cachingPageSize","enableCaching","requestType","key","crossDomain","jsonp","dataType","RemoteSaveAdaptor","requiresFormat","DataUtil","throwError","isCors","isNullOrUndefined","defaultQuery","length","isDataAvailable","ODataAdaptor","ready","executeQuery","Query","then","e","result","JsonAdaptor","CacheAdaptor","prototype","setDefaultQuery","executeLocal","processQuery","subQuery","from","fromTable","lookup","lookups","res","requiresCounts","buildHierarchy","fKey","j","extend","processResponse","using","slice","done","fail","always","deffered","Deferred","args","nextTick","getDeferedArgs","resolve","makeRequest","promise","count","aggregates","fn","window","setImmediate","setTimeout","extendRequest","fnSuccess","fnFail","type","cache","processData","onSuccess","onFailure","isSelector","subQuerySelector","error","reject","process","xhr","request","actual","virtualSelectRecords","parseInt","toString","fnQueryChild","selector","subDeffer","childArgs","parent","isChild","subUrl","childReq","subData","httpRequest","getResponseHeader","indexOf","parse","parseJson","virtualRecords","req","ajax","Ajax","beforeSend","send","push","Promise","all","_i","arguments","pResult","cResult","settings","props","keys","keys_1","prop","setRequestHeader","saveChanges","changes","tableName","batchRequest","deff","insert","position","replacer","doAjaxRequest","remove","keyField","update","defer","contentType","record","dataManager","bind","catch","consts","GroupGuid","getValue","inst","endsWith","input","substr","startsWith","start","fnSort","order","toLowerCase","fnAscending","fnDescending","x","y","localeCompare","extractFields","obj","fields","newObj","getObject","replace","select","jsonArray","newData","group","field","level","groupDs","jsonData","this_1","items","indx","temp","filter","childLevels","grouped","groupedArray","records","this_2","val","getVal","tempObj","aggs","source","pKey","grp","fKeyData","getFieldList","prefix","copyObj","nameSpace","splits","split","sort","ds","comparer","middle","left","right","merge","fieldName","current","shift","array","index","callAdaptorFunction","fnName","param1","param2","fnOperators","isnull","isPlainObject","constructor","getGuid","rand","crypto","arr","Uint8Array","getRandomValues","Math","random","isNull","getItemFromComparer","keyVal","castRequired","serverTimezoneOffset","Error","message","stack","sum","isNaN","average","min","max","truecount","where","falsecount","operatorSymbols","<",">","<=",">=","==","!=","*=","$=","^=","odBiOperator","lessthan","lessthanorequal","greaterthan","greaterthanorequal","equal","notequal","odUniOperator","endswith","startswith","contains","odv4UniOperator","expected","ignoreCase","notnull","processSymbols","operator","processOperator","jsonText","JSON","jsonReviver","iterateAndReviveArray","iterateAndReviveJson","test","keys_2","dupValue","ms","exec","jsonReplacer","Date","isJson","isGuid","stringify","arrayReplacer","keys_3","d","unixstamp","getTimezoneOffset","toJSON","date","queries","expands","sortedColumns","groupedColumns","params","setKey","execute","clone","cloned","addParams","expand","tables","predicate","Predicate","search","searchKey","fieldNames","sortBy","isFromGroup","sorts","filterQueries","direction","sortByDesc","page","pageIndex","pageSize","range","end","take","nos","skip","hierarchy","selectorFn","foreignKey","requiresCount","aggregate","name","q","filterQueryLists","singles","filtered","isComplex","condition","predicates","and","combinePredicates","combine","or","fromJson","len","fromJSONData","pred","validate","isAnd","ret","toJson","preds","__extends","extendStatics","setPrototypeOf","__proto__","b","__","create","Adaptor","options","pvt","_super","countFlg","agg","dm","addedRecords","changedRecords","deletedRecords","onWhere","onAggregates","onSearch","onSortBy","fnCompare","onGroup","aggQuery","tmp","onPage","size","onRange","onTake","onSkip","onSelect","splice","UrlAdaptor","hierarchyFilters","getQueryRequest","groups","filters","searches","getFiltersFrom","getRequestQuery","reqParams","_a","pvtData","convertToQueryString","request1","action","getAggregateResult","changed","added","deleted","table","keyColumn","predicats","pData","aggregateData","multipartAccept","batch","changeSet","batchPre","contentId","batchContent","changeSetContent","batchChangeSetContentType","getModuleName","onPredicate","requiresCast","guid","returnValue","getField","onComplexPredicate","onEachWhere","join","onEachSearch","onEachSort","reverse","onCount","overrideMimeType","dataCopy","results","emptyAndBatch","processBatchResponse","versionCheck","version","keys_4","initialGuid","cid","cSet","generateInsertRequest","generateUpdateRequest","generateDeleteRequest","stat","method","generateBodyContent","cIdx","jsonObj","substring","exVal","changeGuid","ODataV4Adaptor","getModulename","isDate","WebApiAdaptor","Count","Items","WebMethodAdaptor","param","setValue","timeStamp","isCrudAction","isInsertAction","cacheAdaptor","guidId","localStorage","setItem","setInterval","getItem","forDel","currentTime","requestTime","removeItem","generateKey","forEach","currentFilter","newQuery","cachedItems"],"mappings":"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","file":"ej2-data.umd.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@syncfusion/ej2-base\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@syncfusion/ej2-base\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@syncfusion/ej2-base\")) : factory(root[\"@syncfusion/ej2-base\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(1), __webpack_require__(4), __webpack_require__(5), __webpack_require__(3)], __WEBPACK_AMD_DEFINE_RESULT__ = function (require, exports, manager_1, query_1, adaptors_1, util_1) {\n\t    \"use strict\";\n\t    function __export(m) {\n\t        for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n\t    }\n\t    Object.defineProperty(exports, \"__esModule\", { value: true });\n\t    __export(manager_1);\n\t    __export(query_1);\n\t    __export(adaptors_1);\n\t    __export(util_1);\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(2), __webpack_require__(2), __webpack_require__(3), __webpack_require__(4), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (require, exports, ej2_base_1, ej2_base_2, util_1, query_1, adaptors_1) {\n\t    \"use strict\";\n\t    Object.defineProperty(exports, \"__esModule\", { value: true });\n\t    var DataManager = (function () {\n\t        function DataManager(dataSource, query, adaptor) {\n\t            var _this = this;\n\t            this.dateParse = true;\n\t            this.requests = [];\n\t            if (!dataSource && !this.dataSource) {\n\t                dataSource = [];\n\t            }\n\t            adaptor = adaptor || dataSource.adaptor;\n\t            var data;\n\t            if (dataSource instanceof Array) {\n\t                data = {\n\t                    json: dataSource,\n\t                    offline: true\n\t                };\n\t            }\n\t            else if (typeof dataSource === 'object') {\n\t                if (!dataSource.json) {\n\t                    dataSource.json = [];\n\t                }\n\t                data = {\n\t                    url: dataSource.url,\n\t                    insertUrl: dataSource.insertUrl,\n\t                    removeUrl: dataSource.removeUrl,\n\t                    updateUrl: dataSource.updateUrl,\n\t                    crudUrl: dataSource.crudUrl,\n\t                    batchUrl: dataSource.batchUrl,\n\t                    json: dataSource.json,\n\t                    headers: dataSource.headers,\n\t                    accept: dataSource.accept,\n\t                    data: dataSource.data,\n\t                    timeTillExpiration: dataSource.timeTillExpiration,\n\t                    cachingPageSize: dataSource.cachingPageSize,\n\t                    enableCaching: dataSource.enableCaching,\n\t                    requestType: dataSource.requestType,\n\t                    key: dataSource.key,\n\t                    crossDomain: dataSource.crossDomain,\n\t                    jsonp: dataSource.jsonp,\n\t                    dataType: dataSource.dataType,\n\t                    offline: dataSource.offline !== undefined ? dataSource.offline\n\t                        : dataSource.adaptor instanceof adaptors_1.RemoteSaveAdaptor ? false : dataSource.url ? false : true,\n\t                    requiresFormat: dataSource.requiresFormat\n\t                };\n\t            }\n\t            else {\n\t                util_1.DataUtil.throwError('DataManager: Invalid arguments');\n\t            }\n\t            if (data.requiresFormat === undefined && !util_1.DataUtil.isCors()) {\n\t                data.requiresFormat = ej2_base_2.isNullOrUndefined(data.crossDomain) ? true : data.crossDomain;\n\t            }\n\t            if (data.dataType === undefined) {\n\t                data.dataType = 'json';\n\t            }\n\t            this.dataSource = data;\n\t            this.defaultQuery = query;\n\t            if (data.url && data.offline && !data.json.length) {\n\t                this.isDataAvailable = false;\n\t                this.adaptor = adaptor || new adaptors_1.ODataAdaptor();\n\t                this.dataSource.offline = false;\n\t                this.ready = this.executeQuery(query || new query_1.Query());\n\t                this.ready.then(function (e) {\n\t                    _this.dataSource.offline = true;\n\t                    _this.isDataAvailable = true;\n\t                    data.json = e.result;\n\t                    _this.adaptor = new adaptors_1.JsonAdaptor();\n\t                });\n\t            }\n\t            else {\n\t                this.adaptor = data.offline ? new adaptors_1.JsonAdaptor() : new adaptors_1.ODataAdaptor();\n\t            }\n\t            if (!data.jsonp && this.adaptor instanceof adaptors_1.ODataAdaptor) {\n\t                data.jsonp = 'callback';\n\t            }\n\t            this.adaptor = adaptor || this.adaptor;\n\t            if (data.enableCaching) {\n\t                this.adaptor = new adaptors_1.CacheAdaptor(this.adaptor, data.timeTillExpiration, data.cachingPageSize);\n\t            }\n\t            return this;\n\t        }\n\t        DataManager.prototype.setDefaultQuery = function (query) {\n\t            this.defaultQuery = query;\n\t            return this;\n\t        };\n\t        DataManager.prototype.executeLocal = function (query) {\n\t            if (!this.defaultQuery && !(query instanceof query_1.Query)) {\n\t                util_1.DataUtil.throwError('DataManager - executeLocal() : A query is required to execute');\n\t            }\n\t            if (!this.dataSource.json) {\n\t                util_1.DataUtil.throwError('DataManager - executeLocal() : Json data is required to execute');\n\t            }\n\t            query = query || this.defaultQuery;\n\t            var result = this.adaptor.processQuery(this, query);\n\t            if (query.subQuery) {\n\t                var from = query.subQuery.fromTable;\n\t                var lookup = query.subQuery.lookups;\n\t                var res = query.requiresCounts ? result.result :\n\t                    result;\n\t                if (lookup && lookup instanceof Array) {\n\t                    util_1.DataUtil.buildHierarchy(query.subQuery.fKey, from, res, lookup, query.subQuery.key);\n\t                }\n\t                for (var j = 0; j < res.length; j++) {\n\t                    if (res[j][from] instanceof Array) {\n\t                        res[j] = ej2_base_2.extend({}, {}, res[j]);\n\t                        res[j][from] = this.adaptor.processResponse(query.subQuery.using(new DataManager(res[j][from].slice(0))).executeLocal(), this, query);\n\t                    }\n\t                }\n\t            }\n\t            return this.adaptor.processResponse(result, this, query);\n\t        };\n\t        DataManager.prototype.executeQuery = function (query, done, fail, always) {\n\t            var _this = this;\n\t            if (typeof query === 'function') {\n\t                always = fail;\n\t                fail = done;\n\t                done = query;\n\t                query = null;\n\t            }\n\t            if (!query) {\n\t                query = this.defaultQuery;\n\t            }\n\t            if (!(query instanceof query_1.Query)) {\n\t                util_1.DataUtil.throwError('DataManager - executeQuery() : A query is required to execute');\n\t            }\n\t            var deffered = new Deferred();\n\t            var args = { query: query };\n\t            if (!this.dataSource.offline && this.dataSource.url !== undefined) {\n\t                var result = this.adaptor.processQuery(this, query);\n\t                this.makeRequest(result, deffered, args, query);\n\t            }\n\t            else {\n\t                DataManager.nextTick(function () {\n\t                    var res = _this.executeLocal(query);\n\t                    args = DataManager.getDeferedArgs(query, res, args);\n\t                    deffered.resolve(args);\n\t                });\n\t            }\n\t            return deffered.promise;\n\t        };\n\t        DataManager.getDeferedArgs = function (query, result, args) {\n\t            if (query.requiresCounts) {\n\t                args.result = result.result;\n\t                args.count = result.count;\n\t                args.aggregates = result.aggregates;\n\t            }\n\t            else {\n\t                args.result = result;\n\t            }\n\t            return args;\n\t        };\n\t        DataManager.nextTick = function (fn) {\n\t            (window.setImmediate || window.setTimeout)(fn, 0);\n\t        };\n\t        DataManager.prototype.extendRequest = function (url, fnSuccess, fnFail) {\n\t            return ej2_base_2.extend({}, {\n\t                type: 'GET',\n\t                dataType: this.dataSource.dataType,\n\t                crossDomain: this.dataSource.crossDomain,\n\t                jsonp: this.dataSource.jsonp,\n\t                cache: true,\n\t                processData: false,\n\t                onSuccess: fnSuccess,\n\t                onFailure: fnFail\n\t            }, url);\n\t        };\n\t        DataManager.prototype.makeRequest = function (url, deffered, args, query) {\n\t            var _this = this;\n\t            var isSelector = !!query.subQuerySelector;\n\t            var fnFail = function (e) {\n\t                args.error = e;\n\t                deffered.reject(args);\n\t            };\n\t            var process = function (data, count, xhr, request, actual, aggregates, virtualSelectRecords) {\n\t                args.xhr = xhr;\n\t                args.count = count ? parseInt(count.toString(), 10) : 0;\n\t                args.result = data;\n\t                args.request = request;\n\t                args.aggregates = aggregates;\n\t                args.actual = actual;\n\t                args.virtualSelectRecords = virtualSelectRecords;\n\t                deffered.resolve(args);\n\t            };\n\t            var fnQueryChild = function (data, selector) {\n\t                var subDeffer = new Deferred();\n\t                var childArgs = { parent: args };\n\t                query.subQuery.isChild = true;\n\t                var subUrl = _this.adaptor.processQuery(_this, query.subQuery, data ? _this.adaptor.processResponse(data) : selector);\n\t                var childReq = _this.makeRequest(subUrl, subDeffer, childArgs, query.subQuery);\n\t                if (!isSelector) {\n\t                    subDeffer.then(function (subData) {\n\t                        if (data) {\n\t                            util_1.DataUtil.buildHierarchy(query.subQuery.fKey, query.subQuery.fromTable, data, subData, query.subQuery.key);\n\t                            process(data, subData.count, subData.xhr);\n\t                        }\n\t                    }, fnFail);\n\t                }\n\t                return childReq;\n\t            };\n\t            var fnSuccess = function (data, request) {\n\t                if (request.httpRequest.getResponseHeader('Content-Type').indexOf('xml') === -1 && _this.dateParse) {\n\t                    data = util_1.DataUtil.parse.parseJson(data);\n\t                }\n\t                var result = _this.adaptor.processResponse(data, _this, query, request.httpRequest, request);\n\t                var count = 0;\n\t                var aggregates = null;\n\t                var virtualSelectRecords = 'virtualSelectRecords';\n\t                var virtualRecords = data[virtualSelectRecords];\n\t                if (query.requiresCounts) {\n\t                    count = result.count;\n\t                    aggregates = result.aggregates;\n\t                    result = result.result;\n\t                }\n\t                if (!query.subQuery) {\n\t                    process(result, count, request.httpRequest, request.type, data, aggregates, virtualRecords);\n\t                    return;\n\t                }\n\t                if (!isSelector) {\n\t                    fnQueryChild(result, request);\n\t                }\n\t            };\n\t            var req = this.extendRequest(url, fnSuccess, fnFail);\n\t            var ajax = new ej2_base_1.Ajax(req);\n\t            ajax.beforeSend = function () {\n\t                _this.beforeSend(ajax.httpRequest, ajax);\n\t            };\n\t            req = ajax.send();\n\t            this.requests.push(ajax);\n\t            if (isSelector) {\n\t                var promise = void 0;\n\t                var res = query.subQuerySelector.call(this, { query: query.subQuery, parent: query });\n\t                if (res && res.length) {\n\t                    promise = Promise.all([req, fnQueryChild(null, res)]);\n\t                    promise.then(function () {\n\t                        var args = [];\n\t                        for (var _i = 0; _i < arguments.length; _i++) {\n\t                            args[_i] = arguments[_i];\n\t                        }\n\t                        var result = args[0];\n\t                        var pResult = _this.adaptor.processResponse(result[0], _this, query, _this.requests[0].httpRequest, _this.requests[0]);\n\t                        var count = 0;\n\t                        if (query.requiresCounts) {\n\t                            count = pResult.count;\n\t                            pResult = pResult.result;\n\t                        }\n\t                        var cResult = _this.adaptor.processResponse(result[1], _this, query.subQuery, _this.requests[1].httpRequest, _this.requests[1]);\n\t                        count = 0;\n\t                        if (query.subQuery.requiresCounts) {\n\t                            count = cResult.count;\n\t                            cResult = cResult.result;\n\t                        }\n\t                        util_1.DataUtil.buildHierarchy(query.subQuery.fKey, query.subQuery.fromTable, pResult, cResult, query.subQuery.key);\n\t                        isSelector = false;\n\t                        process(pResult, count, _this.requests[0].httpRequest);\n\t                    });\n\t                }\n\t                else {\n\t                    isSelector = false;\n\t                }\n\t            }\n\t            return req;\n\t        };\n\t        DataManager.prototype.beforeSend = function (request, settings) {\n\t            this.adaptor.beforeSend(this, request, settings);\n\t            var headers = this.dataSource.headers;\n\t            var props;\n\t            for (var i = 0; headers && i < headers.length; i++) {\n\t                props = [];\n\t                var keys = Object.keys(headers[i]);\n\t                for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n\t                    var prop = keys_1[_i];\n\t                    props.push(prop);\n\t                    request.setRequestHeader(prop, headers[i][prop]);\n\t                }\n\t            }\n\t        };\n\t        DataManager.prototype.saveChanges = function (changes, key, tableName, query) {\n\t            var _this = this;\n\t            if (tableName instanceof query_1.Query) {\n\t                query = tableName;\n\t                tableName = null;\n\t            }\n\t            var args = {\n\t                url: tableName,\n\t                key: key || this.dataSource.key\n\t            };\n\t            var req = this.adaptor.batchRequest(this, changes, args, query);\n\t            if (this.dataSource.offline) {\n\t                return req;\n\t            }\n\t            var deff = new Deferred();\n\t            var ajax = new ej2_base_1.Ajax(req);\n\t            ajax.beforeSend = function () {\n\t                _this.beforeSend(ajax.httpRequest, ajax);\n\t            };\n\t            ajax.onSuccess = function (data, request) {\n\t                deff.resolve(_this, [_this.adaptor.processResponse(data, _this, null, request.httpRequest, request, changes)]);\n\t            };\n\t            ajax.onFailure = function (e) {\n\t                deff.reject([{ error: e }]);\n\t            };\n\t            ajax.send();\n\t            return deff.promise;\n\t        };\n\t        DataManager.prototype.insert = function (data, tableName, query, position) {\n\t            data = util_1.DataUtil.parse.replacer(data);\n\t            if (tableName instanceof query_1.Query) {\n\t                query = tableName;\n\t                tableName = null;\n\t            }\n\t            var req = this.adaptor.insert(this, data, tableName, query, position);\n\t            if (this.dataSource.offline) {\n\t                return req;\n\t            }\n\t            return this.doAjaxRequest(req);\n\t        };\n\t        DataManager.prototype.remove = function (keyField, value, tableName, query) {\n\t            if (typeof value === 'object') {\n\t                value = value[keyField];\n\t            }\n\t            if (tableName instanceof query_1.Query) {\n\t                query = tableName;\n\t                tableName = null;\n\t            }\n\t            var res = this.adaptor.remove(this, keyField, value, tableName, query);\n\t            if (this.dataSource.offline) {\n\t                return res;\n\t            }\n\t            return this.doAjaxRequest(res);\n\t        };\n\t        DataManager.prototype.update = function (keyField, value, tableName, query) {\n\t            value = util_1.DataUtil.parse.replacer(value, !this.dataSource.offline);\n\t            if (tableName instanceof query_1.Query) {\n\t                query = tableName;\n\t                tableName = null;\n\t            }\n\t            var res = this.adaptor.update(this, keyField, value, tableName, query);\n\t            if (this.dataSource.offline) {\n\t                return res;\n\t            }\n\t            return this.doAjaxRequest(res);\n\t        };\n\t        DataManager.prototype.doAjaxRequest = function (res) {\n\t            var _this = this;\n\t            var defer = new Deferred();\n\t            res = ej2_base_2.extend({}, {\n\t                type: 'POST',\n\t                contentType: 'application/json; charset=utf-8',\n\t                processData: false\n\t            }, res);\n\t            var ajax = new ej2_base_1.Ajax(res);\n\t            ajax.beforeSend = function () {\n\t                _this.beforeSend(ajax.httpRequest, ajax);\n\t            };\n\t            ajax.onSuccess = function (record, request) {\n\t                try {\n\t                    util_1.DataUtil.parse.parseJson(record);\n\t                }\n\t                catch (e) {\n\t                    record = [];\n\t                }\n\t                record = _this.adaptor.processResponse(util_1.DataUtil.parse.parseJson(record), _this, null, request.httpRequest, request);\n\t                defer.resolve(_this, [{ record: record, dataManager: _this }]);\n\t            };\n\t            ajax.onFailure = function (e) {\n\t                defer.reject([{ error: e }]);\n\t            };\n\t            ajax.send();\n\t            return defer.promise;\n\t        };\n\t        return DataManager;\n\t    }());\n\t    exports.DataManager = DataManager;\n\t    var Deferred = (function () {\n\t        function Deferred() {\n\t            var _this = this;\n\t            this.promise = new Promise(function (resolve, reject) {\n\t                _this.resolve = resolve;\n\t                _this.reject = reject;\n\t            });\n\t            this.then = this.promise.then.bind(this.promise);\n\t            this.catch = this.promise.catch.bind(this.promise);\n\t        }\n\t        return Deferred;\n\t    }());\n\t    exports.Deferred = Deferred;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (require, exports, ej2_base_1, manager_1, query_1) {\n\t    \"use strict\";\n\t    Object.defineProperty(exports, \"__esModule\", { value: true });\n\t    var consts = { GroupGuid: '{271bbba0-1ee7}' };\n\t    var DataUtil = (function () {\n\t        function DataUtil() {\n\t        }\n\t        DataUtil.getValue = function (value, inst) {\n\t            if (typeof value === 'function') {\n\t                return value.call(inst || {});\n\t            }\n\t            return value;\n\t        };\n\t        DataUtil.endsWith = function (input, substr) {\n\t            return input.slice(-substr.length) === substr;\n\t        };\n\t        DataUtil.startsWith = function (input, start) {\n\t            return input.slice(0, start.length) === start;\n\t        };\n\t        DataUtil.fnSort = function (order) {\n\t            order = order ? order.toLowerCase() : 'ascending';\n\t            if (order === 'ascending') {\n\t                return this.fnAscending;\n\t            }\n\t            return this.fnDescending;\n\t        };\n\t        DataUtil.fnAscending = function (x, y) {\n\t            if (y === null || y === undefined) {\n\t                return -1;\n\t            }\n\t            if (typeof x === 'string') {\n\t                return x.localeCompare(y);\n\t            }\n\t            if (x === null || x === undefined) {\n\t                return 1;\n\t            }\n\t            return x - y;\n\t        };\n\t        DataUtil.fnDescending = function (x, y) {\n\t            if (y === null || y === undefined) {\n\t                return 1;\n\t            }\n\t            if (typeof x === 'string') {\n\t                return x.localeCompare(y) * -1;\n\t            }\n\t            if (x === null || x === undefined) {\n\t                return -1;\n\t            }\n\t            return y - x;\n\t        };\n\t        DataUtil.extractFields = function (obj, fields) {\n\t            var newObj = {};\n\t            if (fields.length === 1) {\n\t                return this.getObject(fields[0], obj);\n\t            }\n\t            for (var i = 0; i < fields.length; i++) {\n\t                newObj[fields[i].replace('.', '_')] = this.getObject(fields[i], obj);\n\t            }\n\t            return newObj;\n\t        };\n\t        DataUtil.select = function (jsonArray, fields) {\n\t            var newData = [];\n\t            for (var i = 0; i < jsonArray.length; i++) {\n\t                newData.push(this.extractFields(jsonArray[i], fields));\n\t            }\n\t            return newData;\n\t        };\n\t        DataUtil.group = function (jsonArray, field, aggregates, level, groupDs) {\n\t            level = level || 1;\n\t            var jsonData = jsonArray;\n\t            var guid = 'GroupGuid';\n\t            if (jsonData.GroupGuid === consts[guid]) {\n\t                var _loop_1 = function (j) {\n\t                    if (!ej2_base_1.isNullOrUndefined(groupDs)) {\n\t                        var indx = -1;\n\t                        var temp = groupDs.filter(function (e) { return e.key === jsonData[j].key; });\n\t                        indx = groupDs.indexOf(temp[0]);\n\t                        jsonData[j].items = this_1.group(jsonData[j].items, field, aggregates, jsonData.level + 1, groupDs[indx].items);\n\t                        jsonData[j].count = groupDs[indx].count;\n\t                    }\n\t                    else {\n\t                        jsonData[j].items = this_1.group(jsonData[j].items, field, aggregates, jsonData.level + 1);\n\t                        jsonData[j].count = jsonData[j].items.length;\n\t                    }\n\t                };\n\t                var this_1 = this;\n\t                for (var j = 0; j < jsonData.length; j++) {\n\t                    _loop_1(j);\n\t                }\n\t                jsonData.childLevels += 1;\n\t                return jsonData;\n\t            }\n\t            var grouped = {};\n\t            var groupedArray = [];\n\t            groupedArray.GroupGuid = consts[guid];\n\t            groupedArray.level = level;\n\t            groupedArray.childLevels = 0;\n\t            groupedArray.records = jsonData;\n\t            var _loop_2 = function (i) {\n\t                var val = this_2.getVal(jsonData, i, field);\n\t                if (!grouped[val]) {\n\t                    grouped[val] = {\n\t                        key: val,\n\t                        count: 0,\n\t                        items: [],\n\t                        aggregates: {},\n\t                        field: field\n\t                    };\n\t                    groupedArray.push(grouped[val]);\n\t                    if (!ej2_base_1.isNullOrUndefined(groupDs)) {\n\t                        var tempObj = groupDs.filter(function (e) { return e.key === grouped[val].key; });\n\t                        grouped[val].count = tempObj[0].count;\n\t                    }\n\t                }\n\t                grouped[val].count = !ej2_base_1.isNullOrUndefined(groupDs) ? grouped[val].count : grouped[val].count += 1;\n\t                grouped[val].items.push(jsonData[i]);\n\t            };\n\t            var this_2 = this;\n\t            for (var i = 0; i < jsonData.length; i++) {\n\t                _loop_2(i);\n\t            }\n\t            if (aggregates && aggregates.length) {\n\t                var _loop_3 = function (i) {\n\t                    var res = {};\n\t                    var fn = void 0;\n\t                    var aggs = aggregates;\n\t                    for (var j = 0; j < aggregates.length; j++) {\n\t                        fn = DataUtil.aggregates[aggregates[j].type];\n\t                        if (!ej2_base_1.isNullOrUndefined(groupDs)) {\n\t                            var temp = groupDs.filter(function (e) { return e.key === groupedArray[i].key; });\n\t                            if (fn) {\n\t                                res[aggs[j].field + ' - ' + aggs[j].type] = fn(temp[0].items, aggs[j].field);\n\t                            }\n\t                        }\n\t                        else {\n\t                            if (fn) {\n\t                                res[aggs[j].field + ' - ' + aggs[j].type] = fn(groupedArray[i].items, aggs[j].field);\n\t                            }\n\t                        }\n\t                    }\n\t                    groupedArray[i].aggregates = res;\n\t                };\n\t                for (var i = 0; i < groupedArray.length; i++) {\n\t                    _loop_3(i);\n\t                }\n\t            }\n\t            return groupedArray;\n\t        };\n\t        DataUtil.buildHierarchy = function (fKey, from, source, lookup, pKey) {\n\t            var i;\n\t            var grp = {};\n\t            var temp;\n\t            if (lookup.result) {\n\t                lookup = lookup.result;\n\t            }\n\t            if (lookup.GroupGuid) {\n\t                this.throwError('DataManager: Do not have support Grouping in hierarchy');\n\t            }\n\t            for (i = 0; i < lookup.length; i++) {\n\t                var fKeyData = this.getObject(fKey, lookup[i]);\n\t                temp = grp[fKeyData] || (grp[fKeyData] = []);\n\t                temp.push(lookup[i]);\n\t            }\n\t            for (i = 0; i < source.length; i++) {\n\t                var fKeyData = this.getObject(pKey || fKey, source[i]);\n\t                source[i][from] = grp[fKeyData];\n\t            }\n\t        };\n\t        DataUtil.getFieldList = function (obj, fields, prefix) {\n\t            if (prefix === undefined) {\n\t                prefix = '';\n\t            }\n\t            if (fields === undefined || fields === null) {\n\t                return this.getFieldList(obj, [], prefix);\n\t            }\n\t            var copyObj = obj;\n\t            var keys = Object.keys(obj);\n\t            for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n\t                var prop = keys_1[_i];\n\t                if (typeof copyObj[prop] === 'object' && !(copyObj[prop] instanceof Array)) {\n\t                    this.getFieldList(copyObj[prop], fields, prefix + prop + '.');\n\t                }\n\t                else {\n\t                    fields.push(prefix + prop);\n\t                }\n\t            }\n\t            return fields;\n\t        };\n\t        DataUtil.getObject = function (nameSpace, from) {\n\t            if (!nameSpace) {\n\t                return from;\n\t            }\n\t            if (nameSpace.indexOf('.') === -1) {\n\t                return from[nameSpace];\n\t            }\n\t            var value = from;\n\t            var splits = nameSpace.split('.');\n\t            for (var i = 0; i < splits.length; i++) {\n\t                if (value == null) {\n\t                    break;\n\t                }\n\t                value = value[splits[i]];\n\t            }\n\t            return value;\n\t        };\n\t        DataUtil.sort = function (ds, field, comparer) {\n\t            if (ds.length <= 1) {\n\t                return ds;\n\t            }\n\t            var middle = parseInt((ds.length / 2).toString(), 10);\n\t            var left = ds.slice(0, middle);\n\t            var right = ds.slice(middle);\n\t            left = this.sort(left, field, comparer);\n\t            right = this.sort(right, field, comparer);\n\t            return this.merge(left, right, field, comparer);\n\t        };\n\t        DataUtil.merge = function (left, right, fieldName, comparer) {\n\t            var result = [];\n\t            var current;\n\t            while (left.length > 0 || right.length > 0) {\n\t                if (left.length > 0 && right.length > 0) {\n\t                    if (comparer) {\n\t                        current = comparer(this.getVal(left, 0, fieldName), this.getVal(right, 0, fieldName)) <= 0 ? left : right;\n\t                    }\n\t                    else {\n\t                        current = left[0][fieldName] < left[0][fieldName] ? left : right;\n\t                    }\n\t                }\n\t                else {\n\t                    current = left.length > 0 ? left : right;\n\t                }\n\t                result.push(current.shift());\n\t            }\n\t            return result;\n\t        };\n\t        DataUtil.getVal = function (array, index, field) {\n\t            return field ? this.getObject(field, array[index]) : array[index];\n\t        };\n\t        DataUtil.toLowerCase = function (val) {\n\t            return val ? typeof val === 'string' ? val.toLowerCase() : val.toString() : (val === 0 || val === false) ? val.toString() : '';\n\t        };\n\t        DataUtil.callAdaptorFunction = function (adaptor, fnName, param1, param2) {\n\t            if (fnName in adaptor) {\n\t                var res = adaptor[fnName](param1, param2);\n\t                if (!this.fnOperators.isnull(res)) {\n\t                    param1 = res;\n\t                }\n\t            }\n\t            return param1;\n\t        };\n\t        DataUtil.isPlainObject = function (obj) {\n\t            return (!!obj) && (obj.constructor === Object);\n\t        };\n\t        DataUtil.isCors = function () {\n\t            var xhr = null;\n\t            var request = 'XMLHttpRequest';\n\t            try {\n\t                xhr = new window[request]();\n\t            }\n\t            catch (e) {\n\t            }\n\t            return !!xhr && ('withCredentials' in xhr);\n\t        };\n\t        DataUtil.getGuid = function (prefix) {\n\t            var hexs = '0123456789abcdef';\n\t            var rand;\n\t            return (prefix || '') + '00000000-0000-4000-0000-000000000000'.replace(/0/g, function (val, i) {\n\t                if ('crypto' in window && 'getRandomValues' in crypto) {\n\t                    var arr = new Uint8Array(1);\n\t                    window.crypto.getRandomValues(arr);\n\t                    rand = arr[0] % 16 | 0;\n\t                }\n\t                else {\n\t                    rand = Math.random() * 16 | 0;\n\t                }\n\t                return hexs[i === 19 ? rand & 0x3 | 0x8 : rand];\n\t            });\n\t        };\n\t        DataUtil.isNull = function (val) {\n\t            return val === undefined || val === null;\n\t        };\n\t        DataUtil.getItemFromComparer = function (array, field, comparer) {\n\t            var keyVal;\n\t            var current;\n\t            var key;\n\t            var i = 0;\n\t            var castRequired = typeof DataUtil.getVal(array, 0, field) === 'string';\n\t            if (array.length) {\n\t                while (ej2_base_1.isNullOrUndefined(keyVal) && i < array.length) {\n\t                    keyVal = DataUtil.getVal(array, i, field);\n\t                    key = array[i++];\n\t                }\n\t            }\n\t            for (; i < array.length; i++) {\n\t                current = DataUtil.getVal(array, i, field);\n\t                if (ej2_base_1.isNullOrUndefined(current)) {\n\t                    continue;\n\t                }\n\t                if (castRequired) {\n\t                    keyVal = +keyVal;\n\t                    current = +current;\n\t                }\n\t                if (comparer(keyVal, current) > 0) {\n\t                    keyVal = current;\n\t                    key = array[i];\n\t                }\n\t            }\n\t            return key;\n\t        };\n\t        return DataUtil;\n\t    }());\n\t    DataUtil.serverTimezoneOffset = 0;\n\t    DataUtil.throwError = function (error) {\n\t        try {\n\t            throw new Error(error);\n\t        }\n\t        catch (e) {\n\t            throw e.message + '\\n' + e.stack;\n\t        }\n\t    };\n\t    DataUtil.aggregates = {\n\t        sum: function (ds, field) {\n\t            var result = 0;\n\t            var val;\n\t            var castRequired = typeof DataUtil.getVal(ds, 0, field) !== 'number';\n\t            for (var i = 0; i < ds.length; i++) {\n\t                val = DataUtil.getVal(ds, i, field);\n\t                if (!isNaN(val) && val !== null) {\n\t                    if (castRequired) {\n\t                        val = +val;\n\t                    }\n\t                    result += val;\n\t                }\n\t            }\n\t            return result;\n\t        },\n\t        average: function (ds, field) {\n\t            return DataUtil.aggregates.sum(ds, field) / ds.length;\n\t        },\n\t        min: function (ds, field) {\n\t            var comparer;\n\t            if (typeof field === 'function') {\n\t                comparer = field;\n\t                field = null;\n\t            }\n\t            return DataUtil.getObject(field, DataUtil.getItemFromComparer(ds, field, comparer || DataUtil.fnAscending));\n\t        },\n\t        max: function (ds, field) {\n\t            var comparer;\n\t            if (typeof field === 'function') {\n\t                comparer = field;\n\t                field = null;\n\t            }\n\t            return DataUtil.getObject(field, DataUtil.getItemFromComparer(ds, field, comparer || DataUtil.fnDescending));\n\t        },\n\t        truecount: function (ds, field) {\n\t            return new manager_1.DataManager(ds).executeLocal(new query_1.Query().where(field, 'equal', true, true)).length;\n\t        },\n\t        falsecount: function (ds, field) {\n\t            return new manager_1.DataManager(ds).executeLocal(new query_1.Query().where(field, 'equal', false, true)).length;\n\t        },\n\t        count: function (ds, field) {\n\t            return ds.length;\n\t        }\n\t    };\n\t    DataUtil.operatorSymbols = {\n\t        '<': 'lessthan',\n\t        '>': 'greaterthan',\n\t        '<=': 'lessthanorequal',\n\t        '>=': 'greaterthanorequal',\n\t        '==': 'equal',\n\t        '!=': 'notequal',\n\t        '*=': 'contains',\n\t        '$=': 'endswith',\n\t        '^=': 'startswith'\n\t    };\n\t    DataUtil.odBiOperator = {\n\t        '<': ' lt ',\n\t        '>': ' gt ',\n\t        '<=': ' le ',\n\t        '>=': ' ge ',\n\t        '==': ' eq ',\n\t        '!=': ' ne ',\n\t        'lessthan': ' lt ',\n\t        'lessthanorequal': ' le ',\n\t        'greaterthan': ' gt ',\n\t        'greaterthanorequal': ' ge ',\n\t        'equal': ' eq ',\n\t        'notequal': ' ne '\n\t    };\n\t    DataUtil.odUniOperator = {\n\t        '$=': 'endswith',\n\t        '^=': 'startswith',\n\t        '*=': 'substringof',\n\t        'endswith': 'endswith',\n\t        'startswith': 'startswith',\n\t        'contains': 'substringof'\n\t    };\n\t    DataUtil.odv4UniOperator = {\n\t        '$=': 'endswith',\n\t        '^=': 'startswith',\n\t        '*=': 'contains',\n\t        'endswith': 'endswith',\n\t        'startswith': 'startswith',\n\t        'contains': 'contains'\n\t    };\n\t    DataUtil.fnOperators = {\n\t        equal: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return DataUtil.toLowerCase(actual) === DataUtil.toLowerCase(expected);\n\t            }\n\t            return actual === expected;\n\t        },\n\t        notequal: function (actual, expected, ignoreCase) {\n\t            return !DataUtil.fnOperators.equal(actual, expected, ignoreCase);\n\t        },\n\t        lessthan: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return DataUtil.toLowerCase(actual) < DataUtil.toLowerCase(expected);\n\t            }\n\t            return actual < expected;\n\t        },\n\t        greaterthan: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return DataUtil.toLowerCase(actual) > DataUtil.toLowerCase(expected);\n\t            }\n\t            return actual > expected;\n\t        },\n\t        lessthanorequal: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return DataUtil.toLowerCase(actual) <= DataUtil.toLowerCase(expected);\n\t            }\n\t            return actual <= expected;\n\t        },\n\t        greaterthanorequal: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return DataUtil.toLowerCase(actual) >= DataUtil.toLowerCase(expected);\n\t            }\n\t            return actual >= expected;\n\t        },\n\t        contains: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return !ej2_base_1.isNullOrUndefined(actual) && !ej2_base_1.isNullOrUndefined(expected) &&\n\t                    DataUtil.toLowerCase(actual).indexOf(DataUtil.toLowerCase(expected)) !== -1;\n\t            }\n\t            return !ej2_base_1.isNullOrUndefined(actual) && !ej2_base_1.isNullOrUndefined(expected) &&\n\t                actual.toString().indexOf(expected) !== -1;\n\t        },\n\t        notnull: function (actual) {\n\t            return actual !== null;\n\t        },\n\t        isnull: function (actual) {\n\t            return actual === null;\n\t        },\n\t        startswith: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return actual && expected && DataUtil.startsWith(actual.toLowerCase(), expected.toLowerCase());\n\t            }\n\t            return actual && expected && DataUtil.startsWith(actual, expected);\n\t        },\n\t        endswith: function (actual, expected, ignoreCase) {\n\t            if (ignoreCase) {\n\t                return actual && expected && DataUtil.endsWith(actual.toLowerCase(), expected.toLowerCase());\n\t            }\n\t            return actual && expected && DataUtil.endsWith(actual, expected);\n\t        },\n\t        processSymbols: function (operator) {\n\t            var fnName = DataUtil.operatorSymbols[operator];\n\t            if (fnName) {\n\t                var fn = DataUtil.fnOperators[fnName];\n\t                return fn;\n\t            }\n\t            return DataUtil.throwError('Query - Process Operator : Invalid operator');\n\t        },\n\t        processOperator: function (operator) {\n\t            var fn = DataUtil.fnOperators[operator];\n\t            if (fn) {\n\t                return fn;\n\t            }\n\t            return DataUtil.fnOperators.processSymbols(operator);\n\t        }\n\t    };\n\t    DataUtil.parse = {\n\t        parseJson: function (jsonText) {\n\t            if (typeof jsonText === 'string') {\n\t                jsonText = JSON.parse(jsonText, DataUtil.parse.jsonReviver);\n\t            }\n\t            else if (jsonText instanceof Array) {\n\t                DataUtil.parse.iterateAndReviveArray(jsonText);\n\t            }\n\t            else if (typeof jsonText === 'object') {\n\t                DataUtil.parse.iterateAndReviveJson(jsonText);\n\t            }\n\t            return jsonText;\n\t        },\n\t        iterateAndReviveArray: function (array) {\n\t            for (var i = 0; i < array.length; i++) {\n\t                if (typeof array[i] === 'object') {\n\t                    DataUtil.parse.iterateAndReviveJson(array[i]);\n\t                }\n\t                else if (typeof array[i] === 'string' && !/^[\\s]*\\[|^[\\s]*\\{|\\\"/g.test(array[i])) {\n\t                    array[i] = DataUtil.parse.jsonReviver('', array[i]);\n\t                }\n\t                else {\n\t                    array[i] = DataUtil.parse.parseJson(array[i]);\n\t                }\n\t            }\n\t        },\n\t        iterateAndReviveJson: function (json) {\n\t            var value;\n\t            var keys = Object.keys(json);\n\t            for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\n\t                var prop = keys_2[_i];\n\t                if (DataUtil.startsWith(prop, '__')) {\n\t                    continue;\n\t                }\n\t                value = json[prop];\n\t                if (typeof value === 'object') {\n\t                    if (value instanceof Array) {\n\t                        DataUtil.parse.iterateAndReviveArray(value);\n\t                    }\n\t                    else if (value) {\n\t                        DataUtil.parse.iterateAndReviveJson(value);\n\t                    }\n\t                }\n\t                else {\n\t                    json[prop] = DataUtil.parse.jsonReviver(json[prop], value);\n\t                }\n\t            }\n\t        },\n\t        jsonReviver: function (field, value) {\n\t            var dupValue = value;\n\t            if (typeof value === 'string') {\n\t                var ms = /^\\/Date\\(([+-]?[0-9]+)([+-][0-9]{4})?\\)\\/$/.exec(value);\n\t                if (ms) {\n\t                    return DataUtil.parse.jsonReplacer({ value: new Date(parseInt(ms[1], 10)) }, false).value;\n\t                }\n\t                else if (/^(\\d{4}\\-\\d\\d\\-\\d\\d([tT][\\d:\\.]*){1})([zZ]|([+\\-])(\\d\\d):?(\\d\\d))?$/.test(value)) {\n\t                    var arr = dupValue.split(/[^0-9]/);\n\t                    value = DataUtil.parse.jsonReplacer({\n\t                        value: new Date(parseInt(arr[0], 10), parseInt(arr[1], 10) - 1, parseInt(arr[2], 10), parseInt(arr[3], 10), parseInt(arr[4], 10), parseInt(arr[5], 10))\n\t                    }, false).value;\n\t                }\n\t            }\n\t            return value;\n\t        },\n\t        isJson: function (jsonData) {\n\t            if (typeof jsonData[0] === 'string') {\n\t                return jsonData;\n\t            }\n\t            return DataUtil.parse.parseJson(jsonData);\n\t        },\n\t        isGuid: function (value) {\n\t            var regex = /[A-Fa-f0-9]{8}(?:-[A-Fa-f0-9]{4}){3}-[A-Fa-f0-9]{12}/i;\n\t            var match = regex.exec(value);\n\t            return match != null;\n\t        },\n\t        replacer: function (value, stringify) {\n\t            if (DataUtil.isPlainObject(value)) {\n\t                return DataUtil.parse.jsonReplacer(value, stringify);\n\t            }\n\t            if (value instanceof Array) {\n\t                return DataUtil.parse.arrayReplacer(value);\n\t            }\n\t            if (value instanceof Date) {\n\t                return DataUtil.parse.jsonReplacer({ val: value }, stringify).val;\n\t            }\n\t            return value;\n\t        },\n\t        jsonReplacer: function (val, stringify) {\n\t            if (stringify === void 0) { stringify = true; }\n\t            var value;\n\t            var keys = Object.keys(val);\n\t            for (var _i = 0, keys_3 = keys; _i < keys_3.length; _i++) {\n\t                var prop = keys_3[_i];\n\t                value = val[prop];\n\t                if (!(value instanceof Date)) {\n\t                    continue;\n\t                }\n\t                var d = value;\n\t                var unixstamp = +d - (d.getTimezoneOffset() * 60000);\n\t                val[prop] = new Date(unixstamp - (DataUtil.serverTimezoneOffset * 3600000));\n\t                if (stringify) {\n\t                    val[prop] = val[prop].toJSON();\n\t                }\n\t            }\n\t            return val;\n\t        },\n\t        arrayReplacer: function (val) {\n\t            for (var i = 0; i < val.length; i++) {\n\t                if (DataUtil.isPlainObject(val[i])) {\n\t                    val[i] = DataUtil.parse.jsonReplacer(val[i]);\n\t                }\n\t                else if (val[i] instanceof Date) {\n\t                    val[i] = DataUtil.parse.jsonReplacer({ date: val[i] }).date;\n\t                }\n\t            }\n\t            return val;\n\t        }\n\t    };\n\t    exports.DataUtil = DataUtil;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(3)], __WEBPACK_AMD_DEFINE_RESULT__ = function (require, exports, util_1) {\n\t    \"use strict\";\n\t    Object.defineProperty(exports, \"__esModule\", { value: true });\n\t    var Query = (function () {\n\t        function Query(from) {\n\t            this.subQuery = null;\n\t            this.isChild = false;\n\t            this.queries = [];\n\t            this.key = '';\n\t            this.fKey = '';\n\t            if (typeof from === 'string') {\n\t                this.fromTable = from;\n\t            }\n\t            else if (from && from instanceof Array) {\n\t                this.lookups = from;\n\t            }\n\t            this.expands = [];\n\t            this.sortedColumns = [];\n\t            this.groupedColumns = [];\n\t            this.subQuery = null;\n\t            this.isChild = false;\n\t            this.params = [];\n\t            return this;\n\t        }\n\t        Query.prototype.setKey = function (field) {\n\t            this.key = field;\n\t            return this;\n\t        };\n\t        Query.prototype.using = function (dataManager) {\n\t            this.dataManager = dataManager;\n\t            return this;\n\t        };\n\t        Query.prototype.execute = function (dataManager, done, fail, always) {\n\t            dataManager = dataManager || this.dataManager;\n\t            if (dataManager) {\n\t                return dataManager.executeQuery(this, done, fail, always);\n\t            }\n\t            return util_1.DataUtil.throwError('Query - execute() : dataManager needs to be is set using \"using\" function or should be passed as argument');\n\t        };\n\t        Query.prototype.executeLocal = function (dataManager) {\n\t            dataManager = dataManager || this.dataManager;\n\t            if (dataManager) {\n\t                return dataManager.executeLocal(this);\n\t            }\n\t            return util_1.DataUtil.throwError('Query - executeLocal() : dataManager needs to be is set using \"using\" function or should be passed as argument');\n\t        };\n\t        Query.prototype.clone = function () {\n\t            var cloned = new Query();\n\t            cloned.queries = this.queries.slice(0);\n\t            cloned.key = this.key;\n\t            cloned.isChild = this.isChild;\n\t            cloned.dataManager = this.dataManager;\n\t            cloned.fromTable = this.fromTable;\n\t            cloned.params = this.params.slice(0);\n\t            cloned.expands = this.expands.slice(0);\n\t            cloned.sortedColumns = this.sortedColumns.slice(0);\n\t            cloned.groupedColumns = this.groupedColumns.slice(0);\n\t            cloned.subQuerySelector = this.subQuerySelector;\n\t            cloned.subQuery = this.subQuery;\n\t            cloned.fKey = this.fKey;\n\t            cloned.requiresCounts = this.requiresCounts;\n\t            return cloned;\n\t        };\n\t        Query.prototype.from = function (tableName) {\n\t            this.fromTable = tableName;\n\t            return this;\n\t        };\n\t        Query.prototype.addParams = function (key, value) {\n\t            if (typeof value === 'function') {\n\t                this.params.push({ key: key, fn: value });\n\t            }\n\t            else {\n\t                this.params.push({ key: key, value: value });\n\t            }\n\t            return this;\n\t        };\n\t        Query.prototype.expand = function (tables) {\n\t            if (typeof tables === 'string') {\n\t                this.expands = [].slice.call([tables], 0);\n\t            }\n\t            else {\n\t                this.expands = tables.slice(0);\n\t            }\n\t            return this;\n\t        };\n\t        Query.prototype.where = function (fieldName, operator, value, ignoreCase) {\n\t            operator = operator ? (operator).toLowerCase() : null;\n\t            var predicate = null;\n\t            if (typeof fieldName === 'string') {\n\t                predicate = new Predicate(fieldName, operator, value, ignoreCase);\n\t            }\n\t            else if (fieldName instanceof Predicate) {\n\t                predicate = fieldName;\n\t            }\n\t            this.queries.push({\n\t                fn: 'onWhere',\n\t                e: predicate\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.search = function (searchKey, fieldNames, operator, ignoreCase) {\n\t            if (typeof fieldNames === 'string') {\n\t                fieldNames = [fieldNames];\n\t            }\n\t            operator = operator || 'contains';\n\t            var comparer = util_1.DataUtil.fnOperators[operator];\n\t            this.queries.push({\n\t                fn: 'onSearch',\n\t                e: {\n\t                    fieldNames: fieldNames,\n\t                    operator: operator,\n\t                    searchKey: searchKey,\n\t                    ignoreCase: ignoreCase,\n\t                    comparer: comparer\n\t                }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.sortBy = function (fieldName, comparer, isFromGroup) {\n\t            var order = 'ascending';\n\t            var sorts;\n\t            var temp;\n\t            if (typeof fieldName === 'string' && util_1.DataUtil.endsWith(fieldName.toLowerCase(), ' desc')) {\n\t                fieldName = fieldName.replace(/ desc$/i, '');\n\t                comparer = 'descending';\n\t            }\n\t            if (!comparer || typeof comparer === 'string') {\n\t                order = comparer ? comparer.toLowerCase() : 'ascending';\n\t                comparer = util_1.DataUtil.fnSort(comparer);\n\t            }\n\t            if (isFromGroup) {\n\t                sorts = Query.filterQueries(this.queries, 'onSortBy');\n\t                for (var i = 0; i < sorts.length; i++) {\n\t                    temp = sorts[i].e.fieldName;\n\t                    if (typeof temp === 'string') {\n\t                        if (temp === fieldName) {\n\t                            return this;\n\t                        }\n\t                    }\n\t                    else if (temp instanceof Array) {\n\t                        for (var j = 0; j < temp.length; j++) {\n\t                            if (temp[j] === fieldName || fieldName.toLowerCase() === temp[j] + ' desc') {\n\t                                return this;\n\t                            }\n\t                        }\n\t                    }\n\t                }\n\t            }\n\t            this.queries.push({\n\t                fn: 'onSortBy',\n\t                e: {\n\t                    fieldName: fieldName,\n\t                    comparer: comparer,\n\t                    direction: order\n\t                }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.sortByDesc = function (fieldName) {\n\t            return this.sortBy(fieldName, 'descending');\n\t        };\n\t        Query.prototype.group = function (fieldName) {\n\t            this.sortBy(fieldName, null, true);\n\t            this.queries.push({\n\t                fn: 'onGroup',\n\t                e: {\n\t                    fieldName: fieldName\n\t                }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.page = function (pageIndex, pageSize) {\n\t            this.queries.push({\n\t                fn: 'onPage',\n\t                e: {\n\t                    pageIndex: pageIndex,\n\t                    pageSize: pageSize\n\t                }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.range = function (start, end) {\n\t            this.queries.push({\n\t                fn: 'onRange',\n\t                e: {\n\t                    start: start,\n\t                    end: end\n\t                }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.take = function (nos) {\n\t            this.queries.push({\n\t                fn: 'onTake',\n\t                e: {\n\t                    nos: nos\n\t                }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.skip = function (nos) {\n\t            this.queries.push({\n\t                fn: 'onSkip',\n\t                e: { nos: nos }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.select = function (fieldNames) {\n\t            if (typeof fieldNames === 'string') {\n\t                fieldNames = [].slice.call([fieldNames], 0);\n\t            }\n\t            this.queries.push({\n\t                fn: 'onSelect',\n\t                e: { fieldNames: fieldNames }\n\t            });\n\t            return this;\n\t        };\n\t        Query.prototype.hierarchy = function (query, selectorFn) {\n\t            this.subQuerySelector = selectorFn;\n\t            this.subQuery = query;\n\t            return this;\n\t        };\n\t        Query.prototype.foreignKey = function (key) {\n\t            this.fKey = key;\n\t            return this;\n\t        };\n\t        Query.prototype.requiresCount = function () {\n\t            this.requiresCounts = true;\n\t            return this;\n\t        };\n\t        Query.prototype.aggregate = function (type, field) {\n\t            this.queries.push({\n\t                fn: 'onAggregates',\n\t                e: { field: field, type: type }\n\t            });\n\t            return this;\n\t        };\n\t        Query.filterQueries = function (queries, name) {\n\t            return queries.filter(function (q) {\n\t                return q.fn === name;\n\t            });\n\t        };\n\t        Query.filterQueryLists = function (queries, singles) {\n\t            var filtered = queries.filter(function (q) {\n\t                return singles.indexOf(q.fn) !== -1;\n\t            });\n\t            var res = {};\n\t            for (var i = 0; i < filtered.length; i++) {\n\t                if (!res[filtered[i].fn]) {\n\t                    res[filtered[i].fn] = filtered[i].e;\n\t                }\n\t            }\n\t            return res;\n\t        };\n\t        return Query;\n\t    }());\n\t    exports.Query = Query;\n\t    var Predicate = (function () {\n\t        function Predicate(field, operator, value, ignoreCase) {\n\t            if (ignoreCase === void 0) { ignoreCase = false; }\n\t            this.isComplex = false;\n\t            if (typeof field === 'string') {\n\t                this.field = field;\n\t                this.operator = operator.toLowerCase();\n\t                this.value = value;\n\t                this.ignoreCase = ignoreCase;\n\t                this.isComplex = false;\n\t                this.comparer = util_1.DataUtil.fnOperators.processOperator(this.operator);\n\t            }\n\t            else if (field instanceof Predicate && value instanceof Predicate || value instanceof Array) {\n\t                this.isComplex = true;\n\t                this.condition = operator.toLowerCase();\n\t                this.predicates = [field];\n\t                if (value instanceof Array) {\n\t                    [].push.apply(this.predicates, value);\n\t                }\n\t                else {\n\t                    this.predicates.push(value);\n\t                }\n\t            }\n\t            return this;\n\t        }\n\t        Predicate.and = function () {\n\t            var args = [];\n\t            for (var _i = 0; _i < arguments.length; _i++) {\n\t                args[_i] = arguments[_i];\n\t            }\n\t            return Predicate.combinePredicates([].slice.call(args, 0), 'and');\n\t        };\n\t        Predicate.prototype.and = function (field, operator, value, ignoreCase) {\n\t            return Predicate.combine(this, field, operator, value, 'and', ignoreCase);\n\t        };\n\t        Predicate.or = function () {\n\t            var args = [];\n\t            for (var _i = 0; _i < arguments.length; _i++) {\n\t                args[_i] = arguments[_i];\n\t            }\n\t            return Predicate.combinePredicates([].slice.call(args, 0), 'or');\n\t        };\n\t        Predicate.prototype.or = function (field, operator, value, ignoreCase) {\n\t            return Predicate.combine(this, field, operator, value, 'or', ignoreCase);\n\t        };\n\t        Predicate.fromJson = function (json) {\n\t            if (json instanceof Array) {\n\t                var res = [];\n\t                for (var i = 0, len = json.length; i < len; i++) {\n\t                    res.push(this.fromJSONData(json[i]));\n\t                }\n\t                return res;\n\t            }\n\t            var pred = json;\n\t            return this.fromJSONData(pred);\n\t        };\n\t        Predicate.prototype.validate = function (record) {\n\t            var predicate = this.predicates ? this.predicates : [];\n\t            var isAnd;\n\t            var ret;\n\t            if (!this.isComplex && this.comparer) {\n\t                return this.comparer.call(this, util_1.DataUtil.getObject(this.field, record), this.value, this.ignoreCase);\n\t            }\n\t            isAnd = this.condition === 'and';\n\t            for (var i = 0; i < predicate.length; i++) {\n\t                ret = predicate[i].validate(record);\n\t                if (isAnd) {\n\t                    if (!ret) {\n\t                        return false;\n\t                    }\n\t                }\n\t                else {\n\t                    if (ret) {\n\t                        return true;\n\t                    }\n\t                }\n\t            }\n\t            return isAnd;\n\t        };\n\t        Predicate.prototype.toJson = function () {\n\t            var predicates;\n\t            var p;\n\t            if (this.isComplex) {\n\t                predicates = [];\n\t                p = this.predicates;\n\t                for (var i = 0; i < p.length; i++) {\n\t                    predicates.push(p[i].toJson());\n\t                }\n\t            }\n\t            return {\n\t                isComplex: this.isComplex,\n\t                field: this.field,\n\t                operator: this.operator,\n\t                value: this.value,\n\t                ignoreCase: this.ignoreCase,\n\t                condition: this.condition,\n\t                predicates: predicates\n\t            };\n\t        };\n\t        Predicate.combinePredicates = function (predicates, operator) {\n\t            if (predicates.length === 1) {\n\t                if (!(predicates[0] instanceof Array)) {\n\t                    return predicates[0];\n\t                }\n\t                predicates = predicates[0];\n\t            }\n\t            return new Predicate(predicates[0], operator, predicates.slice(1));\n\t        };\n\t        Predicate.combine = function (pred, field, operator, value, condition, ignoreCase) {\n\t            if (field instanceof Predicate) {\n\t                return Predicate[condition](pred, field);\n\t            }\n\t            if (typeof field === 'string') {\n\t                return Predicate[condition](pred, new Predicate(field, operator, value, ignoreCase));\n\t            }\n\t            return util_1.DataUtil.throwError('Predicate - ' + condition + ' : invalid arguments');\n\t        };\n\t        Predicate.fromJSONData = function (json) {\n\t            var preds = json.predicates || [];\n\t            var len = preds.length;\n\t            var predicates = [];\n\t            var result;\n\t            for (var i = 0; i < len; i++) {\n\t                predicates.push(this.fromJSONData(preds[i]));\n\t            }\n\t            if (!json.isComplex) {\n\t                result = new Predicate(json.field, json.operator, json.value, json.ignoreCase);\n\t            }\n\t            else {\n\t                result = new Predicate(predicates[0], json.condition, predicates.slice(1));\n\t            }\n\t            return result;\n\t        };\n\t        return Predicate;\n\t    }());\n\t    exports.Predicate = Predicate;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;var __extends = (this && this.__extends) || (function () {\n\t    var extendStatics = Object.setPrototypeOf ||\n\t        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n\t        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n\t    return function (d, b) {\n\t        extendStatics(d, b);\n\t        function __() { this.constructor = d; }\n\t        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n\t    };\n\t})();\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports, __webpack_require__(2), __webpack_require__(3), __webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (require, exports, ej2_base_1, util_1, query_1) {\n\t    \"use strict\";\n\t    Object.defineProperty(exports, \"__esModule\", { value: true });\n\t    var Adaptor = (function () {\n\t        function Adaptor(ds) {\n\t            this.options = {\n\t                from: 'table',\n\t                requestType: 'json',\n\t                sortBy: 'sorted',\n\t                select: 'select',\n\t                skip: 'skip',\n\t                group: 'group',\n\t                take: 'take',\n\t                search: 'search',\n\t                count: 'requiresCounts',\n\t                where: 'where',\n\t                aggregates: 'aggregates'\n\t            };\n\t            this.type = Adaptor;\n\t            this.dataSource = ds;\n\t            this.pvt = {};\n\t        }\n\t        Adaptor.prototype.processResponse = function (data, ds, query, xhr) {\n\t            return data;\n\t        };\n\t        return Adaptor;\n\t    }());\n\t    exports.Adaptor = Adaptor;\n\t    var JsonAdaptor = (function (_super) {\n\t        __extends(JsonAdaptor, _super);\n\t        function JsonAdaptor() {\n\t            return _super !== null && _super.apply(this, arguments) || this;\n\t        }\n\t        JsonAdaptor.prototype.processQuery = function (dataManager, query) {\n\t            var result = dataManager.dataSource.json.slice(0);\n\t            var count = result.length;\n\t            var countFlg = true;\n\t            var ret;\n\t            var key;\n\t            var agg = {};\n\t            for (var i = 0; i < query.queries.length; i++) {\n\t                key = query.queries[i];\n\t                ret = this[key.fn].call(this, result, key.e, query);\n\t                if (key.fn === 'onAggregates') {\n\t                    agg[key.e.field + ' - ' + key.e.type] = ret;\n\t                }\n\t                else {\n\t                    result = ret !== undefined ? ret : result;\n\t                }\n\t                if (key.fn === 'onPage' || key.fn === 'onSkip' || key.fn === 'onTake' || key.fn === 'onRange') {\n\t                    countFlg = false;\n\t                }\n\t                if (countFlg) {\n\t                    count = result.length;\n\t                }\n\t            }\n\t            if (query.requiresCounts) {\n\t                result = {\n\t                    result: result,\n\t                    count: count,\n\t                    aggregates: agg\n\t                };\n\t            }\n\t            return result;\n\t        };\n\t        JsonAdaptor.prototype.batchRequest = function (dm, changes, e) {\n\t            var i;\n\t            for (i = 0; i < changes.addedRecords.length; i++) {\n\t                this.insert(dm, changes.addedRecords[i]);\n\t            }\n\t            for (i = 0; i < changes.changedRecords.length; i++) {\n\t                this.update(dm, e.key, changes.changedRecords[i]);\n\t            }\n\t            for (i = 0; i < changes.deletedRecords.length; i++) {\n\t                this.remove(dm, e.key, changes.deletedRecords[i]);\n\t            }\n\t            return changes;\n\t        };\n\t        JsonAdaptor.prototype.onWhere = function (ds, e) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            return ds.filter(function (obj) {\n\t                if (e) {\n\t                    return e.validate(obj);\n\t                }\n\t            });\n\t        };\n\t        JsonAdaptor.prototype.onAggregates = function (ds, e) {\n\t            var fn = util_1.DataUtil.aggregates[e.type];\n\t            if (!ds || !fn || ds.length === 0) {\n\t                return null;\n\t            }\n\t            return fn(ds, e.field);\n\t        };\n\t        JsonAdaptor.prototype.onSearch = function (ds, e) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            if (e.fieldNames.length === 0) {\n\t                util_1.DataUtil.getFieldList(ds[0], e.fieldNames);\n\t            }\n\t            return ds.filter(function (obj) {\n\t                for (var j = 0; j < e.fieldNames.length; j++) {\n\t                    if (e.comparer.call(obj, util_1.DataUtil.getObject(e.fieldNames[j], obj), e.searchKey, e.ignoreCase)) {\n\t                        return true;\n\t                    }\n\t                }\n\t                return false;\n\t            });\n\t        };\n\t        JsonAdaptor.prototype.onSortBy = function (ds, e, query) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            var fnCompare;\n\t            var field = util_1.DataUtil.getValue(e.fieldName, query);\n\t            if (!field) {\n\t                return ds.sort(e.comparer);\n\t            }\n\t            if (field instanceof Array) {\n\t                field = field.slice(0);\n\t                for (var i = field.length - 1; i >= 0; i--) {\n\t                    if (!field[i]) {\n\t                        continue;\n\t                    }\n\t                    fnCompare = e.comparer;\n\t                    if (util_1.DataUtil.endsWith(field[i], ' desc')) {\n\t                        fnCompare = util_1.DataUtil.fnSort('descending');\n\t                        field[i] = field[i].replace(' desc', '');\n\t                    }\n\t                    ds = util_1.DataUtil.sort(ds, field[i], fnCompare);\n\t                }\n\t                return ds;\n\t            }\n\t            return util_1.DataUtil.sort(ds, field, e.comparer);\n\t        };\n\t        JsonAdaptor.prototype.onGroup = function (ds, e, query) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            var aggQuery = query_1.Query.filterQueries(query.queries, 'onAggregates');\n\t            var agg = [];\n\t            if (aggQuery.length) {\n\t                var tmp = void 0;\n\t                for (var i = 0; i < aggQuery.length; i++) {\n\t                    tmp = aggQuery[i].e;\n\t                    agg.push({ type: tmp.type, field: util_1.DataUtil.getValue(tmp.field, query) });\n\t                }\n\t            }\n\t            return util_1.DataUtil.group(ds, util_1.DataUtil.getValue(e.fieldName, query), agg);\n\t        };\n\t        JsonAdaptor.prototype.onPage = function (ds, e, query) {\n\t            var size = util_1.DataUtil.getValue(e.pageSize, query);\n\t            var start = (util_1.DataUtil.getValue(e.pageIndex, query) - 1) * size;\n\t            var end = start + size;\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            return ds.slice(start, end);\n\t        };\n\t        JsonAdaptor.prototype.onRange = function (ds, e) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            return ds.slice(util_1.DataUtil.getValue(e.start), util_1.DataUtil.getValue(e.end));\n\t        };\n\t        JsonAdaptor.prototype.onTake = function (ds, e) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            return ds.slice(0, util_1.DataUtil.getValue(e.nos));\n\t        };\n\t        JsonAdaptor.prototype.onSkip = function (ds, e) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            return ds.slice(util_1.DataUtil.getValue(e.nos));\n\t        };\n\t        JsonAdaptor.prototype.onSelect = function (ds, e) {\n\t            if (!ds || !ds.length) {\n\t                return ds;\n\t            }\n\t            return util_1.DataUtil.select(ds, util_1.DataUtil.getValue(e.fieldNames));\n\t        };\n\t        JsonAdaptor.prototype.insert = function (dm, data, tableName, query, position) {\n\t            if (ej2_base_1.isNullOrUndefined(position)) {\n\t                return dm.dataSource.json.push(data);\n\t            }\n\t            else {\n\t                return dm.dataSource.json.splice(position, 0, data);\n\t            }\n\t        };\n\t        JsonAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n\t            var ds = dm.dataSource.json;\n\t            var i;\n\t            if (typeof value === 'object') {\n\t                value = value[keyField];\n\t            }\n\t            for (i = 0; i < ds.length; i++) {\n\t                if (ds[i][keyField] === value) {\n\t                    break;\n\t                }\n\t            }\n\t            return i !== ds.length ? ds.splice(i, 1) : null;\n\t        };\n\t        JsonAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n\t            var ds = dm.dataSource.json;\n\t            var i;\n\t            var key = value[keyField];\n\t            for (i = 0; i < ds.length; i++) {\n\t                if (ds[i][keyField] === key) {\n\t                    break;\n\t                }\n\t            }\n\t            return i < ds.length ? ej2_base_1.merge(ds[i], value) : null;\n\t        };\n\t        return JsonAdaptor;\n\t    }(Adaptor));\n\t    exports.JsonAdaptor = JsonAdaptor;\n\t    var UrlAdaptor = (function (_super) {\n\t        __extends(UrlAdaptor, _super);\n\t        function UrlAdaptor() {\n\t            return _super !== null && _super.apply(this, arguments) || this;\n\t        }\n\t        UrlAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\n\t            var queries = this.getQueryRequest(query);\n\t            var singles = query_1.Query.filterQueryLists(query.queries, ['onSelect', 'onPage', 'onSkip', 'onTake', 'onRange']);\n\t            var params = query.params;\n\t            var url = dm.dataSource.url;\n\t            var temp;\n\t            var skip;\n\t            var take = null;\n\t            var options = this.options;\n\t            var request = { sorts: [], groups: [], filters: [], searches: [], aggregates: [] };\n\t            if ('onPage' in singles) {\n\t                temp = singles.onPage;\n\t                skip = util_1.DataUtil.getValue(temp.pageIndex, query);\n\t                take = util_1.DataUtil.getValue(temp.pageSize, query);\n\t                skip = (skip - 1) * take;\n\t            }\n\t            else if ('onRange' in singles) {\n\t                temp = singles.onRange;\n\t                skip = temp.start;\n\t                take = temp.end - temp.start;\n\t            }\n\t            for (var i = 0; i < queries.sorts.length; i++) {\n\t                temp = util_1.DataUtil.getValue(queries.sorts[i].e.fieldName, query);\n\t                request.sorts.push(util_1.DataUtil.callAdaptorFunction(this, 'onEachSort', { name: temp, direction: queries.sorts[i].e.direction }, query));\n\t            }\n\t            if (hierarchyFilters) {\n\t                temp = this.getFiltersFrom(hierarchyFilters, query);\n\t                if (temp) {\n\t                    request.filters.push(util_1.DataUtil.callAdaptorFunction(this, 'onEachWhere', temp.toJson(), query));\n\t                }\n\t            }\n\t            for (var i = 0; i < queries.filters.length; i++) {\n\t                request.filters.push(util_1.DataUtil.callAdaptorFunction(this, 'onEachWhere', queries.filters[i].e.toJson(), query));\n\t                var keys_1 = typeof request.filters[i] === 'object' ? Object.keys(request.filters[i]) : [];\n\t                for (var _i = 0, keys_2 = keys_1; _i < keys_2.length; _i++) {\n\t                    var prop = keys_2[_i];\n\t                    if (util_1.DataUtil.isNull((request)[prop])) {\n\t                        delete request[prop];\n\t                    }\n\t                }\n\t            }\n\t            for (var i = 0; i < queries.searches.length; i++) {\n\t                temp = queries.searches[i].e;\n\t                request.searches.push(util_1.DataUtil.callAdaptorFunction(this, 'onEachSearch', {\n\t                    fields: temp.fieldNames,\n\t                    operator: temp.operator,\n\t                    key: temp.searchKey,\n\t                    ignoreCase: temp.ignoreCase\n\t                }, query));\n\t            }\n\t            for (var i = 0; i < queries.groups.length; i++) {\n\t                request.groups.push(util_1.DataUtil.getValue(queries.groups[i].e.fieldName, query));\n\t            }\n\t            for (var i = 0; i < queries.aggregates.length; i++) {\n\t                temp = queries.aggregates[i].e;\n\t                request.aggregates.push({ type: temp.type, field: util_1.DataUtil.getValue(temp.field, query) });\n\t            }\n\t            var req = {};\n\t            this.getRequestQuery(options, query, singles, request, req);\n\t            util_1.DataUtil.callAdaptorFunction(this, 'addParams', { dm: dm, query: query, params: params, reqParams: req });\n\t            var keys = Object.keys(req);\n\t            for (var _a = 0, keys_3 = keys; _a < keys_3.length; _a++) {\n\t                var prop = keys_3[_a];\n\t                if (util_1.DataUtil.isNull(req[prop]) || req[prop] === '' || req[prop].length === 0) {\n\t                    delete req[prop];\n\t                }\n\t            }\n\t            if (!(options.skip in req && options.take in req) && take !== null) {\n\t                req[options.skip] = util_1.DataUtil.callAdaptorFunction(this, 'onSkip', skip, query);\n\t                req[options.take] = util_1.DataUtil.callAdaptorFunction(this, 'onTake', take, query);\n\t            }\n\t            var p = this.pvt;\n\t            this.pvt = {};\n\t            if (this.options.requestType === 'json') {\n\t                return {\n\t                    data: JSON.stringify(req),\n\t                    url: url,\n\t                    pvtData: p,\n\t                    type: 'POST',\n\t                    contentType: 'application/json; charset=utf-8'\n\t                };\n\t            }\n\t            temp = this.convertToQueryString(req, query, dm);\n\t            temp = (dm.dataSource.url.indexOf('?') !== -1 ? '&' : '/') + temp;\n\t            return {\n\t                type: 'GET', url: temp.length ? url.replace(/\\/*$/, temp) : url, pvtData: p\n\t            };\n\t        };\n\t        UrlAdaptor.prototype.getRequestQuery = function (options, query, singles, request, request1) {\n\t            var param = 'param';\n\t            var req = request1;\n\t            req[options.from] = query.fromTable;\n\t            if (options.expand) {\n\t                req[options.expand] = query.expands;\n\t            }\n\t            req[options.select] = 'onSelect' in singles ?\n\t                util_1.DataUtil.callAdaptorFunction(this, 'onSelect', util_1.DataUtil.getValue(singles.onSelect.fieldNames, query), query) : '';\n\t            req[options.count] = query.requiresCounts ? util_1.DataUtil.callAdaptorFunction(this, 'onCount', query.requiresCounts, query) : '';\n\t            req[options.search] = request.searches.length ? util_1.DataUtil.callAdaptorFunction(this, 'onSearch', request.searches, query) : '';\n\t            req[options.skip] = 'onSkip' in singles ?\n\t                util_1.DataUtil.callAdaptorFunction(this, 'onSkip', util_1.DataUtil.getValue(singles.onSkip.nos, query), query) : '';\n\t            req[options.take] = 'onTake' in singles ?\n\t                util_1.DataUtil.callAdaptorFunction(this, 'onTake', util_1.DataUtil.getValue(singles.onTake.nos, query), query) : '';\n\t            req[options.where] = request.filters.length || request.searches.length ?\n\t                util_1.DataUtil.callAdaptorFunction(this, 'onWhere', request.filters, query) : '';\n\t            req[options.sortBy] = request.sorts.length ? util_1.DataUtil.callAdaptorFunction(this, 'onSortBy', request.sorts, query) : '';\n\t            req[options.group] = request.groups.length ? util_1.DataUtil.callAdaptorFunction(this, 'onGroup', request.groups, query) : '';\n\t            req[options.aggregates] = request.aggregates.length ?\n\t                util_1.DataUtil.callAdaptorFunction(this, 'onAggregates', request.aggregates, query) : '';\n\t            req[param] = [];\n\t        };\n\t        UrlAdaptor.prototype.convertToQueryString = function (request, query, dm) {\n\t            return '';\n\t        };\n\t        UrlAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n\t            var requests = request;\n\t            var pvt = requests.pvtData || {};\n\t            var groupDs = data.groupDs;\n\t            if (xhr && xhr.getResponseHeader('Content-Type') &&\n\t                xhr.getResponseHeader('Content-Type').indexOf('xml') !== -1) {\n\t                return (query.requiresCounts ? { result: [], count: 0 } : []);\n\t            }\n\t            var d = JSON.parse(requests.data);\n\t            if (d && d.action === 'batch' && data.addedRecords) {\n\t                changes.addedRecords = data.addedRecords;\n\t                return changes;\n\t            }\n\t            if (data.d) {\n\t                data = data.d;\n\t            }\n\t            var args = {};\n\t            if ('count' in data) {\n\t                args.count = data.count;\n\t            }\n\t            args.result = data.result ? data.result : data;\n\t            this.getAggregateResult(pvt, data, args, groupDs);\n\t            return util_1.DataUtil.isNull(args.count) ? args.result : { result: args.result, count: args.count, aggregates: args.aggregates };\n\t        };\n\t        UrlAdaptor.prototype.onGroup = function (e) {\n\t            this.pvt.groups = e;\n\t        };\n\t        UrlAdaptor.prototype.onAggregates = function (e) {\n\t            this.pvt.aggregates = e;\n\t        };\n\t        UrlAdaptor.prototype.batchRequest = function (dm, changes, e) {\n\t            var url;\n\t            var key;\n\t            return {\n\t                type: 'POST',\n\t                url: dm.dataSource.batchUrl || dm.dataSource.crudUrl || dm.dataSource.removeUrl || dm.dataSource.url,\n\t                contentType: 'application/json; charset=utf-8',\n\t                dataType: 'json',\n\t                data: JSON.stringify({\n\t                    changed: changes.changedRecords,\n\t                    added: changes.addedRecords,\n\t                    deleted: changes.deletedRecords,\n\t                    action: 'batch',\n\t                    table: e[url],\n\t                    key: e[key]\n\t                })\n\t            };\n\t        };\n\t        UrlAdaptor.prototype.beforeSend = function (dm, request) {\n\t        };\n\t        UrlAdaptor.prototype.insert = function (dm, data, tableName) {\n\t            return {\n\t                url: dm.dataSource.insertUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n\t                data: JSON.stringify({\n\t                    value: data,\n\t                    table: tableName,\n\t                    action: 'insert'\n\t                })\n\t            };\n\t        };\n\t        UrlAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n\t            return {\n\t                type: 'POST',\n\t                url: dm.dataSource.removeUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n\t                data: JSON.stringify({\n\t                    key: value,\n\t                    keyColumn: keyField,\n\t                    table: tableName,\n\t                    action: 'remove'\n\t                })\n\t            };\n\t        };\n\t        UrlAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n\t            return {\n\t                type: 'POST',\n\t                url: dm.dataSource.updateUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n\t                data: JSON.stringify({\n\t                    value: value,\n\t                    action: 'update',\n\t                    keyColumn: keyField,\n\t                    key: value[keyField],\n\t                    table: tableName\n\t                })\n\t            };\n\t        };\n\t        UrlAdaptor.prototype.getFiltersFrom = function (data, query) {\n\t            var key = query.fKey;\n\t            var value;\n\t            var prop = key;\n\t            var pKey = query.key;\n\t            var predicats = [];\n\t            if (typeof data[0] !== 'object') {\n\t                prop = null;\n\t            }\n\t            for (var i = 0; i < data.length; i++) {\n\t                if (typeof data[0] === 'object') {\n\t                    value = util_1.DataUtil.getObject(pKey || prop, data[i]);\n\t                }\n\t                else {\n\t                    value = data[i];\n\t                }\n\t                predicats.push(new query_1.Predicate(key, 'equal', value));\n\t            }\n\t            return query_1.Predicate.or(predicats);\n\t        };\n\t        UrlAdaptor.prototype.getAggregateResult = function (pvt, data, args, groupDs) {\n\t            var pData = data;\n\t            if (data && data.result) {\n\t                pData = data.result;\n\t            }\n\t            if (pvt && pvt.aggregates && pvt.aggregates.length) {\n\t                var agg = pvt.aggregates;\n\t                var fn = void 0;\n\t                var aggregateData = pData;\n\t                var res = {};\n\t                if (data.aggregate) {\n\t                    aggregateData = data.aggregate;\n\t                }\n\t                for (var i = 0; i < agg.length; i++) {\n\t                    fn = util_1.DataUtil.aggregates[agg[i].type];\n\t                    if (fn) {\n\t                        res[agg[i].field + ' - ' + agg[i].type] = fn(aggregateData, agg[i].field);\n\t                    }\n\t                }\n\t                args.aggregates = res;\n\t            }\n\t            if (pvt && pvt.groups && pvt.groups.length) {\n\t                var groups = pvt.groups;\n\t                for (var i = 0; i < groups.length; i++) {\n\t                    var level = null;\n\t                    if (!ej2_base_1.isNullOrUndefined(groupDs)) {\n\t                        groupDs = util_1.DataUtil.group(groupDs, groups[i]);\n\t                    }\n\t                    pData = util_1.DataUtil.group(pData, groups[i], pvt.aggregates, level, groupDs);\n\t                }\n\t                args.result = pData;\n\t            }\n\t            return args;\n\t        };\n\t        UrlAdaptor.prototype.getQueryRequest = function (query) {\n\t            var req = { sorts: [], groups: [], filters: [], searches: [], aggregates: [] };\n\t            req.sorts = query_1.Query.filterQueries(query.queries, 'onSortBy');\n\t            req.groups = query_1.Query.filterQueries(query.queries, 'onGroup');\n\t            req.filters = query_1.Query.filterQueries(query.queries, 'onWhere');\n\t            req.searches = query_1.Query.filterQueries(query.queries, 'onSearch');\n\t            req.aggregates = query_1.Query.filterQueries(query.queries, 'onAggregates');\n\t            return req;\n\t        };\n\t        UrlAdaptor.prototype.addParams = function (options) {\n\t            var req = options.reqParams;\n\t            if (options.params.length) {\n\t                req.params = {};\n\t            }\n\t            for (var _i = 0, _a = options.params; _i < _a.length; _i++) {\n\t                var tmp = _a[_i];\n\t                if (req[tmp.key]) {\n\t                    throw new Error('Query() - addParams: Custom Param is conflicting other request arguments');\n\t                }\n\t                req[tmp.key] = tmp.value;\n\t                if (tmp.fn) {\n\t                    req[tmp.key] = tmp.fn.call(options.query, tmp.key, options.query, options.dm);\n\t                }\n\t                req.params[tmp.key] = req[tmp.key];\n\t            }\n\t        };\n\t        return UrlAdaptor;\n\t    }(Adaptor));\n\t    exports.UrlAdaptor = UrlAdaptor;\n\t    var ODataAdaptor = (function (_super) {\n\t        __extends(ODataAdaptor, _super);\n\t        function ODataAdaptor() {\n\t            var _this = _super.call(this) || this;\n\t            _this.options = ej2_base_1.extend({}, _this.options, {\n\t                requestType: 'get',\n\t                accept: 'application/json;odata=light;q=1,application/json;odata=verbose;q=0.5',\n\t                multipartAccept: 'multipart/mixed',\n\t                sortBy: '$orderby',\n\t                select: '$select',\n\t                skip: '$skip',\n\t                take: '$top',\n\t                count: '$inlinecount',\n\t                where: '$filter',\n\t                expand: '$expand',\n\t                batch: '$batch',\n\t                changeSet: '--changeset_',\n\t                batchPre: 'batch_',\n\t                contentId: 'Content-Id: ',\n\t                batchContent: 'Content-Type: multipart/mixed; boundary=',\n\t                changeSetContent: 'Content-Type: application/http\\nContent-Transfer-Encoding: binary ',\n\t                batchChangeSetContentType: 'Content-Type: application/json; charset=utf-8 '\n\t            });\n\t            _this.getModuleName = ej2_base_1.getValue('getModulename', _this);\n\t            return _this;\n\t        }\n\t        ODataAdaptor.prototype.onPredicate = function (predicate, query, requiresCast) {\n\t            var returnValue = '';\n\t            var operator;\n\t            var guid;\n\t            var val = predicate.value;\n\t            var type = typeof val;\n\t            var field = predicate.field ? ODataAdaptor.getField(predicate.field) : null;\n\t            if (val instanceof Date) {\n\t                val = 'datetime\\'' + util_1.DataUtil.parse.replacer(val) + '\\'';\n\t            }\n\t            if (type === 'string') {\n\t                val = '\\'' + val + '\\'';\n\t                if (requiresCast) {\n\t                    field = 'cast(' + field + ', \\'Edm.String\\')';\n\t                }\n\t                if (util_1.DataUtil.parse.isGuid(val)) {\n\t                    guid = 'guid';\n\t                }\n\t                if (predicate.ignoreCase) {\n\t                    if (!guid) {\n\t                        field = 'tolower(' + field + ')';\n\t                    }\n\t                    val = val.toLowerCase();\n\t                }\n\t            }\n\t            operator = util_1.DataUtil.odBiOperator[predicate.operator];\n\t            if (operator) {\n\t                returnValue += field;\n\t                returnValue += operator;\n\t                if (guid) {\n\t                    returnValue += guid;\n\t                }\n\t                return returnValue + val;\n\t            }\n\t            if (!ej2_base_1.isNullOrUndefined(this.getModuleName)) {\n\t                if (this.getModuleName() === 'ODataV4Adaptor') {\n\t                    operator = util_1.DataUtil.odv4UniOperator[predicate.operator];\n\t                }\n\t            }\n\t            else {\n\t                operator = util_1.DataUtil.odUniOperator[predicate.operator];\n\t            }\n\t            if (operator === 'substringof') {\n\t                var temp = val;\n\t                val = field;\n\t                field = temp;\n\t            }\n\t            returnValue += operator + '(';\n\t            returnValue += field + ',';\n\t            if (guid) {\n\t                returnValue += guid;\n\t            }\n\t            returnValue += val + ')';\n\t            return returnValue;\n\t        };\n\t        ODataAdaptor.prototype.onComplexPredicate = function (predicate, query, requiresCast) {\n\t            var res = [];\n\t            for (var i = 0; i < predicate.predicates.length; i++) {\n\t                res.push('(' + this.onEachWhere(predicate.predicates[i], query, requiresCast) + ')');\n\t            }\n\t            return res.join(' ' + predicate.condition + ' ');\n\t        };\n\t        ODataAdaptor.prototype.onEachWhere = function (filter, query, requiresCast) {\n\t            return filter.isComplex ? this.onComplexPredicate(filter, query, requiresCast) : this.onPredicate(filter, query, requiresCast);\n\t        };\n\t        ODataAdaptor.prototype.onWhere = function (filters) {\n\t            if (this.pvt.search) {\n\t                filters.push(this.onEachWhere(this.pvt.search, null, true));\n\t            }\n\t            return filters.join(' and ');\n\t        };\n\t        ODataAdaptor.prototype.onEachSearch = function (e) {\n\t            if (e.fields && e.fields.length === 0) {\n\t                util_1.DataUtil.throwError('Query() - Search : oData search requires list of field names to search');\n\t            }\n\t            var filter = this.pvt.search || [];\n\t            for (var i = 0; i < e.fields.length; i++) {\n\t                filter.push(new query_1.Predicate(e.fields[i], e.operator, e.key, e.ignoreCase));\n\t            }\n\t            this.pvt.search = filter;\n\t        };\n\t        ODataAdaptor.prototype.onSearch = function (e) {\n\t            this.pvt.search = query_1.Predicate.or(this.pvt.search);\n\t            return '';\n\t        };\n\t        ODataAdaptor.prototype.onEachSort = function (e) {\n\t            var res = [];\n\t            if (e.name instanceof Array) {\n\t                for (var i = 0; i < e.name.length; i++) {\n\t                    res.push(ODataAdaptor.getField(e.name[i]) + (e.direction === 'descending' ? ' desc' : ''));\n\t                }\n\t            }\n\t            else {\n\t                res.push(ODataAdaptor.getField(e.name) + (e.direction === 'descending' ? ' desc' : ''));\n\t            }\n\t            return res.join(',');\n\t        };\n\t        ODataAdaptor.prototype.onSortBy = function (e) {\n\t            return e.reverse().join(',');\n\t        };\n\t        ODataAdaptor.prototype.onGroup = function (e) {\n\t            this.pvt.groups = e;\n\t            return '';\n\t        };\n\t        ODataAdaptor.prototype.onSelect = function (e) {\n\t            for (var i = 0; i < e.length; i++) {\n\t                e[i] = ODataAdaptor.getField(e[i]);\n\t            }\n\t            return e.join(',');\n\t        };\n\t        ODataAdaptor.prototype.onAggregates = function (e) {\n\t            this.pvt.aggregates = e;\n\t            return '';\n\t        };\n\t        ODataAdaptor.prototype.onCount = function (e) {\n\t            return e === true ? 'allpages' : '';\n\t        };\n\t        ODataAdaptor.prototype.beforeSend = function (dm, request, settings) {\n\t            if (util_1.DataUtil.endsWith(settings.url, this.options.batch) && settings.type.toLowerCase() === 'post') {\n\t                request.setRequestHeader('Accept', this.options.multipartAccept);\n\t                request.setRequestHeader('DataServiceVersion', '2.0');\n\t                request.overrideMimeType('text/plain; charset=x-user-defined');\n\t            }\n\t            else {\n\t                request.setRequestHeader('Accept', this.options.accept);\n\t            }\n\t            request.setRequestHeader('DataServiceVersion', '2.0');\n\t            request.setRequestHeader('MaxDataServiceVersion', '2.0');\n\t        };\n\t        ODataAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n\t            var pvtData = 'pvtData';\n\t            if (!ej2_base_1.isNullOrUndefined(data.d)) {\n\t                var dataCopy = (query && query.requiresCounts) ? data.d.results : data.d;\n\t                var metaData = '__metadata';\n\t                if (!ej2_base_1.isNullOrUndefined(dataCopy)) {\n\t                    for (var i = 0; i < dataCopy.length; i++) {\n\t                        if (!ej2_base_1.isNullOrUndefined(dataCopy[i][metaData])) {\n\t                            delete dataCopy[i][metaData];\n\t                        }\n\t                    }\n\t                }\n\t            }\n\t            var pvt = request && request[pvtData];\n\t            var emptyAndBatch = this.processBatchResponse(data, query, xhr, request, changes);\n\t            if (emptyAndBatch) {\n\t                return emptyAndBatch;\n\t            }\n\t            var versionCheck = xhr && request.getResponseHeader('DataServiceVersion');\n\t            var count = null;\n\t            var version = (versionCheck && parseInt(versionCheck, 10)) || 2;\n\t            if (query && query.requiresCounts) {\n\t                var oDataCount = '__count';\n\t                if (data[oDataCount] || data['odata.count']) {\n\t                    count = data[oDataCount] || data['odata.count'];\n\t                }\n\t                if (data.d) {\n\t                    data = data.d;\n\t                }\n\t                if (data[oDataCount] || data['odata.count']) {\n\t                    count = data[oDataCount] || data['odata.count'];\n\t                }\n\t            }\n\t            if (version === 3 && data.value) {\n\t                data = data.value;\n\t            }\n\t            if (data.d) {\n\t                data = data.d;\n\t            }\n\t            if (version < 3 && data.results) {\n\t                data = data.results;\n\t            }\n\t            var args = {};\n\t            args.count = count;\n\t            args.result = data;\n\t            this.getAggregateResult(pvt, data, args);\n\t            return util_1.DataUtil.isNull(count) ? args.result : { result: args.result, count: args.count, aggregates: args.aggregates };\n\t        };\n\t        ODataAdaptor.prototype.convertToQueryString = function (request, query, dm) {\n\t            var res = [];\n\t            var table = 'table';\n\t            var tableName = request[table] || '';\n\t            var format = '$format';\n\t            delete request[table];\n\t            if (dm.dataSource.requiresFormat) {\n\t                request[format] = 'json';\n\t            }\n\t            var keys = Object.keys(request);\n\t            for (var _i = 0, keys_4 = keys; _i < keys_4.length; _i++) {\n\t                var prop = keys_4[_i];\n\t                res.push(prop + '=' + request[prop]);\n\t            }\n\t            res = res.join('&');\n\t            if (dm.dataSource.url && dm.dataSource.url.indexOf('?') !== -1 && !tableName) {\n\t                return res;\n\t            }\n\t            return res.length ? tableName + '?' + res : tableName || '';\n\t        };\n\t        ODataAdaptor.prototype.insert = function (dm, data, tableName) {\n\t            return {\n\t                url: dm.dataSource.url.replace(/\\/*$/, tableName ? '/' + tableName : ''),\n\t                data: JSON.stringify(data)\n\t            };\n\t        };\n\t        ODataAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n\t            return {\n\t                type: 'DELETE',\n\t                url: dm.dataSource.url.replace(/\\/*$/, tableName ? '/' + tableName : '') + '(' + value + ')'\n\t            };\n\t        };\n\t        ODataAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n\t            return {\n\t                type: 'PUT',\n\t                url: dm.dataSource.url.replace(/\\/*$/, tableName ? '/' + tableName : '') + '(' + value[keyField] + ')',\n\t                data: JSON.stringify(value),\n\t                accept: this.options.accept\n\t            };\n\t        };\n\t        ODataAdaptor.prototype.batchRequest = function (dm, changes, e) {\n\t            var initialGuid = e.guid = util_1.DataUtil.getGuid(this.options.batchPre);\n\t            var url = dm.dataSource.url.replace(/\\/*$/, '/' + this.options.batch);\n\t            var args = {\n\t                url: e.url,\n\t                key: e.key,\n\t                cid: 1,\n\t                cSet: util_1.DataUtil.getGuid(this.options.changeSet)\n\t            };\n\t            var req = '--' + initialGuid + '\\n';\n\t            req += 'Content-Type: multipart/mixed; boundary=' + args.cSet.replace('--', '') + '\\n';\n\t            this.pvt.changeSet = 0;\n\t            req += this.generateInsertRequest(changes.addedRecords, args);\n\t            req += this.generateUpdateRequest(changes.changedRecords, args);\n\t            req += this.generateDeleteRequest(changes.deletedRecords, args);\n\t            req += args.cSet + '--\\n';\n\t            req += '--' + initialGuid + '--';\n\t            return {\n\t                type: 'POST',\n\t                url: url,\n\t                dataType: 'json',\n\t                contentType: 'multipart/mixed; charset=UTF-8;boundary=' + initialGuid,\n\t                data: req\n\t            };\n\t        };\n\t        ODataAdaptor.prototype.generateDeleteRequest = function (arr, e) {\n\t            if (!arr) {\n\t                return '';\n\t            }\n\t            var req = '';\n\t            var stat = {\n\t                'method': 'DELETE ',\n\t                'url': function (data, i, key) { return '(' + data[i][key] + ')'; },\n\t                'data': function (data, i) { return ''; }\n\t            };\n\t            req = this.generateBodyContent(arr, e, stat);\n\t            return req + '\\n';\n\t        };\n\t        ODataAdaptor.prototype.generateInsertRequest = function (arr, e) {\n\t            if (!arr) {\n\t                return '';\n\t            }\n\t            var req = '';\n\t            var stat = {\n\t                'method': 'POST ',\n\t                'url': function (data, i, key) { return ''; },\n\t                'data': function (data, i) { return JSON.stringify(data[i]) + '\\n\\n'; }\n\t            };\n\t            req = this.generateBodyContent(arr, e, stat);\n\t            return req;\n\t        };\n\t        ODataAdaptor.prototype.generateUpdateRequest = function (arr, e) {\n\t            if (!arr) {\n\t                return '';\n\t            }\n\t            var req = '';\n\t            var stat = {\n\t                'method': 'PUT ',\n\t                'url': function (data, i, key) { return '(' + data[i][key] + ')'; },\n\t                'data': function (data, i) { return JSON.stringify(data[i]) + '\\n\\n'; }\n\t            };\n\t            req = this.generateBodyContent(arr, e, stat);\n\t            return req;\n\t        };\n\t        ODataAdaptor.getField = function (prop) {\n\t            return prop.replace(/\\./g, '/');\n\t        };\n\t        ODataAdaptor.prototype.generateBodyContent = function (arr, e, stat) {\n\t            var req = '';\n\t            for (var i = 0; i < arr.length; i++) {\n\t                req += '\\n' + e.cSet + '\\n';\n\t                req += this.options.changeSetContent + '\\n\\n';\n\t                req += stat.method;\n\t                req += e.url + stat.url(arr, i, e.key) + ' HTTP/1.1\\n';\n\t                req += 'Accept: ' + this.options.accept + '\\n';\n\t                req += 'Content-Id: ' + this.pvt.changeSet++ + '\\n';\n\t                req += this.options.batchChangeSetContentType + '\\n\\n';\n\t                req += stat.data(arr, i);\n\t            }\n\t            return req;\n\t        };\n\t        ODataAdaptor.prototype.processBatchResponse = function (data, query, xhr, request, changes) {\n\t            if (xhr && xhr.getResponseHeader('Content-Type') && xhr.getResponseHeader('Content-Type').indexOf('xml') !== -1) {\n\t                return (query.requiresCounts ? { result: [], count: 0 } : []);\n\t            }\n\t            if (request && this.options.batch && util_1.DataUtil.endsWith(request.url, this.options.batch) && request.type.toLowerCase() === 'post') {\n\t                var guid = xhr.getResponseHeader('Content-Type');\n\t                var cIdx = void 0;\n\t                var jsonObj = void 0;\n\t                guid = guid.substring(guid.indexOf('=batchresponse') + 1);\n\t                data = data.split(guid);\n\t                if (data.length < 2) {\n\t                    return {};\n\t                }\n\t                data = data[1];\n\t                var exVal = /(?:\\bContent-Type.+boundary=)(changesetresponse.+)/i.exec(data);\n\t                if (exVal) {\n\t                    data.replace(exVal[0], '');\n\t                }\n\t                var changeGuid = exVal ? exVal[1] : '';\n\t                data = data.split(changeGuid);\n\t                for (var i = data.length; i > -1; i--) {\n\t                    if (!/\\bContent-ID:/i.test(data[i]) || !/\\bHTTP.+201/.test(data[i])) {\n\t                        continue;\n\t                    }\n\t                    cIdx = parseInt(/\\bContent-ID: (\\d+)/i.exec(data[i])[1], 10);\n\t                    if (changes.addedRecords[cIdx]) {\n\t                        jsonObj = util_1.DataUtil.parse.parseJson(/^\\{.+\\}/m.exec(data[i])[0]);\n\t                        ej2_base_1.extend({}, changes.addedRecords[cIdx], this.processResponse(jsonObj));\n\t                    }\n\t                }\n\t                return changes;\n\t            }\n\t            return null;\n\t        };\n\t        return ODataAdaptor;\n\t    }(UrlAdaptor));\n\t    exports.ODataAdaptor = ODataAdaptor;\n\t    var ODataV4Adaptor = (function (_super) {\n\t        __extends(ODataV4Adaptor, _super);\n\t        function ODataV4Adaptor() {\n\t            var _this = _super !== null && _super.apply(this, arguments) || this;\n\t            _this.options = ej2_base_1.extend({}, _this.options, {\n\t                requestType: 'get',\n\t                accept: 'application/json, text/javascript, */*; q=0.01',\n\t                multipartAccept: 'multipart/mixed',\n\t                sortBy: '$orderby',\n\t                select: '$select',\n\t                skip: '$skip',\n\t                take: '$top',\n\t                count: '$count',\n\t                search: '$search',\n\t                where: '$filter',\n\t                expand: '$expand',\n\t                batch: '$batch',\n\t                changeSet: '--changeset_',\n\t                batchPre: 'batch_',\n\t                contentId: 'Content-Id: ',\n\t                batchContent: 'Content-Type: multipart/mixed; boundary=',\n\t                changeSetContent: 'Content-Type: application/http\\nContent-Transfer-Encoding: binary ',\n\t                batchChangeSetContentType: 'Content-Type: application/json; charset=utf-8 '\n\t            });\n\t            return _this;\n\t        }\n\t        ODataV4Adaptor.prototype.getModulename = function () {\n\t            return 'ODataV4Adaptor';\n\t        };\n\t        ;\n\t        ODataV4Adaptor.prototype.onCount = function (e) {\n\t            return e === true ? 'true' : '';\n\t        };\n\t        ODataV4Adaptor.prototype.onPredicate = function (predicate, query, requiresCast) {\n\t            var returnValue = '';\n\t            var val = predicate.value;\n\t            var isDate = val instanceof Date;\n\t            returnValue = _super.prototype.onPredicate.call(this, predicate, query, requiresCast);\n\t            if (isDate) {\n\t                returnValue = returnValue.replace(/datetime'(.*)'$/, '$1');\n\t            }\n\t            return returnValue;\n\t        };\n\t        ODataV4Adaptor.prototype.onEachSearch = function (e) {\n\t            var search = this.pvt.searches || [];\n\t            search.push(e.key);\n\t            this.pvt.searches = search;\n\t        };\n\t        ODataV4Adaptor.prototype.onSearch = function (e) {\n\t            return this.pvt.searches.join(' OR ');\n\t        };\n\t        ODataV4Adaptor.prototype.beforeSend = function (dm, request, settings) {\n\t            request.setRequestHeader('Accept', this.options.accept);\n\t        };\n\t        ODataV4Adaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n\t            var pvtData = 'pvtData';\n\t            var pvt = request && request[pvtData];\n\t            var emptyAndBatch = _super.prototype.processBatchResponse.call(this, data, query, xhr, request, changes);\n\t            if (emptyAndBatch) {\n\t                return emptyAndBatch;\n\t            }\n\t            var count = null;\n\t            var dataCount = '@odata.count';\n\t            if (query && query.requiresCounts) {\n\t                if (dataCount in data) {\n\t                    count = data[dataCount];\n\t                }\n\t            }\n\t            data = data.value;\n\t            var args = {};\n\t            args.count = count;\n\t            args.result = data;\n\t            this.getAggregateResult(pvt, data, args);\n\t            return util_1.DataUtil.isNull(count) ? args.result : { result: args.result, count: count, aggregates: args.aggregates };\n\t        };\n\t        return ODataV4Adaptor;\n\t    }(ODataAdaptor));\n\t    exports.ODataV4Adaptor = ODataV4Adaptor;\n\t    var WebApiAdaptor = (function (_super) {\n\t        __extends(WebApiAdaptor, _super);\n\t        function WebApiAdaptor() {\n\t            return _super !== null && _super.apply(this, arguments) || this;\n\t        }\n\t        WebApiAdaptor.prototype.insert = function (dm, data, tableName) {\n\t            return {\n\t                type: 'POST',\n\t                url: dm.dataSource.url,\n\t                data: JSON.stringify(data)\n\t            };\n\t        };\n\t        WebApiAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n\t            return {\n\t                type: 'DELETE',\n\t                url: dm.dataSource.url + '/' + value,\n\t                data: JSON.stringify(value)\n\t            };\n\t        };\n\t        WebApiAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n\t            return {\n\t                type: 'PUT',\n\t                url: dm.dataSource.url,\n\t                data: JSON.stringify(value)\n\t            };\n\t        };\n\t        WebApiAdaptor.prototype.beforeSend = function (dm, request, settings) {\n\t            request.setRequestHeader('Accept', 'application/json, text/javascript, */*; q=0.01');\n\t        };\n\t        WebApiAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n\t            var pvtData = 'pvtData';\n\t            var pvt = request && request[pvtData];\n\t            var count = null;\n\t            var args = {};\n\t            if (request && request.type.toLowerCase() !== 'post') {\n\t                var versionCheck = xhr && request.getResponseHeader('DataServiceVersion');\n\t                var version = (versionCheck && parseInt(versionCheck, 10)) || 2;\n\t                if (query && query.requiresCounts) {\n\t                    if (!util_1.DataUtil.isNull(data.Count)) {\n\t                        count = data.Count;\n\t                    }\n\t                }\n\t                if (version < 3 && data.Items) {\n\t                    data = data.Items;\n\t                }\n\t                args.count = count;\n\t                args.result = data;\n\t                this.getAggregateResult(pvt, data, args);\n\t            }\n\t            args.result = args.result || data;\n\t            return util_1.DataUtil.isNull(count) ? args.result : { result: args.result, count: args.count, aggregates: args.aggregates };\n\t        };\n\t        return WebApiAdaptor;\n\t    }(ODataAdaptor));\n\t    exports.WebApiAdaptor = WebApiAdaptor;\n\t    var WebMethodAdaptor = (function (_super) {\n\t        __extends(WebMethodAdaptor, _super);\n\t        function WebMethodAdaptor() {\n\t            return _super !== null && _super.apply(this, arguments) || this;\n\t        }\n\t        WebMethodAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\n\t            var obj = new UrlAdaptor().processQuery(dm, query, hierarchyFilters);\n\t            var getData = 'data';\n\t            var data = util_1.DataUtil.parse.parseJson(obj[getData]);\n\t            var result = {};\n\t            var value = 'value';\n\t            if (data.param) {\n\t                for (var i = 0; i < data.param.length; i++) {\n\t                    var param = data.param[i];\n\t                    var key = Object.keys(param)[0];\n\t                    result[key] = param[key];\n\t                }\n\t            }\n\t            result[value] = data;\n\t            var pvtData = 'pvtData';\n\t            var url = 'url';\n\t            return {\n\t                data: JSON.stringify(result),\n\t                url: obj[url],\n\t                pvtData: obj[pvtData],\n\t                type: 'POST',\n\t                contentType: 'application/json; charset=utf-8'\n\t            };\n\t        };\n\t        return WebMethodAdaptor;\n\t    }(UrlAdaptor));\n\t    exports.WebMethodAdaptor = WebMethodAdaptor;\n\t    var RemoteSaveAdaptor = (function (_super) {\n\t        __extends(RemoteSaveAdaptor, _super);\n\t        function RemoteSaveAdaptor() {\n\t            var _this = _super.call(this) || this;\n\t            ej2_base_1.setValue('beforeSend', UrlAdaptor.prototype.beforeSend, _this);\n\t            ej2_base_1.setValue('insert', UrlAdaptor.prototype.insert, _this);\n\t            ej2_base_1.setValue('update', UrlAdaptor.prototype.update, _this);\n\t            ej2_base_1.setValue('remove', UrlAdaptor.prototype.remove, _this);\n\t            return _this;\n\t        }\n\t        RemoteSaveAdaptor.prototype.batchRequest = function (dm, changes, e) {\n\t            var i;\n\t            for (i = 0; i < changes.addedRecords.length; i++) {\n\t                JsonAdaptor.prototype.insert(dm, changes.addedRecords[i]);\n\t            }\n\t            for (i = 0; i < changes.changedRecords.length; i++) {\n\t                JsonAdaptor.prototype.update(dm, e.key, changes.changedRecords[i]);\n\t            }\n\t            for (i = 0; i < changes.deletedRecords.length; i++) {\n\t                JsonAdaptor.prototype.remove(dm, e.key, changes.deletedRecords[i]);\n\t            }\n\t            return {\n\t                type: 'POST',\n\t                url: dm.dataSource.batchUrl || dm.dataSource.crudUrl || dm.dataSource.url,\n\t                contentType: 'application/json; charset=utf-8',\n\t                dataType: 'json',\n\t                data: JSON.stringify({\n\t                    changed: changes.changedRecords,\n\t                    added: changes.addedRecords,\n\t                    deleted: changes.deletedRecords,\n\t                    action: 'batch',\n\t                    table: e.url,\n\t                    key: e.key\n\t                })\n\t            };\n\t        };\n\t        return RemoteSaveAdaptor;\n\t    }(JsonAdaptor));\n\t    exports.RemoteSaveAdaptor = RemoteSaveAdaptor;\n\t    var CacheAdaptor = (function (_super) {\n\t        __extends(CacheAdaptor, _super);\n\t        function CacheAdaptor(adaptor, timeStamp, pageSize) {\n\t            var _this = _super.call(this) || this;\n\t            _this.isCrudAction = false;\n\t            _this.isInsertAction = false;\n\t            if (!ej2_base_1.isNullOrUndefined(adaptor)) {\n\t                _this.cacheAdaptor = adaptor;\n\t            }\n\t            _this.pageSize = pageSize;\n\t            _this.guidId = util_1.DataUtil.getGuid('cacheAdaptor');\n\t            var obj = { keys: [], results: [] };\n\t            window.localStorage.setItem(_this.guidId, JSON.stringify(obj));\n\t            var guid = _this.guidId;\n\t            if (!ej2_base_1.isNullOrUndefined(timeStamp)) {\n\t                setInterval(function () {\n\t                    var data;\n\t                    data = util_1.DataUtil.parse.parseJson(window.localStorage.getItem(guid));\n\t                    var forDel = [];\n\t                    for (var i = 0; i < data.results.length; i++) {\n\t                        var currentTime = +new Date();\n\t                        var requestTime = +new Date(data.results[i].timeStamp);\n\t                        data.results[i].timeStamp = currentTime - requestTime;\n\t                        if (currentTime - requestTime > timeStamp) {\n\t                            forDel.push(i);\n\t                        }\n\t                    }\n\t                    for (var i = 0; i < forDel.length; i++) {\n\t                        data.results.splice(forDel[i], 1);\n\t                        data.keys.splice(forDel[i], 1);\n\t                    }\n\t                    window.localStorage.removeItem(guid);\n\t                    window.localStorage.setItem(guid, JSON.stringify(data));\n\t                }, timeStamp);\n\t            }\n\t            return _this;\n\t        }\n\t        CacheAdaptor.prototype.generateKey = function (url, query) {\n\t            var queries = this.getQueryRequest(query);\n\t            var singles = query_1.Query.filterQueryLists(query.queries, ['onSelect', 'onPage', 'onSkip', 'onTake', 'onRange']);\n\t            var key = url;\n\t            var page = 'onPage';\n\t            if (page in singles) {\n\t                key += singles[page].pageIndex;\n\t            }\n\t            queries.sorts.forEach(function (obj) {\n\t                key += obj.e.direction + obj.e.fieldName;\n\t            });\n\t            queries.groups.forEach(function (obj) {\n\t                key += obj.e.fieldName;\n\t            });\n\t            queries.searches.forEach(function (obj) {\n\t                key += obj.e.searchKey;\n\t            });\n\t            for (var filter = 0; filter < queries.filters.length; filter++) {\n\t                var currentFilter = queries.filters[filter];\n\t                if (currentFilter.e.isComplex) {\n\t                    var newQuery = query.clone();\n\t                    newQuery.queries = [];\n\t                    for (var i = 0; i < currentFilter.e.predicates.length; i++) {\n\t                        newQuery.queries.push({ fn: 'onWhere', e: currentFilter.e.predicates[i], filter: query.queries.filter });\n\t                    }\n\t                    key += currentFilter.e.condition + this.generateKey(url, newQuery);\n\t                }\n\t                else {\n\t                    key += currentFilter.e.field + currentFilter.e.operator + currentFilter.e.value;\n\t                }\n\t            }\n\t            return key;\n\t        };\n\t        CacheAdaptor.prototype.processQuery = function (dm, query, hierarchyFilters) {\n\t            var key = this.generateKey(dm.dataSource.url, query);\n\t            var cachedItems;\n\t            cachedItems = util_1.DataUtil.parse.parseJson(window.localStorage.getItem(this.guidId));\n\t            var data = cachedItems ? cachedItems.results[cachedItems.keys.indexOf(key)] : null;\n\t            if (data != null && !this.isCrudAction && !this.isInsertAction) {\n\t                return data;\n\t            }\n\t            this.isCrudAction = null;\n\t            this.isInsertAction = null;\n\t            return this.cacheAdaptor.processQuery.apply(this.cacheAdaptor, [].slice.call(arguments, 0));\n\t        };\n\t        CacheAdaptor.prototype.processResponse = function (data, ds, query, xhr, request, changes) {\n\t            if (this.isInsertAction || (request && this.cacheAdaptor.options.batch &&\n\t                util_1.DataUtil.endsWith(request.url, this.cacheAdaptor.options.batch) && request.type.toLowerCase() === 'post')) {\n\t                return this.cacheAdaptor.processResponse(data, ds, query, xhr, request, changes);\n\t            }\n\t            data = this.cacheAdaptor.processResponse.apply(this.cacheAdaptor, [].slice.call(arguments, 0));\n\t            var key = query ? this.generateKey(ds.dataSource.url, query) : ds.dataSource.url;\n\t            var obj = {};\n\t            obj = util_1.DataUtil.parse.parseJson(window.localStorage.getItem(this.guidId));\n\t            var index = obj.keys.indexOf(key);\n\t            if (index !== -1) {\n\t                obj.results.splice(index, 1);\n\t                obj.keys.splice(index, 1);\n\t            }\n\t            obj.results[obj.keys.push(key) - 1] = { keys: key, result: data.result, timeStamp: new Date(), count: data.count };\n\t            while (obj.results.length > this.pageSize) {\n\t                obj.results.splice(0, 1);\n\t                obj.keys.splice(0, 1);\n\t            }\n\t            window.localStorage.setItem(this.guidId, JSON.stringify(obj));\n\t            return data;\n\t        };\n\t        CacheAdaptor.prototype.beforeSend = function (dm, request, settings) {\n\t            if (util_1.DataUtil.endsWith(settings.url, this.cacheAdaptor.options.batch) && settings.type.toLowerCase() === 'post') {\n\t                request.setRequestHeader('Accept', this.cacheAdaptor.options.multipartAccept);\n\t            }\n\t            if (!dm.dataSource.crossDomain) {\n\t                request.setRequestHeader('Accept', this.cacheAdaptor.options.accept);\n\t            }\n\t        };\n\t        CacheAdaptor.prototype.update = function (dm, keyField, value, tableName) {\n\t            this.isCrudAction = true;\n\t            return this.cacheAdaptor.update(dm, keyField, value, tableName);\n\t        };\n\t        CacheAdaptor.prototype.insert = function (dm, data, tableName) {\n\t            this.isInsertAction = true;\n\t            return this.cacheAdaptor.insert(dm, data, tableName);\n\t        };\n\t        CacheAdaptor.prototype.remove = function (dm, keyField, value, tableName) {\n\t            this.isCrudAction = true;\n\t            return this.cacheAdaptor.remove(dm, keyField, value, tableName);\n\t        };\n\t        CacheAdaptor.prototype.batchRequest = function (dm, changes, e) {\n\t            return this.cacheAdaptor.batchRequest(dm, changes, e);\n\t        };\n\t        return CacheAdaptor;\n\t    }(UrlAdaptor));\n\t    exports.CacheAdaptor = CacheAdaptor;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ })\n/******/ ])\n});\n;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCBjMjM2ODI2ODU5MTIzNmYyZjg0NyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiQHN5bmNmdXNpb24vZWoyLWJhc2VcIiIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvcXVlcnkuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FkYXB0b3JzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCxPO0FDVkE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQWU7QUFDZjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7Ozs7OztpRUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFrRCxjQUFjO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBQzs7Ozs7OztpRUNWRDtBQUNBO0FBQ0EsbURBQWtELGNBQWM7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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YjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFrQixrQkFBa0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUEyQixlQUFlO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Es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QUFDQTtBQUNBO0FBQ0Esd0JBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW1DLHlCQUF5QjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFtQyxtQkFBbUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQSxjQUFhO0FBQ2IsaUNBQWdDLGlDQUFpQztBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFtQyx1Q0FBdUM7QUFDMUUsZ0RBQStDLGdGQUFnRjtBQUMvSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSztBQUNMO0FBQ0EsRUFBQyIsImZpbGUiOiJlajItZGF0YS51bWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJAc3luY2Z1c2lvbi9lajItYmFzZVwiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXCJAc3luY2Z1c2lvbi9lajItYmFzZVwiXSwgZmFjdG9yeSk7XG5cdGVsc2Uge1xuXHRcdHZhciBhID0gdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnID8gZmFjdG9yeShyZXF1aXJlKFwiQHN5bmNmdXNpb24vZWoyLWJhc2VcIikpIDogZmFjdG9yeShyb290W1wiQHN5bmNmdXNpb24vZWoyLWJhc2VcIl0pO1xuXHRcdGZvcih2YXIgaSBpbiBhKSAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnID8gZXhwb3J0cyA6IHJvb3QpW2ldID0gYVtpXTtcblx0fVxufSkodGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8yX18pIHtcbnJldHVybiBcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgYzIzNjgyNjg1OTEyMzZmMmY4NDciLCJkZWZpbmUoW1wicmVxdWlyZVwiLCBcImV4cG9ydHNcIiwgXCIuL21hbmFnZXJcIiwgXCIuL3F1ZXJ5XCIsIFwiLi9hZGFwdG9yc1wiLCBcIi4vdXRpbFwiXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMsIG1hbmFnZXJfMSwgcXVlcnlfMSwgYWRhcHRvcnNfMSwgdXRpbF8xKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgZnVuY3Rpb24gX19leHBvcnQobSkge1xuICAgICAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBfX2V4cG9ydChtYW5hZ2VyXzEpO1xuICAgIF9fZXhwb3J0KHF1ZXJ5XzEpO1xuICAgIF9fZXhwb3J0KGFkYXB0b3JzXzEpO1xuICAgIF9fZXhwb3J0KHV0aWxfMSk7XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL2luZGV4LmpzXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImRlZmluZShbXCJyZXF1aXJlXCIsIFwiZXhwb3J0c1wiLCBcIkBzeW5jZnVzaW9uL2VqMi1iYXNlXCIsIFwiQHN5bmNmdXNpb24vZWoyLWJhc2VcIiwgXCIuL3V0aWxcIiwgXCIuL3F1ZXJ5XCIsIFwiLi9hZGFwdG9yc1wiXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMsIGVqMl9iYXNlXzEsIGVqMl9iYXNlXzIsIHV0aWxfMSwgcXVlcnlfMSwgYWRhcHRvcnNfMSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICB2YXIgRGF0YU1hbmFnZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmdW5jdGlvbiBEYXRhTWFuYWdlcihkYXRhU291cmNlLCBxdWVyeSwgYWRhcHRvcikge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuZGF0ZVBhcnNlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdHMgPSBbXTtcbiAgICAgICAgICAgIGlmICghZGF0YVNvdXJjZSAmJiAhdGhpcy5kYXRhU291cmNlKSB7XG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRhcHRvciA9IGFkYXB0b3IgfHwgZGF0YVNvdXJjZS5hZGFwdG9yO1xuICAgICAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgICAgICBpZiAoZGF0YVNvdXJjZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAganNvbjogZGF0YVNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgb2ZmbGluZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZGF0YVNvdXJjZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWRhdGFTb3VyY2UuanNvbikge1xuICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlLmpzb24gPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBkYXRhU291cmNlLnVybCxcbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VXJsOiBkYXRhU291cmNlLmluc2VydFVybCxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlVXJsOiBkYXRhU291cmNlLnJlbW92ZVVybCxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlVXJsOiBkYXRhU291cmNlLnVwZGF0ZVVybCxcbiAgICAgICAgICAgICAgICAgICAgY3J1ZFVybDogZGF0YVNvdXJjZS5jcnVkVXJsLFxuICAgICAgICAgICAgICAgICAgICBiYXRjaFVybDogZGF0YVNvdXJjZS5iYXRjaFVybCxcbiAgICAgICAgICAgICAgICAgICAganNvbjogZGF0YVNvdXJjZS5qc29uLFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBkYXRhU291cmNlLmhlYWRlcnMsXG4gICAgICAgICAgICAgICAgICAgIGFjY2VwdDogZGF0YVNvdXJjZS5hY2NlcHQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFTb3VyY2UuZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdGltZVRpbGxFeHBpcmF0aW9uOiBkYXRhU291cmNlLnRpbWVUaWxsRXhwaXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgY2FjaGluZ1BhZ2VTaXplOiBkYXRhU291cmNlLmNhY2hpbmdQYWdlU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ2FjaGluZzogZGF0YVNvdXJjZS5lbmFibGVDYWNoaW5nLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VHlwZTogZGF0YVNvdXJjZS5yZXF1ZXN0VHlwZSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiBkYXRhU291cmNlLmtleSxcbiAgICAgICAgICAgICAgICAgICAgY3Jvc3NEb21haW46IGRhdGFTb3VyY2UuY3Jvc3NEb21haW4sXG4gICAgICAgICAgICAgICAgICAgIGpzb25wOiBkYXRhU291cmNlLmpzb25wLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogZGF0YVNvdXJjZS5kYXRhVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgb2ZmbGluZTogZGF0YVNvdXJjZS5vZmZsaW5lICE9PSB1bmRlZmluZWQgPyBkYXRhU291cmNlLm9mZmxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIDogZGF0YVNvdXJjZS5hZGFwdG9yIGluc3RhbmNlb2YgYWRhcHRvcnNfMS5SZW1vdGVTYXZlQWRhcHRvciA/IGZhbHNlIDogZGF0YVNvdXJjZS51cmwgPyBmYWxzZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVzRm9ybWF0OiBkYXRhU291cmNlLnJlcXVpcmVzRm9ybWF0XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC50aHJvd0Vycm9yKCdEYXRhTWFuYWdlcjogSW52YWxpZCBhcmd1bWVudHMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLnJlcXVpcmVzRm9ybWF0ID09PSB1bmRlZmluZWQgJiYgIXV0aWxfMS5EYXRhVXRpbC5pc0NvcnMoKSkge1xuICAgICAgICAgICAgICAgIGRhdGEucmVxdWlyZXNGb3JtYXQgPSBlajJfYmFzZV8yLmlzTnVsbE9yVW5kZWZpbmVkKGRhdGEuY3Jvc3NEb21haW4pID8gdHJ1ZSA6IGRhdGEuY3Jvc3NEb21haW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YS5kYXRhVHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5kYXRhVHlwZSA9ICdqc29uJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZGF0YVNvdXJjZSA9IGRhdGE7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRRdWVyeSA9IHF1ZXJ5O1xuICAgICAgICAgICAgaWYgKGRhdGEudXJsICYmIGRhdGEub2ZmbGluZSAmJiAhZGF0YS5qc29uLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNEYXRhQXZhaWxhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGFwdG9yID0gYWRhcHRvciB8fCBuZXcgYWRhcHRvcnNfMS5PRGF0YUFkYXB0b3IoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2Uub2ZmbGluZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMucmVhZHkgPSB0aGlzLmV4ZWN1dGVRdWVyeShxdWVyeSB8fCBuZXcgcXVlcnlfMS5RdWVyeSgpKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlYWR5LnRoZW4oZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGF0YVNvdXJjZS5vZmZsaW5lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNEYXRhQXZhaWxhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qc29uID0gZS5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmFkYXB0b3IgPSBuZXcgYWRhcHRvcnNfMS5Kc29uQWRhcHRvcigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGFwdG9yID0gZGF0YS5vZmZsaW5lID8gbmV3IGFkYXB0b3JzXzEuSnNvbkFkYXB0b3IoKSA6IG5ldyBhZGFwdG9yc18xLk9EYXRhQWRhcHRvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFkYXRhLmpzb25wICYmIHRoaXMuYWRhcHRvciBpbnN0YW5jZW9mIGFkYXB0b3JzXzEuT0RhdGFBZGFwdG9yKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5qc29ucCA9ICdjYWxsYmFjayc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmFkYXB0b3IgPSBhZGFwdG9yIHx8IHRoaXMuYWRhcHRvcjtcbiAgICAgICAgICAgIGlmIChkYXRhLmVuYWJsZUNhY2hpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkYXB0b3IgPSBuZXcgYWRhcHRvcnNfMS5DYWNoZUFkYXB0b3IodGhpcy5hZGFwdG9yLCBkYXRhLnRpbWVUaWxsRXhwaXJhdGlvbiwgZGF0YS5jYWNoaW5nUGFnZVNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgRGF0YU1hbmFnZXIucHJvdG90eXBlLnNldERlZmF1bHRRdWVyeSA9IGZ1bmN0aW9uIChxdWVyeSkge1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0UXVlcnkgPSBxdWVyeTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhTWFuYWdlci5wcm90b3R5cGUuZXhlY3V0ZUxvY2FsID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGVmYXVsdFF1ZXJ5ICYmICEocXVlcnkgaW5zdGFuY2VvZiBxdWVyeV8xLlF1ZXJ5KSkge1xuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC50aHJvd0Vycm9yKCdEYXRhTWFuYWdlciAtIGV4ZWN1dGVMb2NhbCgpIDogQSBxdWVyeSBpcyByZXF1aXJlZCB0byBleGVjdXRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuZGF0YVNvdXJjZS5qc29uKSB7XG4gICAgICAgICAgICAgICAgdXRpbF8xLkRhdGFVdGlsLnRocm93RXJyb3IoJ0RhdGFNYW5hZ2VyIC0gZXhlY3V0ZUxvY2FsKCkgOiBKc29uIGRhdGEgaXMgcmVxdWlyZWQgdG8gZXhlY3V0ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXVlcnkgPSBxdWVyeSB8fCB0aGlzLmRlZmF1bHRRdWVyeTtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmFkYXB0b3IucHJvY2Vzc1F1ZXJ5KHRoaXMsIHF1ZXJ5KTtcbiAgICAgICAgICAgIGlmIChxdWVyeS5zdWJRdWVyeSkge1xuICAgICAgICAgICAgICAgIHZhciBmcm9tID0gcXVlcnkuc3ViUXVlcnkuZnJvbVRhYmxlO1xuICAgICAgICAgICAgICAgIHZhciBsb29rdXAgPSBxdWVyeS5zdWJRdWVyeS5sb29rdXBzO1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSBxdWVyeS5yZXF1aXJlc0NvdW50cyA/IHJlc3VsdC5yZXN1bHQgOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKGxvb2t1cCAmJiBsb29rdXAgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICB1dGlsXzEuRGF0YVV0aWwuYnVpbGRIaWVyYXJjaHkocXVlcnkuc3ViUXVlcnkuZktleSwgZnJvbSwgcmVzLCBsb29rdXAsIHF1ZXJ5LnN1YlF1ZXJ5LmtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcmVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNbal1bZnJvbV0gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2pdID0gZWoyX2Jhc2VfMi5leHRlbmQoe30sIHt9LCByZXNbal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2pdW2Zyb21dID0gdGhpcy5hZGFwdG9yLnByb2Nlc3NSZXNwb25zZShxdWVyeS5zdWJRdWVyeS51c2luZyhuZXcgRGF0YU1hbmFnZXIocmVzW2pdW2Zyb21dLnNsaWNlKDApKSkuZXhlY3V0ZUxvY2FsKCksIHRoaXMsIHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkYXB0b3IucHJvY2Vzc1Jlc3BvbnNlKHJlc3VsdCwgdGhpcywgcXVlcnkpO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhTWFuYWdlci5wcm90b3R5cGUuZXhlY3V0ZVF1ZXJ5ID0gZnVuY3Rpb24gKHF1ZXJ5LCBkb25lLCBmYWlsLCBhbHdheXMpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgYWx3YXlzID0gZmFpbDtcbiAgICAgICAgICAgICAgICBmYWlsID0gZG9uZTtcbiAgICAgICAgICAgICAgICBkb25lID0gcXVlcnk7XG4gICAgICAgICAgICAgICAgcXVlcnkgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFxdWVyeSkge1xuICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdGhpcy5kZWZhdWx0UXVlcnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIShxdWVyeSBpbnN0YW5jZW9mIHF1ZXJ5XzEuUXVlcnkpKSB7XG4gICAgICAgICAgICAgICAgdXRpbF8xLkRhdGFVdGlsLnRocm93RXJyb3IoJ0RhdGFNYW5hZ2VyIC0gZXhlY3V0ZVF1ZXJ5KCkgOiBBIHF1ZXJ5IGlzIHJlcXVpcmVkIHRvIGV4ZWN1dGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkZWZmZXJlZCA9IG5ldyBEZWZlcnJlZCgpO1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSB7IHF1ZXJ5OiBxdWVyeSB9O1xuICAgICAgICAgICAgaWYgKCF0aGlzLmRhdGFTb3VyY2Uub2ZmbGluZSAmJiB0aGlzLmRhdGFTb3VyY2UudXJsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5hZGFwdG9yLnByb2Nlc3NRdWVyeSh0aGlzLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYWtlUmVxdWVzdChyZXN1bHQsIGRlZmZlcmVkLCBhcmdzLCBxdWVyeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBEYXRhTWFuYWdlci5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBfdGhpcy5leGVjdXRlTG9jYWwocXVlcnkpO1xuICAgICAgICAgICAgICAgICAgICBhcmdzID0gRGF0YU1hbmFnZXIuZ2V0RGVmZXJlZEFyZ3MocXVlcnksIHJlcywgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoYXJncyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGVmZmVyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YU1hbmFnZXIuZ2V0RGVmZXJlZEFyZ3MgPSBmdW5jdGlvbiAocXVlcnksIHJlc3VsdCwgYXJncykge1xuICAgICAgICAgICAgaWYgKHF1ZXJ5LnJlcXVpcmVzQ291bnRzKSB7XG4gICAgICAgICAgICAgICAgYXJncy5yZXN1bHQgPSByZXN1bHQucmVzdWx0O1xuICAgICAgICAgICAgICAgIGFyZ3MuY291bnQgPSByZXN1bHQuY291bnQ7XG4gICAgICAgICAgICAgICAgYXJncy5hZ2dyZWdhdGVzID0gcmVzdWx0LmFnZ3JlZ2F0ZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcmdzLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhcmdzO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhTWFuYWdlci5uZXh0VGljayA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgKHdpbmRvdy5zZXRJbW1lZGlhdGUgfHwgd2luZG93LnNldFRpbWVvdXQpKGZuLCAwKTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YU1hbmFnZXIucHJvdG90eXBlLmV4dGVuZFJlcXVlc3QgPSBmdW5jdGlvbiAodXJsLCBmblN1Y2Nlc3MsIGZuRmFpbCkge1xuICAgICAgICAgICAgcmV0dXJuIGVqMl9iYXNlXzIuZXh0ZW5kKHt9LCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IHRoaXMuZGF0YVNvdXJjZS5kYXRhVHlwZSxcbiAgICAgICAgICAgICAgICBjcm9zc0RvbWFpbjogdGhpcy5kYXRhU291cmNlLmNyb3NzRG9tYWluLFxuICAgICAgICAgICAgICAgIGpzb25wOiB0aGlzLmRhdGFTb3VyY2UuanNvbnAsXG4gICAgICAgICAgICAgICAgY2FjaGU6IHRydWUsXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG9uU3VjY2VzczogZm5TdWNjZXNzLFxuICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogZm5GYWlsXG4gICAgICAgICAgICB9LCB1cmwpO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhTWFuYWdlci5wcm90b3R5cGUubWFrZVJlcXVlc3QgPSBmdW5jdGlvbiAodXJsLCBkZWZmZXJlZCwgYXJncywgcXVlcnkpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaXNTZWxlY3RvciA9ICEhcXVlcnkuc3ViUXVlcnlTZWxlY3RvcjtcbiAgICAgICAgICAgIHZhciBmbkZhaWwgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGFyZ3MuZXJyb3IgPSBlO1xuICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChhcmdzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgcHJvY2VzcyA9IGZ1bmN0aW9uIChkYXRhLCBjb3VudCwgeGhyLCByZXF1ZXN0LCBhY3R1YWwsIGFnZ3JlZ2F0ZXMsIHZpcnR1YWxTZWxlY3RSZWNvcmRzKSB7XG4gICAgICAgICAgICAgICAgYXJncy54aHIgPSB4aHI7XG4gICAgICAgICAgICAgICAgYXJncy5jb3VudCA9IGNvdW50ID8gcGFyc2VJbnQoY291bnQudG9TdHJpbmcoKSwgMTApIDogMDtcbiAgICAgICAgICAgICAgICBhcmdzLnJlc3VsdCA9IGRhdGE7XG4gICAgICAgICAgICAgICAgYXJncy5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICAgICAgICAgICAgICBhcmdzLmFnZ3JlZ2F0ZXMgPSBhZ2dyZWdhdGVzO1xuICAgICAgICAgICAgICAgIGFyZ3MuYWN0dWFsID0gYWN0dWFsO1xuICAgICAgICAgICAgICAgIGFyZ3MudmlydHVhbFNlbGVjdFJlY29yZHMgPSB2aXJ0dWFsU2VsZWN0UmVjb3JkcztcbiAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZXNvbHZlKGFyZ3MpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBmblF1ZXJ5Q2hpbGQgPSBmdW5jdGlvbiAoZGF0YSwgc2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3ViRGVmZmVyID0gbmV3IERlZmVycmVkKCk7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkQXJncyA9IHsgcGFyZW50OiBhcmdzIH07XG4gICAgICAgICAgICAgICAgcXVlcnkuc3ViUXVlcnkuaXNDaGlsZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdmFyIHN1YlVybCA9IF90aGlzLmFkYXB0b3IucHJvY2Vzc1F1ZXJ5KF90aGlzLCBxdWVyeS5zdWJRdWVyeSwgZGF0YSA/IF90aGlzLmFkYXB0b3IucHJvY2Vzc1Jlc3BvbnNlKGRhdGEpIDogc2VsZWN0b3IpO1xuICAgICAgICAgICAgICAgIHZhciBjaGlsZFJlcSA9IF90aGlzLm1ha2VSZXF1ZXN0KHN1YlVybCwgc3ViRGVmZmVyLCBjaGlsZEFyZ3MsIHF1ZXJ5LnN1YlF1ZXJ5KTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgc3ViRGVmZmVyLnRoZW4oZnVuY3Rpb24gKHN1YkRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbF8xLkRhdGFVdGlsLmJ1aWxkSGllcmFyY2h5KHF1ZXJ5LnN1YlF1ZXJ5LmZLZXksIHF1ZXJ5LnN1YlF1ZXJ5LmZyb21UYWJsZSwgZGF0YSwgc3ViRGF0YSwgcXVlcnkuc3ViUXVlcnkua2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzKGRhdGEsIHN1YkRhdGEuY291bnQsIHN1YkRhdGEueGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgZm5GYWlsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkUmVxO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBmblN1Y2Nlc3MgPSBmdW5jdGlvbiAoZGF0YSwgcmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0Lmh0dHBSZXF1ZXN0LmdldFJlc3BvbnNlSGVhZGVyKCdDb250ZW50LVR5cGUnKS5pbmRleE9mKCd4bWwnKSA9PT0gLTEgJiYgX3RoaXMuZGF0ZVBhcnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSB1dGlsXzEuRGF0YVV0aWwucGFyc2UucGFyc2VKc29uKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gX3RoaXMuYWRhcHRvci5wcm9jZXNzUmVzcG9uc2UoZGF0YSwgX3RoaXMsIHF1ZXJ5LCByZXF1ZXN0Lmh0dHBSZXF1ZXN0LCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBhZ2dyZWdhdGVzID0gbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIgdmlydHVhbFNlbGVjdFJlY29yZHMgPSAndmlydHVhbFNlbGVjdFJlY29yZHMnO1xuICAgICAgICAgICAgICAgIHZhciB2aXJ0dWFsUmVjb3JkcyA9IGRhdGFbdmlydHVhbFNlbGVjdFJlY29yZHNdO1xuICAgICAgICAgICAgICAgIGlmIChxdWVyeS5yZXF1aXJlc0NvdW50cykge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IHJlc3VsdC5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRlcyA9IHJlc3VsdC5hZ2dyZWdhdGVzO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQucmVzdWx0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXF1ZXJ5LnN1YlF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3MocmVzdWx0LCBjb3VudCwgcmVxdWVzdC5odHRwUmVxdWVzdCwgcmVxdWVzdC50eXBlLCBkYXRhLCBhZ2dyZWdhdGVzLCB2aXJ0dWFsUmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFpc1NlbGVjdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGZuUXVlcnlDaGlsZChyZXN1bHQsIHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgcmVxID0gdGhpcy5leHRlbmRSZXF1ZXN0KHVybCwgZm5TdWNjZXNzLCBmbkZhaWwpO1xuICAgICAgICAgICAgdmFyIGFqYXggPSBuZXcgZWoyX2Jhc2VfMS5BamF4KHJlcSk7XG4gICAgICAgICAgICBhamF4LmJlZm9yZVNlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuYmVmb3JlU2VuZChhamF4Lmh0dHBSZXF1ZXN0LCBhamF4KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXEgPSBhamF4LnNlbmQoKTtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdHMucHVzaChhamF4KTtcbiAgICAgICAgICAgIGlmIChpc1NlbGVjdG9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSB2b2lkIDA7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHF1ZXJ5LnN1YlF1ZXJ5U2VsZWN0b3IuY2FsbCh0aGlzLCB7IHF1ZXJ5OiBxdWVyeS5zdWJRdWVyeSwgcGFyZW50OiBxdWVyeSB9KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IFByb21pc2UuYWxsKFtyZXEsIGZuUXVlcnlDaGlsZChudWxsLCByZXMpXSk7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXJnc1swXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwUmVzdWx0ID0gX3RoaXMuYWRhcHRvci5wcm9jZXNzUmVzcG9uc2UocmVzdWx0WzBdLCBfdGhpcywgcXVlcnksIF90aGlzLnJlcXVlc3RzWzBdLmh0dHBSZXF1ZXN0LCBfdGhpcy5yZXF1ZXN0c1swXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXJ5LnJlcXVpcmVzQ291bnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQgPSBwUmVzdWx0LmNvdW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBSZXN1bHQgPSBwUmVzdWx0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjUmVzdWx0ID0gX3RoaXMuYWRhcHRvci5wcm9jZXNzUmVzcG9uc2UocmVzdWx0WzFdLCBfdGhpcywgcXVlcnkuc3ViUXVlcnksIF90aGlzLnJlcXVlc3RzWzFdLmh0dHBSZXF1ZXN0LCBfdGhpcy5yZXF1ZXN0c1sxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnkuc3ViUXVlcnkucmVxdWlyZXNDb3VudHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IGNSZXN1bHQuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY1Jlc3VsdCA9IGNSZXN1bHQucmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdXRpbF8xLkRhdGFVdGlsLmJ1aWxkSGllcmFyY2h5KHF1ZXJ5LnN1YlF1ZXJ5LmZLZXksIHF1ZXJ5LnN1YlF1ZXJ5LmZyb21UYWJsZSwgcFJlc3VsdCwgY1Jlc3VsdCwgcXVlcnkuc3ViUXVlcnkua2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0b3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MocFJlc3VsdCwgY291bnQsIF90aGlzLnJlcXVlc3RzWzBdLmh0dHBSZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpc1NlbGVjdG9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlcTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YU1hbmFnZXIucHJvdG90eXBlLmJlZm9yZVNlbmQgPSBmdW5jdGlvbiAocmVxdWVzdCwgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHRoaXMuYWRhcHRvci5iZWZvcmVTZW5kKHRoaXMsIHJlcXVlc3QsIHNldHRpbmdzKTtcbiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gdGhpcy5kYXRhU291cmNlLmhlYWRlcnM7XG4gICAgICAgICAgICB2YXIgcHJvcHM7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaGVhZGVycyAmJiBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHByb3BzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhoZWFkZXJzW2ldKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGtleXNfMSA9IGtleXM7IF9pIDwga2V5c18xLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IGtleXNfMVtfaV07XG4gICAgICAgICAgICAgICAgICAgIHByb3BzLnB1c2gocHJvcCk7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcihwcm9wLCBoZWFkZXJzW2ldW3Byb3BdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIERhdGFNYW5hZ2VyLnByb3RvdHlwZS5zYXZlQ2hhbmdlcyA9IGZ1bmN0aW9uIChjaGFuZ2VzLCBrZXksIHRhYmxlTmFtZSwgcXVlcnkpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBpZiAodGFibGVOYW1lIGluc3RhbmNlb2YgcXVlcnlfMS5RdWVyeSkge1xuICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdGFibGVOYW1lO1xuICAgICAgICAgICAgICAgIHRhYmxlTmFtZSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYXJncyA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICBrZXk6IGtleSB8fCB0aGlzLmRhdGFTb3VyY2Uua2V5XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIHJlcSA9IHRoaXMuYWRhcHRvci5iYXRjaFJlcXVlc3QodGhpcywgY2hhbmdlcywgYXJncywgcXVlcnkpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YVNvdXJjZS5vZmZsaW5lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkZWZmID0gbmV3IERlZmVycmVkKCk7XG4gICAgICAgICAgICB2YXIgYWpheCA9IG5ldyBlajJfYmFzZV8xLkFqYXgocmVxKTtcbiAgICAgICAgICAgIGFqYXguYmVmb3JlU2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5iZWZvcmVTZW5kKGFqYXguaHR0cFJlcXVlc3QsIGFqYXgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGFqYXgub25TdWNjZXNzID0gZnVuY3Rpb24gKGRhdGEsIHJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICBkZWZmLnJlc29sdmUoX3RoaXMsIFtfdGhpcy5hZGFwdG9yLnByb2Nlc3NSZXNwb25zZShkYXRhLCBfdGhpcywgbnVsbCwgcmVxdWVzdC5odHRwUmVxdWVzdCwgcmVxdWVzdCwgY2hhbmdlcyldKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhamF4Lm9uRmFpbHVyZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZGVmZi5yZWplY3QoW3sgZXJyb3I6IGUgfV0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGFqYXguc2VuZCgpO1xuICAgICAgICAgICAgcmV0dXJuIGRlZmYucHJvbWlzZTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YU1hbmFnZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChkYXRhLCB0YWJsZU5hbWUsIHF1ZXJ5LCBwb3NpdGlvbikge1xuICAgICAgICAgICAgZGF0YSA9IHV0aWxfMS5EYXRhVXRpbC5wYXJzZS5yZXBsYWNlcihkYXRhKTtcbiAgICAgICAgICAgIGlmICh0YWJsZU5hbWUgaW5zdGFuY2VvZiBxdWVyeV8xLlF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgcXVlcnkgPSB0YWJsZU5hbWU7XG4gICAgICAgICAgICAgICAgdGFibGVOYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXEgPSB0aGlzLmFkYXB0b3IuaW5zZXJ0KHRoaXMsIGRhdGEsIHRhYmxlTmFtZSwgcXVlcnksIHBvc2l0aW9uKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGFTb3VyY2Uub2ZmbGluZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kb0FqYXhSZXF1ZXN0KHJlcSk7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFNYW5hZ2VyLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoa2V5RmllbGQsIHZhbHVlLCB0YWJsZU5hbWUsIHF1ZXJ5KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWVba2V5RmllbGRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhYmxlTmFtZSBpbnN0YW5jZW9mIHF1ZXJ5XzEuUXVlcnkpIHtcbiAgICAgICAgICAgICAgICBxdWVyeSA9IHRhYmxlTmFtZTtcbiAgICAgICAgICAgICAgICB0YWJsZU5hbWUgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlcyA9IHRoaXMuYWRhcHRvci5yZW1vdmUodGhpcywga2V5RmllbGQsIHZhbHVlLCB0YWJsZU5hbWUsIHF1ZXJ5KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGFTb3VyY2Uub2ZmbGluZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kb0FqYXhSZXF1ZXN0KHJlcyk7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFNYW5hZ2VyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoa2V5RmllbGQsIHZhbHVlLCB0YWJsZU5hbWUsIHF1ZXJ5KSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHV0aWxfMS5EYXRhVXRpbC5wYXJzZS5yZXBsYWNlcih2YWx1ZSwgIXRoaXMuZGF0YVNvdXJjZS5vZmZsaW5lKTtcbiAgICAgICAgICAgIGlmICh0YWJsZU5hbWUgaW5zdGFuY2VvZiBxdWVyeV8xLlF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgcXVlcnkgPSB0YWJsZU5hbWU7XG4gICAgICAgICAgICAgICAgdGFibGVOYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXMgPSB0aGlzLmFkYXB0b3IudXBkYXRlKHRoaXMsIGtleUZpZWxkLCB2YWx1ZSwgdGFibGVOYW1lLCBxdWVyeSk7XG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhU291cmNlLm9mZmxpbmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9BamF4UmVxdWVzdChyZXMpO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhTWFuYWdlci5wcm90b3R5cGUuZG9BamF4UmVxdWVzdCA9IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgZGVmZXIgPSBuZXcgRGVmZXJyZWQoKTtcbiAgICAgICAgICAgIHJlcyA9IGVqMl9iYXNlXzIuZXh0ZW5kKHt9LCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlXG4gICAgICAgICAgICB9LCByZXMpO1xuICAgICAgICAgICAgdmFyIGFqYXggPSBuZXcgZWoyX2Jhc2VfMS5BamF4KHJlcyk7XG4gICAgICAgICAgICBhamF4LmJlZm9yZVNlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuYmVmb3JlU2VuZChhamF4Lmh0dHBSZXF1ZXN0LCBhamF4KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhamF4Lm9uU3VjY2VzcyA9IGZ1bmN0aW9uIChyZWNvcmQsIHJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB1dGlsXzEuRGF0YVV0aWwucGFyc2UucGFyc2VKc29uKHJlY29yZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY29yZCA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZWNvcmQgPSBfdGhpcy5hZGFwdG9yLnByb2Nlc3NSZXNwb25zZSh1dGlsXzEuRGF0YVV0aWwucGFyc2UucGFyc2VKc29uKHJlY29yZCksIF90aGlzLCBudWxsLCByZXF1ZXN0Lmh0dHBSZXF1ZXN0LCByZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKF90aGlzLCBbeyByZWNvcmQ6IHJlY29yZCwgZGF0YU1hbmFnZXI6IF90aGlzIH1dKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhamF4Lm9uRmFpbHVyZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KFt7IGVycm9yOiBlIH1dKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhamF4LnNlbmQoKTtcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gRGF0YU1hbmFnZXI7XG4gICAgfSgpKTtcbiAgICBleHBvcnRzLkRhdGFNYW5hZ2VyID0gRGF0YU1hbmFnZXI7XG4gICAgdmFyIERlZmVycmVkID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gRGVmZXJyZWQoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnJlc29sdmUgPSByZXNvbHZlO1xuICAgICAgICAgICAgICAgIF90aGlzLnJlamVjdCA9IHJlamVjdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy50aGVuID0gdGhpcy5wcm9taXNlLnRoZW4uYmluZCh0aGlzLnByb21pc2UpO1xuICAgICAgICAgICAgdGhpcy5jYXRjaCA9IHRoaXMucHJvbWlzZS5jYXRjaC5iaW5kKHRoaXMucHJvbWlzZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIERlZmVycmVkO1xuICAgIH0oKSk7XG4gICAgZXhwb3J0cy5EZWZlcnJlZCA9IERlZmVycmVkO1xufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9tYW5hZ2VyLmpzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV8yX187XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJAc3luY2Z1c2lvbi9lajItYmFzZVwiXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImRlZmluZShbXCJyZXF1aXJlXCIsIFwiZXhwb3J0c1wiLCBcIkBzeW5jZnVzaW9uL2VqMi1iYXNlXCIsIFwiLi9tYW5hZ2VyXCIsIFwiLi9xdWVyeVwiXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMsIGVqMl9iYXNlXzEsIG1hbmFnZXJfMSwgcXVlcnlfMSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICB2YXIgY29uc3RzID0geyBHcm91cEd1aWQ6ICd7MjcxYmJiYTAtMWVlN30nIH07XG4gICAgdmFyIERhdGFVdGlsID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gRGF0YVV0aWwoKSB7XG4gICAgICAgIH1cbiAgICAgICAgRGF0YVV0aWwuZ2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUsIGluc3QpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuY2FsbChpbnN0IHx8IHt9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YVV0aWwuZW5kc1dpdGggPSBmdW5jdGlvbiAoaW5wdXQsIHN1YnN0cikge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LnNsaWNlKC1zdWJzdHIubGVuZ3RoKSA9PT0gc3Vic3RyO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5zdGFydHNXaXRoID0gZnVuY3Rpb24gKGlucHV0LCBzdGFydCkge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LnNsaWNlKDAsIHN0YXJ0Lmxlbmd0aCkgPT09IHN0YXJ0O1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5mblNvcnQgPSBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgIG9yZGVyID0gb3JkZXIgPyBvcmRlci50b0xvd2VyQ2FzZSgpIDogJ2FzY2VuZGluZyc7XG4gICAgICAgICAgICBpZiAob3JkZXIgPT09ICdhc2NlbmRpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm5Bc2NlbmRpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mbkRlc2NlbmRpbmc7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFVdGlsLmZuQXNjZW5kaW5nID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgICAgIGlmICh5ID09PSBudWxsIHx8IHkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgeCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geC5sb2NhbGVDb21wYXJlKHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHggPT09IG51bGwgfHwgeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geCAtIHk7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFVdGlsLmZuRGVzY2VuZGluZyA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICBpZiAoeSA9PT0gbnVsbCB8fCB5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgeCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geC5sb2NhbGVDb21wYXJlKHkpICogLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoeCA9PT0gbnVsbCB8fCB4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geSAtIHg7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFVdGlsLmV4dHJhY3RGaWVsZHMgPSBmdW5jdGlvbiAob2JqLCBmaWVsZHMpIHtcbiAgICAgICAgICAgIHZhciBuZXdPYmogPSB7fTtcbiAgICAgICAgICAgIGlmIChmaWVsZHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0KGZpZWxkc1swXSwgb2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbmV3T2JqW2ZpZWxkc1tpXS5yZXBsYWNlKCcuJywgJ18nKV0gPSB0aGlzLmdldE9iamVjdChmaWVsZHNbaV0sIG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3T2JqO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5zZWxlY3QgPSBmdW5jdGlvbiAoanNvbkFycmF5LCBmaWVsZHMpIHtcbiAgICAgICAgICAgIHZhciBuZXdEYXRhID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGpzb25BcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG5ld0RhdGEucHVzaCh0aGlzLmV4dHJhY3RGaWVsZHMoanNvbkFycmF5W2ldLCBmaWVsZHMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXdEYXRhO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5ncm91cCA9IGZ1bmN0aW9uIChqc29uQXJyYXksIGZpZWxkLCBhZ2dyZWdhdGVzLCBsZXZlbCwgZ3JvdXBEcykge1xuICAgICAgICAgICAgbGV2ZWwgPSBsZXZlbCB8fCAxO1xuICAgICAgICAgICAgdmFyIGpzb25EYXRhID0ganNvbkFycmF5O1xuICAgICAgICAgICAgdmFyIGd1aWQgPSAnR3JvdXBHdWlkJztcbiAgICAgICAgICAgIGlmIChqc29uRGF0YS5Hcm91cEd1aWQgPT09IGNvbnN0c1tndWlkXSkge1xuICAgICAgICAgICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKGopIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlajJfYmFzZV8xLmlzTnVsbE9yVW5kZWZpbmVkKGdyb3VwRHMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5keCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBncm91cERzLmZpbHRlcihmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5rZXkgPT09IGpzb25EYXRhW2pdLmtleTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmR4ID0gZ3JvdXBEcy5pbmRleE9mKHRlbXBbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGFbal0uaXRlbXMgPSB0aGlzXzEuZ3JvdXAoanNvbkRhdGFbal0uaXRlbXMsIGZpZWxkLCBhZ2dyZWdhdGVzLCBqc29uRGF0YS5sZXZlbCArIDEsIGdyb3VwRHNbaW5keF0uaXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGFbal0uY291bnQgPSBncm91cERzW2luZHhdLmNvdW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGFbal0uaXRlbXMgPSB0aGlzXzEuZ3JvdXAoanNvbkRhdGFbal0uaXRlbXMsIGZpZWxkLCBhZ2dyZWdhdGVzLCBqc29uRGF0YS5sZXZlbCArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGFbal0uY291bnQgPSBqc29uRGF0YVtqXS5pdGVtcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciB0aGlzXzEgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwganNvbkRhdGEubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgX2xvb3BfMShqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAganNvbkRhdGEuY2hpbGRMZXZlbHMgKz0gMTtcbiAgICAgICAgICAgICAgICByZXR1cm4ganNvbkRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZ3JvdXBlZCA9IHt9O1xuICAgICAgICAgICAgdmFyIGdyb3VwZWRBcnJheSA9IFtdO1xuICAgICAgICAgICAgZ3JvdXBlZEFycmF5Lkdyb3VwR3VpZCA9IGNvbnN0c1tndWlkXTtcbiAgICAgICAgICAgIGdyb3VwZWRBcnJheS5sZXZlbCA9IGxldmVsO1xuICAgICAgICAgICAgZ3JvdXBlZEFycmF5LmNoaWxkTGV2ZWxzID0gMDtcbiAgICAgICAgICAgIGdyb3VwZWRBcnJheS5yZWNvcmRzID0ganNvbkRhdGE7XG4gICAgICAgICAgICB2YXIgX2xvb3BfMiA9IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IHRoaXNfMi5nZXRWYWwoanNvbkRhdGEsIGksIGZpZWxkKTtcbiAgICAgICAgICAgICAgICBpZiAoIWdyb3VwZWRbdmFsXSkge1xuICAgICAgICAgICAgICAgICAgICBncm91cGVkW3ZhbF0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHZhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRlczoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogZmllbGRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBlZEFycmF5LnB1c2goZ3JvdXBlZFt2YWxdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlajJfYmFzZV8xLmlzTnVsbE9yVW5kZWZpbmVkKGdyb3VwRHMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcE9iaiA9IGdyb3VwRHMuZmlsdGVyKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmtleSA9PT0gZ3JvdXBlZFt2YWxdLmtleTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cGVkW3ZhbF0uY291bnQgPSB0ZW1wT2JqWzBdLmNvdW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGdyb3VwZWRbdmFsXS5jb3VudCA9ICFlajJfYmFzZV8xLmlzTnVsbE9yVW5kZWZpbmVkKGdyb3VwRHMpID8gZ3JvdXBlZFt2YWxdLmNvdW50IDogZ3JvdXBlZFt2YWxdLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgZ3JvdXBlZFt2YWxdLml0ZW1zLnB1c2goanNvbkRhdGFbaV0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciB0aGlzXzIgPSB0aGlzO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqc29uRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIF9sb29wXzIoaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYWdncmVnYXRlcyAmJiBhZ2dyZWdhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhciBfbG9vcF8zID0gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm4gPSB2b2lkIDA7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhZ2dzID0gYWdncmVnYXRlcztcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBhZ2dyZWdhdGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbiA9IERhdGFVdGlsLmFnZ3JlZ2F0ZXNbYWdncmVnYXRlc1tqXS50eXBlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZChncm91cERzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gZ3JvdXBEcy5maWx0ZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUua2V5ID09PSBncm91cGVkQXJyYXlbaV0ua2V5OyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2FnZ3Nbal0uZmllbGQgKyAnIC0gJyArIGFnZ3Nbal0udHlwZV0gPSBmbih0ZW1wWzBdLml0ZW1zLCBhZ2dzW2pdLmZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2FnZ3Nbal0uZmllbGQgKyAnIC0gJyArIGFnZ3Nbal0udHlwZV0gPSBmbihncm91cGVkQXJyYXlbaV0uaXRlbXMsIGFnZ3Nbal0uZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBncm91cGVkQXJyYXlbaV0uYWdncmVnYXRlcyA9IHJlcztcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBlZEFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIF9sb29wXzMoaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGdyb3VwZWRBcnJheTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YVV0aWwuYnVpbGRIaWVyYXJjaHkgPSBmdW5jdGlvbiAoZktleSwgZnJvbSwgc291cmNlLCBsb29rdXAsIHBLZXkpIHtcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgdmFyIGdycCA9IHt9O1xuICAgICAgICAgICAgdmFyIHRlbXA7XG4gICAgICAgICAgICBpZiAobG9va3VwLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGxvb2t1cCA9IGxvb2t1cC5yZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobG9va3VwLkdyb3VwR3VpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGhyb3dFcnJvcignRGF0YU1hbmFnZXI6IERvIG5vdCBoYXZlIHN1cHBvcnQgR3JvdXBpbmcgaW4gaGllcmFyY2h5Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbG9va3VwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZLZXlEYXRhID0gdGhpcy5nZXRPYmplY3QoZktleSwgbG9va3VwW2ldKTtcbiAgICAgICAgICAgICAgICB0ZW1wID0gZ3JwW2ZLZXlEYXRhXSB8fCAoZ3JwW2ZLZXlEYXRhXSA9IFtdKTtcbiAgICAgICAgICAgICAgICB0ZW1wLnB1c2gobG9va3VwW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzb3VyY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgZktleURhdGEgPSB0aGlzLmdldE9iamVjdChwS2V5IHx8IGZLZXksIHNvdXJjZVtpXSk7XG4gICAgICAgICAgICAgICAgc291cmNlW2ldW2Zyb21dID0gZ3JwW2ZLZXlEYXRhXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgRGF0YVV0aWwuZ2V0RmllbGRMaXN0ID0gZnVuY3Rpb24gKG9iaiwgZmllbGRzLCBwcmVmaXgpIHtcbiAgICAgICAgICAgIGlmIChwcmVmaXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHByZWZpeCA9ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkcyA9PT0gdW5kZWZpbmVkIHx8IGZpZWxkcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkTGlzdChvYmosIFtdLCBwcmVmaXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNvcHlPYmogPSBvYmo7XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGtleXNfMSA9IGtleXM7IF9pIDwga2V5c18xLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciBwcm9wID0ga2V5c18xW19pXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvcHlPYmpbcHJvcF0gPT09ICdvYmplY3QnICYmICEoY29weU9ialtwcm9wXSBpbnN0YW5jZW9mIEFycmF5KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZpZWxkTGlzdChjb3B5T2JqW3Byb3BdLCBmaWVsZHMsIHByZWZpeCArIHByb3AgKyAnLicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2gocHJlZml4ICsgcHJvcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpZWxkcztcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YVV0aWwuZ2V0T2JqZWN0ID0gZnVuY3Rpb24gKG5hbWVTcGFjZSwgZnJvbSkge1xuICAgICAgICAgICAgaWYgKCFuYW1lU3BhY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnJvbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChuYW1lU3BhY2UuaW5kZXhPZignLicpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmcm9tW25hbWVTcGFjZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBmcm9tO1xuICAgICAgICAgICAgdmFyIHNwbGl0cyA9IG5hbWVTcGFjZS5zcGxpdCgnLicpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZVtzcGxpdHNbaV1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5zb3J0ID0gZnVuY3Rpb24gKGRzLCBmaWVsZCwgY29tcGFyZXIpIHtcbiAgICAgICAgICAgIGlmIChkcy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBtaWRkbGUgPSBwYXJzZUludCgoZHMubGVuZ3RoIC8gMikudG9TdHJpbmcoKSwgMTApO1xuICAgICAgICAgICAgdmFyIGxlZnQgPSBkcy5zbGljZSgwLCBtaWRkbGUpO1xuICAgICAgICAgICAgdmFyIHJpZ2h0ID0gZHMuc2xpY2UobWlkZGxlKTtcbiAgICAgICAgICAgIGxlZnQgPSB0aGlzLnNvcnQobGVmdCwgZmllbGQsIGNvbXBhcmVyKTtcbiAgICAgICAgICAgIHJpZ2h0ID0gdGhpcy5zb3J0KHJpZ2h0LCBmaWVsZCwgY29tcGFyZXIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVyZ2UobGVmdCwgcmlnaHQsIGZpZWxkLCBjb21wYXJlcik7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFVdGlsLm1lcmdlID0gZnVuY3Rpb24gKGxlZnQsIHJpZ2h0LCBmaWVsZE5hbWUsIGNvbXBhcmVyKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgICAgICB2YXIgY3VycmVudDtcbiAgICAgICAgICAgIHdoaWxlIChsZWZ0Lmxlbmd0aCA+IDAgfHwgcmlnaHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChsZWZ0Lmxlbmd0aCA+IDAgJiYgcmlnaHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGFyZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjb21wYXJlcih0aGlzLmdldFZhbChsZWZ0LCAwLCBmaWVsZE5hbWUpLCB0aGlzLmdldFZhbChyaWdodCwgMCwgZmllbGROYW1lKSkgPD0gMCA/IGxlZnQgOiByaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBsZWZ0WzBdW2ZpZWxkTmFtZV0gPCBsZWZ0WzBdW2ZpZWxkTmFtZV0gPyBsZWZ0IDogcmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBsZWZ0Lmxlbmd0aCA+IDAgPyBsZWZ0IDogcmlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGN1cnJlbnQuc2hpZnQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5nZXRWYWwgPSBmdW5jdGlvbiAoYXJyYXksIGluZGV4LCBmaWVsZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZpZWxkID8gdGhpcy5nZXRPYmplY3QoZmllbGQsIGFycmF5W2luZGV4XSkgOiBhcnJheVtpbmRleF07XG4gICAgICAgIH07XG4gICAgICAgIERhdGFVdGlsLnRvTG93ZXJDYXNlID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbCA/IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gdmFsLnRvTG93ZXJDYXNlKCkgOiB2YWwudG9TdHJpbmcoKSA6ICh2YWwgPT09IDAgfHwgdmFsID09PSBmYWxzZSkgPyB2YWwudG9TdHJpbmcoKSA6ICcnO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGFkYXB0b3IsIGZuTmFtZSwgcGFyYW0xLCBwYXJhbTIpIHtcbiAgICAgICAgICAgIGlmIChmbk5hbWUgaW4gYWRhcHRvcikge1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSBhZGFwdG9yW2ZuTmFtZV0ocGFyYW0xLCBwYXJhbTIpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5mbk9wZXJhdG9ycy5pc251bGwocmVzKSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbTEgPSByZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHBhcmFtMTtcbiAgICAgICAgfTtcbiAgICAgICAgRGF0YVV0aWwuaXNQbGFpbk9iamVjdCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHJldHVybiAoISFvYmopICYmIChvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCk7XG4gICAgICAgIH07XG4gICAgICAgIERhdGFVdGlsLmlzQ29ycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB4aHIgPSBudWxsO1xuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSAnWE1MSHR0cFJlcXVlc3QnO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB4aHIgPSBuZXcgd2luZG93W3JlcXVlc3RdKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICEheGhyICYmICgnd2l0aENyZWRlbnRpYWxzJyBpbiB4aHIpO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5nZXRHdWlkID0gZnVuY3Rpb24gKHByZWZpeCkge1xuICAgICAgICAgICAgdmFyIGhleHMgPSAnMDEyMzQ1Njc4OWFiY2RlZic7XG4gICAgICAgICAgICB2YXIgcmFuZDtcbiAgICAgICAgICAgIHJldHVybiAocHJlZml4IHx8ICcnKSArICcwMDAwMDAwMC0wMDAwLTQwMDAtMDAwMC0wMDAwMDAwMDAwMDAnLnJlcGxhY2UoLzAvZywgZnVuY3Rpb24gKHZhbCwgaSkge1xuICAgICAgICAgICAgICAgIGlmICgnY3J5cHRvJyBpbiB3aW5kb3cgJiYgJ2dldFJhbmRvbVZhbHVlcycgaW4gY3J5cHRvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnIgPSBuZXcgVWludDhBcnJheSgxKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyKTtcbiAgICAgICAgICAgICAgICAgICAgcmFuZCA9IGFyclswXSAlIDE2IHwgMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmQgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaGV4c1tpID09PSAxOSA/IHJhbmQgJiAweDMgfCAweDggOiByYW5kXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5pc051bGwgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSBudWxsO1xuICAgICAgICB9O1xuICAgICAgICBEYXRhVXRpbC5nZXRJdGVtRnJvbUNvbXBhcmVyID0gZnVuY3Rpb24gKGFycmF5LCBmaWVsZCwgY29tcGFyZXIpIHtcbiAgICAgICAgICAgIHZhciBrZXlWYWw7XG4gICAgICAgICAgICB2YXIgY3VycmVudDtcbiAgICAgICAgICAgIHZhciBrZXk7XG4gICAgICAgICAgICB2YXIgaSA9IDA7XG4gICAgICAgICAgICB2YXIgY2FzdFJlcXVpcmVkID0gdHlwZW9mIERhdGFVdGlsLmdldFZhbChhcnJheSwgMCwgZmllbGQpID09PSAnc3RyaW5nJztcbiAgICAgICAgICAgIGlmIChhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZChrZXlWYWwpICYmIGkgPCBhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAga2V5VmFsID0gRGF0YVV0aWwuZ2V0VmFsKGFycmF5LCBpLCBmaWVsZCk7XG4gICAgICAgICAgICAgICAgICAgIGtleSA9IGFycmF5W2krK107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICg7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBEYXRhVXRpbC5nZXRWYWwoYXJyYXksIGksIGZpZWxkKTtcbiAgICAgICAgICAgICAgICBpZiAoZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZChjdXJyZW50KSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNhc3RSZXF1aXJlZCkge1xuICAgICAgICAgICAgICAgICAgICBrZXlWYWwgPSAra2V5VmFsO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gK2N1cnJlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb21wYXJlcihrZXlWYWwsIGN1cnJlbnQpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBrZXlWYWwgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgICAgICBrZXkgPSBhcnJheVtpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ga2V5O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gRGF0YVV0aWw7XG4gICAgfSgpKTtcbiAgICBEYXRhVXRpbC5zZXJ2ZXJUaW1lem9uZU9mZnNldCA9IDA7XG4gICAgRGF0YVV0aWwudGhyb3dFcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgZS5tZXNzYWdlICsgJ1xcbicgKyBlLnN0YWNrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBEYXRhVXRpbC5hZ2dyZWdhdGVzID0ge1xuICAgICAgICBzdW06IGZ1bmN0aW9uIChkcywgZmllbGQpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xuICAgICAgICAgICAgdmFyIHZhbDtcbiAgICAgICAgICAgIHZhciBjYXN0UmVxdWlyZWQgPSB0eXBlb2YgRGF0YVV0aWwuZ2V0VmFsKGRzLCAwLCBmaWVsZCkgIT09ICdudW1iZXInO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhbCA9IERhdGFVdGlsLmdldFZhbChkcywgaSwgZmllbGQpO1xuICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsKSAmJiB2YWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhc3RSZXF1aXJlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gK3ZhbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gdmFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGF2ZXJhZ2U6IGZ1bmN0aW9uIChkcywgZmllbGQpIHtcbiAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC5hZ2dyZWdhdGVzLnN1bShkcywgZmllbGQpIC8gZHMubGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgICBtaW46IGZ1bmN0aW9uIChkcywgZmllbGQpIHtcbiAgICAgICAgICAgIHZhciBjb21wYXJlcjtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjb21wYXJlciA9IGZpZWxkO1xuICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC5nZXRPYmplY3QoZmllbGQsIERhdGFVdGlsLmdldEl0ZW1Gcm9tQ29tcGFyZXIoZHMsIGZpZWxkLCBjb21wYXJlciB8fCBEYXRhVXRpbC5mbkFzY2VuZGluZykpO1xuICAgICAgICB9LFxuICAgICAgICBtYXg6IGZ1bmN0aW9uIChkcywgZmllbGQpIHtcbiAgICAgICAgICAgIHZhciBjb21wYXJlcjtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjb21wYXJlciA9IGZpZWxkO1xuICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC5nZXRPYmplY3QoZmllbGQsIERhdGFVdGlsLmdldEl0ZW1Gcm9tQ29tcGFyZXIoZHMsIGZpZWxkLCBjb21wYXJlciB8fCBEYXRhVXRpbC5mbkRlc2NlbmRpbmcpKTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJ1ZWNvdW50OiBmdW5jdGlvbiAoZHMsIGZpZWxkKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IG1hbmFnZXJfMS5EYXRhTWFuYWdlcihkcykuZXhlY3V0ZUxvY2FsKG5ldyBxdWVyeV8xLlF1ZXJ5KCkud2hlcmUoZmllbGQsICdlcXVhbCcsIHRydWUsIHRydWUpKS5sZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIGZhbHNlY291bnQ6IGZ1bmN0aW9uIChkcywgZmllbGQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgbWFuYWdlcl8xLkRhdGFNYW5hZ2VyKGRzKS5leGVjdXRlTG9jYWwobmV3IHF1ZXJ5XzEuUXVlcnkoKS53aGVyZShmaWVsZCwgJ2VxdWFsJywgZmFsc2UsIHRydWUpKS5sZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIGNvdW50OiBmdW5jdGlvbiAoZHMsIGZpZWxkKSB7XG4gICAgICAgICAgICByZXR1cm4gZHMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBEYXRhVXRpbC5vcGVyYXRvclN5bWJvbHMgPSB7XG4gICAgICAgICc8JzogJ2xlc3N0aGFuJyxcbiAgICAgICAgJz4nOiAnZ3JlYXRlcnRoYW4nLFxuICAgICAgICAnPD0nOiAnbGVzc3RoYW5vcmVxdWFsJyxcbiAgICAgICAgJz49JzogJ2dyZWF0ZXJ0aGFub3JlcXVhbCcsXG4gICAgICAgICc9PSc6ICdlcXVhbCcsXG4gICAgICAgICchPSc6ICdub3RlcXVhbCcsXG4gICAgICAgICcqPSc6ICdjb250YWlucycsXG4gICAgICAgICckPSc6ICdlbmRzd2l0aCcsXG4gICAgICAgICdePSc6ICdzdGFydHN3aXRoJ1xuICAgIH07XG4gICAgRGF0YVV0aWwub2RCaU9wZXJhdG9yID0ge1xuICAgICAgICAnPCc6ICcgbHQgJyxcbiAgICAgICAgJz4nOiAnIGd0ICcsXG4gICAgICAgICc8PSc6ICcgbGUgJyxcbiAgICAgICAgJz49JzogJyBnZSAnLFxuICAgICAgICAnPT0nOiAnIGVxICcsXG4gICAgICAgICchPSc6ICcgbmUgJyxcbiAgICAgICAgJ2xlc3N0aGFuJzogJyBsdCAnLFxuICAgICAgICAnbGVzc3RoYW5vcmVxdWFsJzogJyBsZSAnLFxuICAgICAgICAnZ3JlYXRlcnRoYW4nOiAnIGd0ICcsXG4gICAgICAgICdncmVhdGVydGhhbm9yZXF1YWwnOiAnIGdlICcsXG4gICAgICAgICdlcXVhbCc6ICcgZXEgJyxcbiAgICAgICAgJ25vdGVxdWFsJzogJyBuZSAnXG4gICAgfTtcbiAgICBEYXRhVXRpbC5vZFVuaU9wZXJhdG9yID0ge1xuICAgICAgICAnJD0nOiAnZW5kc3dpdGgnLFxuICAgICAgICAnXj0nOiAnc3RhcnRzd2l0aCcsXG4gICAgICAgICcqPSc6ICdzdWJzdHJpbmdvZicsXG4gICAgICAgICdlbmRzd2l0aCc6ICdlbmRzd2l0aCcsXG4gICAgICAgICdzdGFydHN3aXRoJzogJ3N0YXJ0c3dpdGgnLFxuICAgICAgICAnY29udGFpbnMnOiAnc3Vic3RyaW5nb2YnXG4gICAgfTtcbiAgICBEYXRhVXRpbC5vZHY0VW5pT3BlcmF0b3IgPSB7XG4gICAgICAgICckPSc6ICdlbmRzd2l0aCcsXG4gICAgICAgICdePSc6ICdzdGFydHN3aXRoJyxcbiAgICAgICAgJyo9JzogJ2NvbnRhaW5zJyxcbiAgICAgICAgJ2VuZHN3aXRoJzogJ2VuZHN3aXRoJyxcbiAgICAgICAgJ3N0YXJ0c3dpdGgnOiAnc3RhcnRzd2l0aCcsXG4gICAgICAgICdjb250YWlucyc6ICdjb250YWlucydcbiAgICB9O1xuICAgIERhdGFVdGlsLmZuT3BlcmF0b3JzID0ge1xuICAgICAgICBlcXVhbDogZnVuY3Rpb24gKGFjdHVhbCwgZXhwZWN0ZWQsIGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIGlmIChpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGFVdGlsLnRvTG93ZXJDYXNlKGFjdHVhbCkgPT09IERhdGFVdGlsLnRvTG93ZXJDYXNlKGV4cGVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY3R1YWwgPT09IGV4cGVjdGVkO1xuICAgICAgICB9LFxuICAgICAgICBub3RlcXVhbDogZnVuY3Rpb24gKGFjdHVhbCwgZXhwZWN0ZWQsIGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIHJldHVybiAhRGF0YVV0aWwuZm5PcGVyYXRvcnMuZXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgaWdub3JlQ2FzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxlc3N0aGFuOiBmdW5jdGlvbiAoYWN0dWFsLCBleHBlY3RlZCwgaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgaWYgKGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVV0aWwudG9Mb3dlckNhc2UoYWN0dWFsKSA8IERhdGFVdGlsLnRvTG93ZXJDYXNlKGV4cGVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY3R1YWwgPCBleHBlY3RlZDtcbiAgICAgICAgfSxcbiAgICAgICAgZ3JlYXRlcnRoYW46IGZ1bmN0aW9uIChhY3R1YWwsIGV4cGVjdGVkLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICBpZiAoaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC50b0xvd2VyQ2FzZShhY3R1YWwpID4gRGF0YVV0aWwudG9Mb3dlckNhc2UoZXhwZWN0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjdHVhbCA+IGV4cGVjdGVkO1xuICAgICAgICB9LFxuICAgICAgICBsZXNzdGhhbm9yZXF1YWw6IGZ1bmN0aW9uIChhY3R1YWwsIGV4cGVjdGVkLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICBpZiAoaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC50b0xvd2VyQ2FzZShhY3R1YWwpIDw9IERhdGFVdGlsLnRvTG93ZXJDYXNlKGV4cGVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY3R1YWwgPD0gZXhwZWN0ZWQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdyZWF0ZXJ0aGFub3JlcXVhbDogZnVuY3Rpb24gKGFjdHVhbCwgZXhwZWN0ZWQsIGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIGlmIChpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGFVdGlsLnRvTG93ZXJDYXNlKGFjdHVhbCkgPj0gRGF0YVV0aWwudG9Mb3dlckNhc2UoZXhwZWN0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjdHVhbCA+PSBleHBlY3RlZDtcbiAgICAgICAgfSxcbiAgICAgICAgY29udGFpbnM6IGZ1bmN0aW9uIChhY3R1YWwsIGV4cGVjdGVkLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICBpZiAoaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZChhY3R1YWwpICYmICFlajJfYmFzZV8xLmlzTnVsbE9yVW5kZWZpbmVkKGV4cGVjdGVkKSAmJlxuICAgICAgICAgICAgICAgICAgICBEYXRhVXRpbC50b0xvd2VyQ2FzZShhY3R1YWwpLmluZGV4T2YoRGF0YVV0aWwudG9Mb3dlckNhc2UoZXhwZWN0ZWQpKSAhPT0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gIWVqMl9iYXNlXzEuaXNOdWxsT3JVbmRlZmluZWQoYWN0dWFsKSAmJiAhZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZChleHBlY3RlZCkgJiZcbiAgICAgICAgICAgICAgICBhY3R1YWwudG9TdHJpbmcoKS5pbmRleE9mKGV4cGVjdGVkKSAhPT0gLTE7XG4gICAgICAgIH0sXG4gICAgICAgIG5vdG51bGw6IGZ1bmN0aW9uIChhY3R1YWwpIHtcbiAgICAgICAgICAgIHJldHVybiBhY3R1YWwgIT09IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIGlzbnVsbDogZnVuY3Rpb24gKGFjdHVhbCkge1xuICAgICAgICAgICAgcmV0dXJuIGFjdHVhbCA9PT0gbnVsbDtcbiAgICAgICAgfSxcbiAgICAgICAgc3RhcnRzd2l0aDogZnVuY3Rpb24gKGFjdHVhbCwgZXhwZWN0ZWQsIGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIGlmIChpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjdHVhbCAmJiBleHBlY3RlZCAmJiBEYXRhVXRpbC5zdGFydHNXaXRoKGFjdHVhbC50b0xvd2VyQ2FzZSgpLCBleHBlY3RlZC50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY3R1YWwgJiYgZXhwZWN0ZWQgJiYgRGF0YVV0aWwuc3RhcnRzV2l0aChhY3R1YWwsIGV4cGVjdGVkKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW5kc3dpdGg6IGZ1bmN0aW9uIChhY3R1YWwsIGV4cGVjdGVkLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICBpZiAoaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhY3R1YWwgJiYgZXhwZWN0ZWQgJiYgRGF0YVV0aWwuZW5kc1dpdGgoYWN0dWFsLnRvTG93ZXJDYXNlKCksIGV4cGVjdGVkLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjdHVhbCAmJiBleHBlY3RlZCAmJiBEYXRhVXRpbC5lbmRzV2l0aChhY3R1YWwsIGV4cGVjdGVkKTtcbiAgICAgICAgfSxcbiAgICAgICAgcHJvY2Vzc1N5bWJvbHM6IGZ1bmN0aW9uIChvcGVyYXRvcikge1xuICAgICAgICAgICAgdmFyIGZuTmFtZSA9IERhdGFVdGlsLm9wZXJhdG9yU3ltYm9sc1tvcGVyYXRvcl07XG4gICAgICAgICAgICBpZiAoZm5OYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gRGF0YVV0aWwuZm5PcGVyYXRvcnNbZm5OYW1lXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gRGF0YVV0aWwudGhyb3dFcnJvcignUXVlcnkgLSBQcm9jZXNzIE9wZXJhdG9yIDogSW52YWxpZCBvcGVyYXRvcicpO1xuICAgICAgICB9LFxuICAgICAgICBwcm9jZXNzT3BlcmF0b3I6IGZ1bmN0aW9uIChvcGVyYXRvcikge1xuICAgICAgICAgICAgdmFyIGZuID0gRGF0YVV0aWwuZm5PcGVyYXRvcnNbb3BlcmF0b3JdO1xuICAgICAgICAgICAgaWYgKGZuKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIERhdGFVdGlsLmZuT3BlcmF0b3JzLnByb2Nlc3NTeW1ib2xzKG9wZXJhdG9yKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRGF0YVV0aWwucGFyc2UgPSB7XG4gICAgICAgIHBhcnNlSnNvbjogZnVuY3Rpb24gKGpzb25UZXh0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGpzb25UZXh0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGpzb25UZXh0ID0gSlNPTi5wYXJzZShqc29uVGV4dCwgRGF0YVV0aWwucGFyc2UuanNvblJldml2ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoanNvblRleHQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgIERhdGFVdGlsLnBhcnNlLml0ZXJhdGVBbmRSZXZpdmVBcnJheShqc29uVGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YganNvblRleHQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgRGF0YVV0aWwucGFyc2UuaXRlcmF0ZUFuZFJldml2ZUpzb24oanNvblRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGpzb25UZXh0O1xuICAgICAgICB9LFxuICAgICAgICBpdGVyYXRlQW5kUmV2aXZlQXJyYXk6IGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJyYXlbaV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIERhdGFVdGlsLnBhcnNlLml0ZXJhdGVBbmRSZXZpdmVKc29uKGFycmF5W2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFycmF5W2ldID09PSAnc3RyaW5nJyAmJiAhL15bXFxzXSpcXFt8XltcXHNdKlxce3xcXFwiL2cudGVzdChhcnJheVtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlbaV0gPSBEYXRhVXRpbC5wYXJzZS5qc29uUmV2aXZlcignJywgYXJyYXlbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlbaV0gPSBEYXRhVXRpbC5wYXJzZS5wYXJzZUpzb24oYXJyYXlbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaXRlcmF0ZUFuZFJldml2ZUpzb246IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWU7XG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGpzb24pO1xuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBrZXlzXzIgPSBrZXlzOyBfaSA8IGtleXNfMi5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IGtleXNfMltfaV07XG4gICAgICAgICAgICAgICAgaWYgKERhdGFVdGlsLnN0YXJ0c1dpdGgocHJvcCwgJ19fJykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhbHVlID0ganNvbltwcm9wXTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgRGF0YVV0aWwucGFyc2UuaXRlcmF0ZUFuZFJldml2ZUFycmF5KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgRGF0YVV0aWwucGFyc2UuaXRlcmF0ZUFuZFJldml2ZUpzb24odmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqc29uW3Byb3BdID0gRGF0YVV0aWwucGFyc2UuanNvblJldml2ZXIoanNvbltwcm9wXSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAganNvblJldml2ZXI6IGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBkdXBWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB2YXIgbXMgPSAvXlxcL0RhdGVcXCgoWystXT9bMC05XSspKFsrLV1bMC05XXs0fSk/XFwpXFwvJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKG1zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC5wYXJzZS5qc29uUmVwbGFjZXIoeyB2YWx1ZTogbmV3IERhdGUocGFyc2VJbnQobXNbMV0sIDEwKSkgfSwgZmFsc2UpLnZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgvXihcXGR7NH1cXC1cXGRcXGRcXC1cXGRcXGQoW3RUXVtcXGQ6XFwuXSopezF9KShbelpdfChbK1xcLV0pKFxcZFxcZCk6PyhcXGRcXGQpKT8kLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJyID0gZHVwVmFsdWUuc3BsaXQoL1teMC05XS8pO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IERhdGFVdGlsLnBhcnNlLmpzb25SZXBsYWNlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbmV3IERhdGUocGFyc2VJbnQoYXJyWzBdLCAxMCksIHBhcnNlSW50KGFyclsxXSwgMTApIC0gMSwgcGFyc2VJbnQoYXJyWzJdLCAxMCksIHBhcnNlSW50KGFyclszXSwgMTApLCBwYXJzZUludChhcnJbNF0sIDEwKSwgcGFyc2VJbnQoYXJyWzVdLCAxMCkpXG4gICAgICAgICAgICAgICAgICAgIH0sIGZhbHNlKS52YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0sXG4gICAgICAgIGlzSnNvbjogZnVuY3Rpb24gKGpzb25EYXRhKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGpzb25EYXRhWzBdID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBqc29uRGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC5wYXJzZS5wYXJzZUpzb24oanNvbkRhdGEpO1xuICAgICAgICB9LFxuICAgICAgICBpc0d1aWQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdmFyIHJlZ2V4ID0gL1tBLUZhLWYwLTldezh9KD86LVtBLUZhLWYwLTldezR9KXszfS1bQS1GYS1mMC05XXsxMn0vaTtcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IHJlZ2V4LmV4ZWModmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG1hdGNoICE9IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIHJlcGxhY2VyOiBmdW5jdGlvbiAodmFsdWUsIHN0cmluZ2lmeSkge1xuICAgICAgICAgICAgaWYgKERhdGFVdGlsLmlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGFVdGlsLnBhcnNlLmpzb25SZXBsYWNlcih2YWx1ZSwgc3RyaW5naWZ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGFVdGlsLnBhcnNlLmFycmF5UmVwbGFjZXIodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVXRpbC5wYXJzZS5qc29uUmVwbGFjZXIoeyB2YWw6IHZhbHVlIH0sIHN0cmluZ2lmeSkudmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBqc29uUmVwbGFjZXI6IGZ1bmN0aW9uICh2YWwsIHN0cmluZ2lmeSkge1xuICAgICAgICAgICAgaWYgKHN0cmluZ2lmeSA9PT0gdm9pZCAwKSB7IHN0cmluZ2lmeSA9IHRydWU7IH1cbiAgICAgICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXModmFsKTtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwga2V5c18zID0ga2V5czsgX2kgPCBrZXlzXzMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb3AgPSBrZXlzXzNbX2ldO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsW3Byb3BdO1xuICAgICAgICAgICAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBkID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdmFyIHVuaXhzdGFtcCA9ICtkIC0gKGQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTtcbiAgICAgICAgICAgICAgICB2YWxbcHJvcF0gPSBuZXcgRGF0ZSh1bml4c3RhbXAgLSAoRGF0YVV0aWwuc2VydmVyVGltZXpvbmVPZmZzZXQgKiAzNjAwMDAwKSk7XG4gICAgICAgICAgICAgICAgaWYgKHN0cmluZ2lmeSkge1xuICAgICAgICAgICAgICAgICAgICB2YWxbcHJvcF0gPSB2YWxbcHJvcF0udG9KU09OKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgfSxcbiAgICAgICAgYXJyYXlSZXBsYWNlcjogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWwubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoRGF0YVV0aWwuaXNQbGFpbk9iamVjdCh2YWxbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbFtpXSA9IERhdGFVdGlsLnBhcnNlLmpzb25SZXBsYWNlcih2YWxbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWxbaV0gaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbFtpXSA9IERhdGFVdGlsLnBhcnNlLmpzb25SZXBsYWNlcih7IGRhdGU6IHZhbFtpXSB9KS5kYXRlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGV4cG9ydHMuRGF0YVV0aWwgPSBEYXRhVXRpbDtcbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvdXRpbC5qc1xuLy8gbW9kdWxlIGlkID0gM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJkZWZpbmUoW1wicmVxdWlyZVwiLCBcImV4cG9ydHNcIiwgXCIuL3V0aWxcIl0sIGZ1bmN0aW9uIChyZXF1aXJlLCBleHBvcnRzLCB1dGlsXzEpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgdmFyIFF1ZXJ5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gUXVlcnkoZnJvbSkge1xuICAgICAgICAgICAgdGhpcy5zdWJRdWVyeSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmlzQ2hpbGQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucXVlcmllcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5rZXkgPSAnJztcbiAgICAgICAgICAgIHRoaXMuZktleSA9ICcnO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmcm9tID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHRoaXMuZnJvbVRhYmxlID0gZnJvbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZyb20gJiYgZnJvbSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBzID0gZnJvbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZXhwYW5kcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5zb3J0ZWRDb2x1bW5zID0gW107XG4gICAgICAgICAgICB0aGlzLmdyb3VwZWRDb2x1bW5zID0gW107XG4gICAgICAgICAgICB0aGlzLnN1YlF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuaXNDaGlsZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wYXJhbXMgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5zZXRLZXkgPSBmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgIHRoaXMua2V5ID0gZmllbGQ7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgUXVlcnkucHJvdG90eXBlLnVzaW5nID0gZnVuY3Rpb24gKGRhdGFNYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGFNYW5hZ2VyID0gZGF0YU1hbmFnZXI7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgUXVlcnkucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbiAoZGF0YU1hbmFnZXIsIGRvbmUsIGZhaWwsIGFsd2F5cykge1xuICAgICAgICAgICAgZGF0YU1hbmFnZXIgPSBkYXRhTWFuYWdlciB8fCB0aGlzLmRhdGFNYW5hZ2VyO1xuICAgICAgICAgICAgaWYgKGRhdGFNYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFNYW5hZ2VyLmV4ZWN1dGVRdWVyeSh0aGlzLCBkb25lLCBmYWlsLCBhbHdheXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHV0aWxfMS5EYXRhVXRpbC50aHJvd0Vycm9yKCdRdWVyeSAtIGV4ZWN1dGUoKSA6IGRhdGFNYW5hZ2VyIG5lZWRzIHRvIGJlIGlzIHNldCB1c2luZyBcInVzaW5nXCIgZnVuY3Rpb24gb3Igc2hvdWxkIGJlIHBhc3NlZCBhcyBhcmd1bWVudCcpO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuZXhlY3V0ZUxvY2FsID0gZnVuY3Rpb24gKGRhdGFNYW5hZ2VyKSB7XG4gICAgICAgICAgICBkYXRhTWFuYWdlciA9IGRhdGFNYW5hZ2VyIHx8IHRoaXMuZGF0YU1hbmFnZXI7XG4gICAgICAgICAgICBpZiAoZGF0YU1hbmFnZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YU1hbmFnZXIuZXhlY3V0ZUxvY2FsKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHV0aWxfMS5EYXRhVXRpbC50aHJvd0Vycm9yKCdRdWVyeSAtIGV4ZWN1dGVMb2NhbCgpIDogZGF0YU1hbmFnZXIgbmVlZHMgdG8gYmUgaXMgc2V0IHVzaW5nIFwidXNpbmdcIiBmdW5jdGlvbiBvciBzaG91bGQgYmUgcGFzc2VkIGFzIGFyZ3VtZW50Jyk7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjbG9uZWQgPSBuZXcgUXVlcnkoKTtcbiAgICAgICAgICAgIGNsb25lZC5xdWVyaWVzID0gdGhpcy5xdWVyaWVzLnNsaWNlKDApO1xuICAgICAgICAgICAgY2xvbmVkLmtleSA9IHRoaXMua2V5O1xuICAgICAgICAgICAgY2xvbmVkLmlzQ2hpbGQgPSB0aGlzLmlzQ2hpbGQ7XG4gICAgICAgICAgICBjbG9uZWQuZGF0YU1hbmFnZXIgPSB0aGlzLmRhdGFNYW5hZ2VyO1xuICAgICAgICAgICAgY2xvbmVkLmZyb21UYWJsZSA9IHRoaXMuZnJvbVRhYmxlO1xuICAgICAgICAgICAgY2xvbmVkLnBhcmFtcyA9IHRoaXMucGFyYW1zLnNsaWNlKDApO1xuICAgICAgICAgICAgY2xvbmVkLmV4cGFuZHMgPSB0aGlzLmV4cGFuZHMuc2xpY2UoMCk7XG4gICAgICAgICAgICBjbG9uZWQuc29ydGVkQ29sdW1ucyA9IHRoaXMuc29ydGVkQ29sdW1ucy5zbGljZSgwKTtcbiAgICAgICAgICAgIGNsb25lZC5ncm91cGVkQ29sdW1ucyA9IHRoaXMuZ3JvdXBlZENvbHVtbnMuc2xpY2UoMCk7XG4gICAgICAgICAgICBjbG9uZWQuc3ViUXVlcnlTZWxlY3RvciA9IHRoaXMuc3ViUXVlcnlTZWxlY3RvcjtcbiAgICAgICAgICAgIGNsb25lZC5zdWJRdWVyeSA9IHRoaXMuc3ViUXVlcnk7XG4gICAgICAgICAgICBjbG9uZWQuZktleSA9IHRoaXMuZktleTtcbiAgICAgICAgICAgIGNsb25lZC5yZXF1aXJlc0NvdW50cyA9IHRoaXMucmVxdWlyZXNDb3VudHM7XG4gICAgICAgICAgICByZXR1cm4gY2xvbmVkO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuZnJvbSA9IGZ1bmN0aW9uICh0YWJsZU5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZnJvbVRhYmxlID0gdGFibGVOYW1lO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5hZGRQYXJhbXMgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyYW1zLnB1c2goeyBrZXk6IGtleSwgZm46IHZhbHVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJhbXMucHVzaCh7IGtleToga2V5LCB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgUXVlcnkucHJvdG90eXBlLmV4cGFuZCA9IGZ1bmN0aW9uICh0YWJsZXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGFibGVzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kcyA9IFtdLnNsaWNlLmNhbGwoW3RhYmxlc10sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5leHBhbmRzID0gdGFibGVzLnNsaWNlKDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS53aGVyZSA9IGZ1bmN0aW9uIChmaWVsZE5hbWUsIG9wZXJhdG9yLCB2YWx1ZSwgaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvciA/IChvcGVyYXRvcikudG9Mb3dlckNhc2UoKSA6IG51bGw7XG4gICAgICAgICAgICB2YXIgcHJlZGljYXRlID0gbnVsbDtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGROYW1lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHByZWRpY2F0ZSA9IG5ldyBQcmVkaWNhdGUoZmllbGROYW1lLCBvcGVyYXRvciwgdmFsdWUsIGlnbm9yZUNhc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZmllbGROYW1lIGluc3RhbmNlb2YgUHJlZGljYXRlKSB7XG4gICAgICAgICAgICAgICAgcHJlZGljYXRlID0gZmllbGROYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5xdWVyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZuOiAnb25XaGVyZScsXG4gICAgICAgICAgICAgICAgZTogcHJlZGljYXRlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24gKHNlYXJjaEtleSwgZmllbGROYW1lcywgb3BlcmF0b3IsIGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGROYW1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBmaWVsZE5hbWVzID0gW2ZpZWxkTmFtZXNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvciB8fCAnY29udGFpbnMnO1xuICAgICAgICAgICAgdmFyIGNvbXBhcmVyID0gdXRpbF8xLkRhdGFVdGlsLmZuT3BlcmF0b3JzW29wZXJhdG9yXTtcbiAgICAgICAgICAgIHRoaXMucXVlcmllcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBmbjogJ29uU2VhcmNoJyxcbiAgICAgICAgICAgICAgICBlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZXM6IGZpZWxkTmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvcixcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoS2V5OiBzZWFyY2hLZXksXG4gICAgICAgICAgICAgICAgICAgIGlnbm9yZUNhc2U6IGlnbm9yZUNhc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmVyOiBjb21wYXJlclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5zb3J0QnkgPSBmdW5jdGlvbiAoZmllbGROYW1lLCBjb21wYXJlciwgaXNGcm9tR3JvdXApIHtcbiAgICAgICAgICAgIHZhciBvcmRlciA9ICdhc2NlbmRpbmcnO1xuICAgICAgICAgICAgdmFyIHNvcnRzO1xuICAgICAgICAgICAgdmFyIHRlbXA7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGZpZWxkTmFtZSA9PT0gJ3N0cmluZycgJiYgdXRpbF8xLkRhdGFVdGlsLmVuZHNXaXRoKGZpZWxkTmFtZS50b0xvd2VyQ2FzZSgpLCAnIGRlc2MnKSkge1xuICAgICAgICAgICAgICAgIGZpZWxkTmFtZSA9IGZpZWxkTmFtZS5yZXBsYWNlKC8gZGVzYyQvaSwgJycpO1xuICAgICAgICAgICAgICAgIGNvbXBhcmVyID0gJ2Rlc2NlbmRpbmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjb21wYXJlciB8fCB0eXBlb2YgY29tcGFyZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgb3JkZXIgPSBjb21wYXJlciA/IGNvbXBhcmVyLnRvTG93ZXJDYXNlKCkgOiAnYXNjZW5kaW5nJztcbiAgICAgICAgICAgICAgICBjb21wYXJlciA9IHV0aWxfMS5EYXRhVXRpbC5mblNvcnQoY29tcGFyZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRnJvbUdyb3VwKSB7XG4gICAgICAgICAgICAgICAgc29ydHMgPSBRdWVyeS5maWx0ZXJRdWVyaWVzKHRoaXMucXVlcmllcywgJ29uU29ydEJ5Jyk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wID0gc29ydHNbaV0uZS5maWVsZE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGVtcCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wID09PSBmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZW1wIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGVtcC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2pdID09PSBmaWVsZE5hbWUgfHwgZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgPT09IHRlbXBbal0gKyAnIGRlc2MnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucXVlcmllcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBmbjogJ29uU29ydEJ5JyxcbiAgICAgICAgICAgICAgICBlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGROYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb21wYXJlcjogY29tcGFyZXIsXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogb3JkZXJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuc29ydEJ5RGVzYyA9IGZ1bmN0aW9uIChmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNvcnRCeShmaWVsZE5hbWUsICdkZXNjZW5kaW5nJyk7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5ncm91cCA9IGZ1bmN0aW9uIChmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc29ydEJ5KGZpZWxkTmFtZSwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLnF1ZXJpZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgZm46ICdvbkdyb3VwJyxcbiAgICAgICAgICAgICAgICBlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGROYW1lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgUXVlcnkucHJvdG90eXBlLnBhZ2UgPSBmdW5jdGlvbiAocGFnZUluZGV4LCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgdGhpcy5xdWVyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZuOiAnb25QYWdlJyxcbiAgICAgICAgICAgICAgICBlOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogcGFnZUluZGV4LFxuICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUucmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICAgICAgdGhpcy5xdWVyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZuOiAnb25SYW5nZScsXG4gICAgICAgICAgICAgICAgZToge1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgIGVuZDogZW5kXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgUXVlcnkucHJvdG90eXBlLnRha2UgPSBmdW5jdGlvbiAobm9zKSB7XG4gICAgICAgICAgICB0aGlzLnF1ZXJpZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgZm46ICdvblRha2UnLFxuICAgICAgICAgICAgICAgIGU6IHtcbiAgICAgICAgICAgICAgICAgICAgbm9zOiBub3NcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuc2tpcCA9IGZ1bmN0aW9uIChub3MpIHtcbiAgICAgICAgICAgIHRoaXMucXVlcmllcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBmbjogJ29uU2tpcCcsXG4gICAgICAgICAgICAgICAgZTogeyBub3M6IG5vcyB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gKGZpZWxkTmFtZXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGROYW1lcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBmaWVsZE5hbWVzID0gW10uc2xpY2UuY2FsbChbZmllbGROYW1lc10sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5xdWVyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZuOiAnb25TZWxlY3QnLFxuICAgICAgICAgICAgICAgIGU6IHsgZmllbGROYW1lczogZmllbGROYW1lcyB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5wcm90b3R5cGUuaGllcmFyY2h5ID0gZnVuY3Rpb24gKHF1ZXJ5LCBzZWxlY3RvckZuKSB7XG4gICAgICAgICAgICB0aGlzLnN1YlF1ZXJ5U2VsZWN0b3IgPSBzZWxlY3RvckZuO1xuICAgICAgICAgICAgdGhpcy5zdWJRdWVyeSA9IHF1ZXJ5O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5mb3JlaWduS2V5ID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdGhpcy5mS2V5ID0ga2V5O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LnByb3RvdHlwZS5yZXF1aXJlc0NvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5yZXF1aXJlc0NvdW50cyA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgUXVlcnkucHJvdG90eXBlLmFnZ3JlZ2F0ZSA9IGZ1bmN0aW9uICh0eXBlLCBmaWVsZCkge1xuICAgICAgICAgICAgdGhpcy5xdWVyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZuOiAnb25BZ2dyZWdhdGVzJyxcbiAgICAgICAgICAgICAgICBlOiB7IGZpZWxkOiBmaWVsZCwgdHlwZTogdHlwZSB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBRdWVyeS5maWx0ZXJRdWVyaWVzID0gZnVuY3Rpb24gKHF1ZXJpZXMsIG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBxdWVyaWVzLmZpbHRlcihmdW5jdGlvbiAocSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxLmZuID09PSBuYW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFF1ZXJ5LmZpbHRlclF1ZXJ5TGlzdHMgPSBmdW5jdGlvbiAocXVlcmllcywgc2luZ2xlcykge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gcXVlcmllcy5maWx0ZXIoZnVuY3Rpb24gKHEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2luZ2xlcy5pbmRleE9mKHEuZm4pICE9PSAtMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHJlcyA9IHt9O1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWx0ZXJlZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzW2ZpbHRlcmVkW2ldLmZuXSkge1xuICAgICAgICAgICAgICAgICAgICByZXNbZmlsdGVyZWRbaV0uZm5dID0gZmlsdGVyZWRbaV0uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gUXVlcnk7XG4gICAgfSgpKTtcbiAgICBleHBvcnRzLlF1ZXJ5ID0gUXVlcnk7XG4gICAgdmFyIFByZWRpY2F0ZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZ1bmN0aW9uIFByZWRpY2F0ZShmaWVsZCwgb3BlcmF0b3IsIHZhbHVlLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICBpZiAoaWdub3JlQ2FzZSA9PT0gdm9pZCAwKSB7IGlnbm9yZUNhc2UgPSBmYWxzZTsgfVxuICAgICAgICAgICAgdGhpcy5pc0NvbXBsZXggPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkO1xuICAgICAgICAgICAgICAgIHRoaXMub3BlcmF0b3IgPSBvcGVyYXRvci50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUNhc2UgPSBpZ25vcmVDYXNlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDb21wbGV4ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5jb21wYXJlciA9IHV0aWxfMS5EYXRhVXRpbC5mbk9wZXJhdG9ycy5wcm9jZXNzT3BlcmF0b3IodGhpcy5vcGVyYXRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaWVsZCBpbnN0YW5jZW9mIFByZWRpY2F0ZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIFByZWRpY2F0ZSB8fCB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0NvbXBsZXggPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZGl0aW9uID0gb3BlcmF0b3IudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnByZWRpY2F0ZXMgPSBbZmllbGRdO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgICAgIFtdLnB1c2guYXBwbHkodGhpcy5wcmVkaWNhdGVzLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZWRpY2F0ZXMucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgUHJlZGljYXRlLmFuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcmVkaWNhdGUuY29tYmluZVByZWRpY2F0ZXMoW10uc2xpY2UuY2FsbChhcmdzLCAwKSwgJ2FuZCcpO1xuICAgICAgICB9O1xuICAgICAgICBQcmVkaWNhdGUucHJvdG90eXBlLmFuZCA9IGZ1bmN0aW9uIChmaWVsZCwgb3BlcmF0b3IsIHZhbHVlLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJlZGljYXRlLmNvbWJpbmUodGhpcywgZmllbGQsIG9wZXJhdG9yLCB2YWx1ZSwgJ2FuZCcsIGlnbm9yZUNhc2UpO1xuICAgICAgICB9O1xuICAgICAgICBQcmVkaWNhdGUub3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUHJlZGljYXRlLmNvbWJpbmVQcmVkaWNhdGVzKFtdLnNsaWNlLmNhbGwoYXJncywgMCksICdvcicpO1xuICAgICAgICB9O1xuICAgICAgICBQcmVkaWNhdGUucHJvdG90eXBlLm9yID0gZnVuY3Rpb24gKGZpZWxkLCBvcGVyYXRvciwgdmFsdWUsIGlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBQcmVkaWNhdGUuY29tYmluZSh0aGlzLCBmaWVsZCwgb3BlcmF0b3IsIHZhbHVlLCAnb3InLCBpZ25vcmVDYXNlKTtcbiAgICAgICAgfTtcbiAgICAgICAgUHJlZGljYXRlLmZyb21Kc29uID0gZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgIGlmIChqc29uIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGpzb24ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2godGhpcy5mcm9tSlNPTkRhdGEoanNvbltpXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHByZWQgPSBqc29uO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnJvbUpTT05EYXRhKHByZWQpO1xuICAgICAgICB9O1xuICAgICAgICBQcmVkaWNhdGUucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24gKHJlY29yZCkge1xuICAgICAgICAgICAgdmFyIHByZWRpY2F0ZSA9IHRoaXMucHJlZGljYXRlcyA/IHRoaXMucHJlZGljYXRlcyA6IFtdO1xuICAgICAgICAgICAgdmFyIGlzQW5kO1xuICAgICAgICAgICAgdmFyIHJldDtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbXBsZXggJiYgdGhpcy5jb21wYXJlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVyLmNhbGwodGhpcywgdXRpbF8xLkRhdGFVdGlsLmdldE9iamVjdCh0aGlzLmZpZWxkLCByZWNvcmQpLCB0aGlzLnZhbHVlLCB0aGlzLmlnbm9yZUNhc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXNBbmQgPSB0aGlzLmNvbmRpdGlvbiA9PT0gJ2FuZCc7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByZWRpY2F0ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJldCA9IHByZWRpY2F0ZVtpXS52YWxpZGF0ZShyZWNvcmQpO1xuICAgICAgICAgICAgICAgIGlmIChpc0FuZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpc0FuZDtcbiAgICAgICAgfTtcbiAgICAgICAgUHJlZGljYXRlLnByb3RvdHlwZS50b0pzb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcHJlZGljYXRlcztcbiAgICAgICAgICAgIHZhciBwO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNDb21wbGV4KSB7XG4gICAgICAgICAgICAgICAgcHJlZGljYXRlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHAgPSB0aGlzLnByZWRpY2F0ZXM7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZWRpY2F0ZXMucHVzaChwW2ldLnRvSnNvbigpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlzQ29tcGxleDogdGhpcy5pc0NvbXBsZXgsXG4gICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMuZmllbGQsXG4gICAgICAgICAgICAgICAgb3BlcmF0b3I6IHRoaXMub3BlcmF0b3IsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWUsXG4gICAgICAgICAgICAgICAgaWdub3JlQ2FzZTogdGhpcy5pZ25vcmVDYXNlLFxuICAgICAgICAgICAgICAgIGNvbmRpdGlvbjogdGhpcy5jb25kaXRpb24sXG4gICAgICAgICAgICAgICAgcHJlZGljYXRlczogcHJlZGljYXRlc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgUHJlZGljYXRlLmNvbWJpbmVQcmVkaWNhdGVzID0gZnVuY3Rpb24gKHByZWRpY2F0ZXMsIG9wZXJhdG9yKSB7XG4gICAgICAgICAgICBpZiAocHJlZGljYXRlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShwcmVkaWNhdGVzWzBdIGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmVkaWNhdGVzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcmVkaWNhdGVzID0gcHJlZGljYXRlc1swXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJlZGljYXRlKHByZWRpY2F0ZXNbMF0sIG9wZXJhdG9yLCBwcmVkaWNhdGVzLnNsaWNlKDEpKTtcbiAgICAgICAgfTtcbiAgICAgICAgUHJlZGljYXRlLmNvbWJpbmUgPSBmdW5jdGlvbiAocHJlZCwgZmllbGQsIG9wZXJhdG9yLCB2YWx1ZSwgY29uZGl0aW9uLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICBpZiAoZmllbGQgaW5zdGFuY2VvZiBQcmVkaWNhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJlZGljYXRlW2NvbmRpdGlvbl0ocHJlZCwgZmllbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWVsZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJlZGljYXRlW2NvbmRpdGlvbl0ocHJlZCwgbmV3IFByZWRpY2F0ZShmaWVsZCwgb3BlcmF0b3IsIHZhbHVlLCBpZ25vcmVDYXNlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdXRpbF8xLkRhdGFVdGlsLnRocm93RXJyb3IoJ1ByZWRpY2F0ZSAtICcgKyBjb25kaXRpb24gKyAnIDogaW52YWxpZCBhcmd1bWVudHMnKTtcbiAgICAgICAgfTtcbiAgICAgICAgUHJlZGljYXRlLmZyb21KU09ORGF0YSA9IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgICAgICB2YXIgcHJlZHMgPSBqc29uLnByZWRpY2F0ZXMgfHwgW107XG4gICAgICAgICAgICB2YXIgbGVuID0gcHJlZHMubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIHByZWRpY2F0ZXMgPSBbXTtcbiAgICAgICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcHJlZGljYXRlcy5wdXNoKHRoaXMuZnJvbUpTT05EYXRhKHByZWRzW2ldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWpzb24uaXNDb21wbGV4KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFByZWRpY2F0ZShqc29uLmZpZWxkLCBqc29uLm9wZXJhdG9yLCBqc29uLnZhbHVlLCBqc29uLmlnbm9yZUNhc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFByZWRpY2F0ZShwcmVkaWNhdGVzWzBdLCBqc29uLmNvbmRpdGlvbiwgcHJlZGljYXRlcy5zbGljZSgxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gUHJlZGljYXRlO1xuICAgIH0oKSk7XG4gICAgZXhwb3J0cy5QcmVkaWNhdGUgPSBQcmVkaWNhdGU7XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL3F1ZXJ5LmpzXG4vLyBtb2R1bGUgaWQgPSA0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsInZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuZGVmaW5lKFtcInJlcXVpcmVcIiwgXCJleHBvcnRzXCIsIFwiQHN5bmNmdXNpb24vZWoyLWJhc2VcIiwgXCIuL3V0aWxcIiwgXCIuL3F1ZXJ5XCJdLCBmdW5jdGlvbiAocmVxdWlyZSwgZXhwb3J0cywgZWoyX2Jhc2VfMSwgdXRpbF8xLCBxdWVyeV8xKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIHZhciBBZGFwdG9yID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gQWRhcHRvcihkcykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGZyb206ICd0YWJsZScsXG4gICAgICAgICAgICAgICAgcmVxdWVzdFR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBzb3J0Qnk6ICdzb3J0ZWQnLFxuICAgICAgICAgICAgICAgIHNlbGVjdDogJ3NlbGVjdCcsXG4gICAgICAgICAgICAgICAgc2tpcDogJ3NraXAnLFxuICAgICAgICAgICAgICAgIGdyb3VwOiAnZ3JvdXAnLFxuICAgICAgICAgICAgICAgIHRha2U6ICd0YWtlJyxcbiAgICAgICAgICAgICAgICBzZWFyY2g6ICdzZWFyY2gnLFxuICAgICAgICAgICAgICAgIGNvdW50OiAncmVxdWlyZXNDb3VudHMnLFxuICAgICAgICAgICAgICAgIHdoZXJlOiAnd2hlcmUnLFxuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZXM6ICdhZ2dyZWdhdGVzJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IEFkYXB0b3I7XG4gICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2UgPSBkcztcbiAgICAgICAgICAgIHRoaXMucHZ0ID0ge307XG4gICAgICAgIH1cbiAgICAgICAgQWRhcHRvci5wcm90b3R5cGUucHJvY2Vzc1Jlc3BvbnNlID0gZnVuY3Rpb24gKGRhdGEsIGRzLCBxdWVyeSwgeGhyKSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIEFkYXB0b3I7XG4gICAgfSgpKTtcbiAgICBleHBvcnRzLkFkYXB0b3IgPSBBZGFwdG9yO1xuICAgIHZhciBKc29uQWRhcHRvciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhKc29uQWRhcHRvciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gSnNvbkFkYXB0b3IoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgSnNvbkFkYXB0b3IucHJvdG90eXBlLnByb2Nlc3NRdWVyeSA9IGZ1bmN0aW9uIChkYXRhTWFuYWdlciwgcXVlcnkpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBkYXRhTWFuYWdlci5kYXRhU291cmNlLmpzb24uc2xpY2UoMCk7XG4gICAgICAgICAgICB2YXIgY291bnQgPSByZXN1bHQubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIGNvdW50RmxnID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciByZXQ7XG4gICAgICAgICAgICB2YXIga2V5O1xuICAgICAgICAgICAgdmFyIGFnZyA9IHt9O1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyeS5xdWVyaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAga2V5ID0gcXVlcnkucXVlcmllc1tpXTtcbiAgICAgICAgICAgICAgICByZXQgPSB0aGlzW2tleS5mbl0uY2FsbCh0aGlzLCByZXN1bHQsIGtleS5lLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgaWYgKGtleS5mbiA9PT0gJ29uQWdncmVnYXRlcycpIHtcbiAgICAgICAgICAgICAgICAgICAgYWdnW2tleS5lLmZpZWxkICsgJyAtICcgKyBrZXkuZS50eXBlXSA9IHJldDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJldCAhPT0gdW5kZWZpbmVkID8gcmV0IDogcmVzdWx0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoa2V5LmZuID09PSAnb25QYWdlJyB8fCBrZXkuZm4gPT09ICdvblNraXAnIHx8IGtleS5mbiA9PT0gJ29uVGFrZScgfHwga2V5LmZuID09PSAnb25SYW5nZScpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnRGbGcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNvdW50RmxnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gcmVzdWx0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocXVlcnkucmVxdWlyZXNDb3VudHMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogcmVzdWx0LFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZXM6IGFnZ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuICAgICAgICBKc29uQWRhcHRvci5wcm90b3R5cGUuYmF0Y2hSZXF1ZXN0ID0gZnVuY3Rpb24gKGRtLCBjaGFuZ2VzLCBlKSB7XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaGFuZ2VzLmFkZGVkUmVjb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0KGRtLCBjaGFuZ2VzLmFkZGVkUmVjb3Jkc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2hhbmdlcy5jaGFuZ2VkUmVjb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKGRtLCBlLmtleSwgY2hhbmdlcy5jaGFuZ2VkUmVjb3Jkc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2hhbmdlcy5kZWxldGVkUmVjb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGRtLCBlLmtleSwgY2hhbmdlcy5kZWxldGVkUmVjb3Jkc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2hhbmdlcztcbiAgICAgICAgfTtcbiAgICAgICAgSnNvbkFkYXB0b3IucHJvdG90eXBlLm9uV2hlcmUgPSBmdW5jdGlvbiAoZHMsIGUpIHtcbiAgICAgICAgICAgIGlmICghZHMgfHwgIWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkcy5maWx0ZXIoZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlLnZhbGlkYXRlKG9iaik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5vbkFnZ3JlZ2F0ZXMgPSBmdW5jdGlvbiAoZHMsIGUpIHtcbiAgICAgICAgICAgIHZhciBmbiA9IHV0aWxfMS5EYXRhVXRpbC5hZ2dyZWdhdGVzW2UudHlwZV07XG4gICAgICAgICAgICBpZiAoIWRzIHx8ICFmbiB8fCBkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmbihkcywgZS5maWVsZCk7XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5vblNlYXJjaCA9IGZ1bmN0aW9uIChkcywgZSkge1xuICAgICAgICAgICAgaWYgKCFkcyB8fCAhZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGUuZmllbGROYW1lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB1dGlsXzEuRGF0YVV0aWwuZ2V0RmllbGRMaXN0KGRzWzBdLCBlLmZpZWxkTmFtZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRzLmZpbHRlcihmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBlLmZpZWxkTmFtZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuY29tcGFyZXIuY2FsbChvYmosIHV0aWxfMS5EYXRhVXRpbC5nZXRPYmplY3QoZS5maWVsZE5hbWVzW2pdLCBvYmopLCBlLnNlYXJjaEtleSwgZS5pZ25vcmVDYXNlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5vblNvcnRCeSA9IGZ1bmN0aW9uIChkcywgZSwgcXVlcnkpIHtcbiAgICAgICAgICAgIGlmICghZHMgfHwgIWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmbkNvbXBhcmU7XG4gICAgICAgICAgICB2YXIgZmllbGQgPSB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUoZS5maWVsZE5hbWUsIHF1ZXJ5KTtcbiAgICAgICAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZHMuc29ydChlLmNvbXBhcmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmaWVsZCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgZmllbGQgPSBmaWVsZC5zbGljZSgwKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gZmllbGQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZFtpXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm5Db21wYXJlID0gZS5jb21wYXJlcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV0aWxfMS5EYXRhVXRpbC5lbmRzV2l0aChmaWVsZFtpXSwgJyBkZXNjJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuQ29tcGFyZSA9IHV0aWxfMS5EYXRhVXRpbC5mblNvcnQoJ2Rlc2NlbmRpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkW2ldID0gZmllbGRbaV0ucmVwbGFjZSgnIGRlc2MnLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZHMgPSB1dGlsXzEuRGF0YVV0aWwuc29ydChkcywgZmllbGRbaV0sIGZuQ29tcGFyZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1dGlsXzEuRGF0YVV0aWwuc29ydChkcywgZmllbGQsIGUuY29tcGFyZXIpO1xuICAgICAgICB9O1xuICAgICAgICBKc29uQWRhcHRvci5wcm90b3R5cGUub25Hcm91cCA9IGZ1bmN0aW9uIChkcywgZSwgcXVlcnkpIHtcbiAgICAgICAgICAgIGlmICghZHMgfHwgIWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhZ2dRdWVyeSA9IHF1ZXJ5XzEuUXVlcnkuZmlsdGVyUXVlcmllcyhxdWVyeS5xdWVyaWVzLCAnb25BZ2dyZWdhdGVzJyk7XG4gICAgICAgICAgICB2YXIgYWdnID0gW107XG4gICAgICAgICAgICBpZiAoYWdnUXVlcnkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRtcCA9IHZvaWQgMDtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFnZ1F1ZXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRtcCA9IGFnZ1F1ZXJ5W2ldLmU7XG4gICAgICAgICAgICAgICAgICAgIGFnZy5wdXNoKHsgdHlwZTogdG1wLnR5cGUsIGZpZWxkOiB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUodG1wLmZpZWxkLCBxdWVyeSkgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHV0aWxfMS5EYXRhVXRpbC5ncm91cChkcywgdXRpbF8xLkRhdGFVdGlsLmdldFZhbHVlKGUuZmllbGROYW1lLCBxdWVyeSksIGFnZyk7XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5vblBhZ2UgPSBmdW5jdGlvbiAoZHMsIGUsIHF1ZXJ5KSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IHV0aWxfMS5EYXRhVXRpbC5nZXRWYWx1ZShlLnBhZ2VTaXplLCBxdWVyeSk7XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSAodXRpbF8xLkRhdGFVdGlsLmdldFZhbHVlKGUucGFnZUluZGV4LCBxdWVyeSkgLSAxKSAqIHNpemU7XG4gICAgICAgICAgICB2YXIgZW5kID0gc3RhcnQgKyBzaXplO1xuICAgICAgICAgICAgaWYgKCFkcyB8fCAhZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRzLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgICAgICB9O1xuICAgICAgICBKc29uQWRhcHRvci5wcm90b3R5cGUub25SYW5nZSA9IGZ1bmN0aW9uIChkcywgZSkge1xuICAgICAgICAgICAgaWYgKCFkcyB8fCAhZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRzLnNsaWNlKHV0aWxfMS5EYXRhVXRpbC5nZXRWYWx1ZShlLnN0YXJ0KSwgdXRpbF8xLkRhdGFVdGlsLmdldFZhbHVlKGUuZW5kKSk7XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5vblRha2UgPSBmdW5jdGlvbiAoZHMsIGUpIHtcbiAgICAgICAgICAgIGlmICghZHMgfHwgIWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkcy5zbGljZSgwLCB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUoZS5ub3MpKTtcbiAgICAgICAgfTtcbiAgICAgICAgSnNvbkFkYXB0b3IucHJvdG90eXBlLm9uU2tpcCA9IGZ1bmN0aW9uIChkcywgZSkge1xuICAgICAgICAgICAgaWYgKCFkcyB8fCAhZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRzLnNsaWNlKHV0aWxfMS5EYXRhVXRpbC5nZXRWYWx1ZShlLm5vcykpO1xuICAgICAgICB9O1xuICAgICAgICBKc29uQWRhcHRvci5wcm90b3R5cGUub25TZWxlY3QgPSBmdW5jdGlvbiAoZHMsIGUpIHtcbiAgICAgICAgICAgIGlmICghZHMgfHwgIWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1dGlsXzEuRGF0YVV0aWwuc2VsZWN0KGRzLCB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUoZS5maWVsZE5hbWVzKSk7XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbiAoZG0sIGRhdGEsIHRhYmxlTmFtZSwgcXVlcnksIHBvc2l0aW9uKSB7XG4gICAgICAgICAgICBpZiAoZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZChwb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZG0uZGF0YVNvdXJjZS5qc29uLnB1c2goZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZG0uZGF0YVNvdXJjZS5qc29uLnNwbGljZShwb3NpdGlvbiwgMCwgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZG0sIGtleUZpZWxkLCB2YWx1ZSwgdGFibGVOYW1lKSB7XG4gICAgICAgICAgICB2YXIgZHMgPSBkbS5kYXRhU291cmNlLmpzb247XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZVtrZXlGaWVsZF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZHNbaV1ba2V5RmllbGRdID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaSAhPT0gZHMubGVuZ3RoID8gZHMuc3BsaWNlKGksIDEpIDogbnVsbDtcbiAgICAgICAgfTtcbiAgICAgICAgSnNvbkFkYXB0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChkbSwga2V5RmllbGQsIHZhbHVlLCB0YWJsZU5hbWUpIHtcbiAgICAgICAgICAgIHZhciBkcyA9IGRtLmRhdGFTb3VyY2UuanNvbjtcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgdmFyIGtleSA9IHZhbHVlW2tleUZpZWxkXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChkc1tpXVtrZXlGaWVsZF0gPT09IGtleSkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaSA8IGRzLmxlbmd0aCA/IGVqMl9iYXNlXzEubWVyZ2UoZHNbaV0sIHZhbHVlKSA6IG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKc29uQWRhcHRvcjtcbiAgICB9KEFkYXB0b3IpKTtcbiAgICBleHBvcnRzLkpzb25BZGFwdG9yID0gSnNvbkFkYXB0b3I7XG4gICAgdmFyIFVybEFkYXB0b3IgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoVXJsQWRhcHRvciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gVXJsQWRhcHRvcigpIHtcbiAgICAgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgfVxuICAgICAgICBVcmxBZGFwdG9yLnByb3RvdHlwZS5wcm9jZXNzUXVlcnkgPSBmdW5jdGlvbiAoZG0sIHF1ZXJ5LCBoaWVyYXJjaHlGaWx0ZXJzKSB7XG4gICAgICAgICAgICB2YXIgcXVlcmllcyA9IHRoaXMuZ2V0UXVlcnlSZXF1ZXN0KHF1ZXJ5KTtcbiAgICAgICAgICAgIHZhciBzaW5nbGVzID0gcXVlcnlfMS5RdWVyeS5maWx0ZXJRdWVyeUxpc3RzKHF1ZXJ5LnF1ZXJpZXMsIFsnb25TZWxlY3QnLCAnb25QYWdlJywgJ29uU2tpcCcsICdvblRha2UnLCAnb25SYW5nZSddKTtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBxdWVyeS5wYXJhbXM7XG4gICAgICAgICAgICB2YXIgdXJsID0gZG0uZGF0YVNvdXJjZS51cmw7XG4gICAgICAgICAgICB2YXIgdGVtcDtcbiAgICAgICAgICAgIHZhciBza2lwO1xuICAgICAgICAgICAgdmFyIHRha2UgPSBudWxsO1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHsgc29ydHM6IFtdLCBncm91cHM6IFtdLCBmaWx0ZXJzOiBbXSwgc2VhcmNoZXM6IFtdLCBhZ2dyZWdhdGVzOiBbXSB9O1xuICAgICAgICAgICAgaWYgKCdvblBhZ2UnIGluIHNpbmdsZXMpIHtcbiAgICAgICAgICAgICAgICB0ZW1wID0gc2luZ2xlcy5vblBhZ2U7XG4gICAgICAgICAgICAgICAgc2tpcCA9IHV0aWxfMS5EYXRhVXRpbC5nZXRWYWx1ZSh0ZW1wLnBhZ2VJbmRleCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHRha2UgPSB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUodGVtcC5wYWdlU2l6ZSwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHNraXAgPSAoc2tpcCAtIDEpICogdGFrZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCdvblJhbmdlJyBpbiBzaW5nbGVzKSB7XG4gICAgICAgICAgICAgICAgdGVtcCA9IHNpbmdsZXMub25SYW5nZTtcbiAgICAgICAgICAgICAgICBza2lwID0gdGVtcC5zdGFydDtcbiAgICAgICAgICAgICAgICB0YWtlID0gdGVtcC5lbmQgLSB0ZW1wLnN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyaWVzLnNvcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGVtcCA9IHV0aWxfMS5EYXRhVXRpbC5nZXRWYWx1ZShxdWVyaWVzLnNvcnRzW2ldLmUuZmllbGROYW1lLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5zb3J0cy5wdXNoKHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvbkVhY2hTb3J0JywgeyBuYW1lOiB0ZW1wLCBkaXJlY3Rpb246IHF1ZXJpZXMuc29ydHNbaV0uZS5kaXJlY3Rpb24gfSwgcXVlcnkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoaWVyYXJjaHlGaWx0ZXJzKSB7XG4gICAgICAgICAgICAgICAgdGVtcCA9IHRoaXMuZ2V0RmlsdGVyc0Zyb20oaGllcmFyY2h5RmlsdGVycywgcXVlcnkpO1xuICAgICAgICAgICAgICAgIGlmICh0ZW1wKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuZmlsdGVycy5wdXNoKHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvbkVhY2hXaGVyZScsIHRlbXAudG9Kc29uKCksIHF1ZXJ5KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyaWVzLmZpbHRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LmZpbHRlcnMucHVzaCh1dGlsXzEuRGF0YVV0aWwuY2FsbEFkYXB0b3JGdW5jdGlvbih0aGlzLCAnb25FYWNoV2hlcmUnLCBxdWVyaWVzLmZpbHRlcnNbaV0uZS50b0pzb24oKSwgcXVlcnkpKTtcbiAgICAgICAgICAgICAgICB2YXIga2V5c18xID0gdHlwZW9mIHJlcXVlc3QuZmlsdGVyc1tpXSA9PT0gJ29iamVjdCcgPyBPYmplY3Qua2V5cyhyZXF1ZXN0LmZpbHRlcnNbaV0pIDogW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBrZXlzXzIgPSBrZXlzXzE7IF9pIDwga2V5c18yLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IGtleXNfMltfaV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh1dGlsXzEuRGF0YVV0aWwuaXNOdWxsKChyZXF1ZXN0KVtwcm9wXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSByZXF1ZXN0W3Byb3BdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyaWVzLnNlYXJjaGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGVtcCA9IHF1ZXJpZXMuc2VhcmNoZXNbaV0uZTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnNlYXJjaGVzLnB1c2godXRpbF8xLkRhdGFVdGlsLmNhbGxBZGFwdG9yRnVuY3Rpb24odGhpcywgJ29uRWFjaFNlYXJjaCcsIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB0ZW1wLmZpZWxkTmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiB0ZW1wLm9wZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IHRlbXAuc2VhcmNoS2V5LFxuICAgICAgICAgICAgICAgICAgICBpZ25vcmVDYXNlOiB0ZW1wLmlnbm9yZUNhc2VcbiAgICAgICAgICAgICAgICB9LCBxdWVyeSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyaWVzLmdyb3Vwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QuZ3JvdXBzLnB1c2godXRpbF8xLkRhdGFVdGlsLmdldFZhbHVlKHF1ZXJpZXMuZ3JvdXBzW2ldLmUuZmllbGROYW1lLCBxdWVyeSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyaWVzLmFnZ3JlZ2F0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0ZW1wID0gcXVlcmllcy5hZ2dyZWdhdGVzW2ldLmU7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5hZ2dyZWdhdGVzLnB1c2goeyB0eXBlOiB0ZW1wLnR5cGUsIGZpZWxkOiB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUodGVtcC5maWVsZCwgcXVlcnkpIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlcSA9IHt9O1xuICAgICAgICAgICAgdGhpcy5nZXRSZXF1ZXN0UXVlcnkob3B0aW9ucywgcXVlcnksIHNpbmdsZXMsIHJlcXVlc3QsIHJlcSk7XG4gICAgICAgICAgICB1dGlsXzEuRGF0YVV0aWwuY2FsbEFkYXB0b3JGdW5jdGlvbih0aGlzLCAnYWRkUGFyYW1zJywgeyBkbTogZG0sIHF1ZXJ5OiBxdWVyeSwgcGFyYW1zOiBwYXJhbXMsIHJlcVBhcmFtczogcmVxIH0pO1xuICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhyZXEpO1xuICAgICAgICAgICAgZm9yICh2YXIgX2EgPSAwLCBrZXlzXzMgPSBrZXlzOyBfYSA8IGtleXNfMy5sZW5ndGg7IF9hKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IGtleXNfM1tfYV07XG4gICAgICAgICAgICAgICAgaWYgKHV0aWxfMS5EYXRhVXRpbC5pc051bGwocmVxW3Byb3BdKSB8fCByZXFbcHJvcF0gPT09ICcnIHx8IHJlcVtwcm9wXS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJlcVtwcm9wXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIShvcHRpb25zLnNraXAgaW4gcmVxICYmIG9wdGlvbnMudGFrZSBpbiByZXEpICYmIHRha2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXFbb3B0aW9ucy5za2lwXSA9IHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvblNraXAnLCBza2lwLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgcmVxW29wdGlvbnMudGFrZV0gPSB1dGlsXzEuRGF0YVV0aWwuY2FsbEFkYXB0b3JGdW5jdGlvbih0aGlzLCAnb25UYWtlJywgdGFrZSwgcXVlcnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHAgPSB0aGlzLnB2dDtcbiAgICAgICAgICAgIHRoaXMucHZ0ID0ge307XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlcXVlc3RUeXBlID09PSAnanNvbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXEpLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgcHZ0RGF0YTogcCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlbXAgPSB0aGlzLmNvbnZlcnRUb1F1ZXJ5U3RyaW5nKHJlcSwgcXVlcnksIGRtKTtcbiAgICAgICAgICAgIHRlbXAgPSAoZG0uZGF0YVNvdXJjZS51cmwuaW5kZXhPZignPycpICE9PSAtMSA/ICcmJyA6ICcvJykgKyB0ZW1wO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJywgdXJsOiB0ZW1wLmxlbmd0aCA/IHVybC5yZXBsYWNlKC9cXC8qJC8sIHRlbXApIDogdXJsLCBwdnREYXRhOiBwXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICBVcmxBZGFwdG9yLnByb3RvdHlwZS5nZXRSZXF1ZXN0UXVlcnkgPSBmdW5jdGlvbiAob3B0aW9ucywgcXVlcnksIHNpbmdsZXMsIHJlcXVlc3QsIHJlcXVlc3QxKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW0gPSAncGFyYW0nO1xuICAgICAgICAgICAgdmFyIHJlcSA9IHJlcXVlc3QxO1xuICAgICAgICAgICAgcmVxW29wdGlvbnMuZnJvbV0gPSBxdWVyeS5mcm9tVGFibGU7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5leHBhbmQpIHtcbiAgICAgICAgICAgICAgICByZXFbb3B0aW9ucy5leHBhbmRdID0gcXVlcnkuZXhwYW5kcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcVtvcHRpb25zLnNlbGVjdF0gPSAnb25TZWxlY3QnIGluIHNpbmdsZXMgP1xuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvblNlbGVjdCcsIHV0aWxfMS5EYXRhVXRpbC5nZXRWYWx1ZShzaW5nbGVzLm9uU2VsZWN0LmZpZWxkTmFtZXMsIHF1ZXJ5KSwgcXVlcnkpIDogJyc7XG4gICAgICAgICAgICByZXFbb3B0aW9ucy5jb3VudF0gPSBxdWVyeS5yZXF1aXJlc0NvdW50cyA/IHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvbkNvdW50JywgcXVlcnkucmVxdWlyZXNDb3VudHMsIHF1ZXJ5KSA6ICcnO1xuICAgICAgICAgICAgcmVxW29wdGlvbnMuc2VhcmNoXSA9IHJlcXVlc3Quc2VhcmNoZXMubGVuZ3RoID8gdXRpbF8xLkRhdGFVdGlsLmNhbGxBZGFwdG9yRnVuY3Rpb24odGhpcywgJ29uU2VhcmNoJywgcmVxdWVzdC5zZWFyY2hlcywgcXVlcnkpIDogJyc7XG4gICAgICAgICAgICByZXFbb3B0aW9ucy5za2lwXSA9ICdvblNraXAnIGluIHNpbmdsZXMgP1xuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvblNraXAnLCB1dGlsXzEuRGF0YVV0aWwuZ2V0VmFsdWUoc2luZ2xlcy5vblNraXAubm9zLCBxdWVyeSksIHF1ZXJ5KSA6ICcnO1xuICAgICAgICAgICAgcmVxW29wdGlvbnMudGFrZV0gPSAnb25UYWtlJyBpbiBzaW5nbGVzID9cbiAgICAgICAgICAgICAgICB1dGlsXzEuRGF0YVV0aWwuY2FsbEFkYXB0b3JGdW5jdGlvbih0aGlzLCAnb25UYWtlJywgdXRpbF8xLkRhdGFVdGlsLmdldFZhbHVlKHNpbmdsZXMub25UYWtlLm5vcywgcXVlcnkpLCBxdWVyeSkgOiAnJztcbiAgICAgICAgICAgIHJlcVtvcHRpb25zLndoZXJlXSA9IHJlcXVlc3QuZmlsdGVycy5sZW5ndGggfHwgcmVxdWVzdC5zZWFyY2hlcy5sZW5ndGggP1xuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvbldoZXJlJywgcmVxdWVzdC5maWx0ZXJzLCBxdWVyeSkgOiAnJztcbiAgICAgICAgICAgIHJlcVtvcHRpb25zLnNvcnRCeV0gPSByZXF1ZXN0LnNvcnRzLmxlbmd0aCA/IHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvblNvcnRCeScsIHJlcXVlc3Quc29ydHMsIHF1ZXJ5KSA6ICcnO1xuICAgICAgICAgICAgcmVxW29wdGlvbnMuZ3JvdXBdID0gcmVxdWVzdC5ncm91cHMubGVuZ3RoID8gdXRpbF8xLkRhdGFVdGlsLmNhbGxBZGFwdG9yRnVuY3Rpb24odGhpcywgJ29uR3JvdXAnLCByZXF1ZXN0Lmdyb3VwcywgcXVlcnkpIDogJyc7XG4gICAgICAgICAgICByZXFbb3B0aW9ucy5hZ2dyZWdhdGVzXSA9IHJlcXVlc3QuYWdncmVnYXRlcy5sZW5ndGggP1xuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC5jYWxsQWRhcHRvckZ1bmN0aW9uKHRoaXMsICdvbkFnZ3JlZ2F0ZXMnLCByZXF1ZXN0LmFnZ3JlZ2F0ZXMsIHF1ZXJ5KSA6ICcnO1xuICAgICAgICAgICAgcmVxW3BhcmFtXSA9IFtdO1xuICAgICAgICB9O1xuICAgICAgICBVcmxBZGFwdG9yLnByb3RvdHlwZS5jb252ZXJ0VG9RdWVyeVN0cmluZyA9IGZ1bmN0aW9uIChyZXF1ZXN0LCBxdWVyeSwgZG0pIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfTtcbiAgICAgICAgVXJsQWRhcHRvci5wcm90b3R5cGUucHJvY2Vzc1Jlc3BvbnNlID0gZnVuY3Rpb24gKGRhdGEsIGRzLCBxdWVyeSwgeGhyLCByZXF1ZXN0LCBjaGFuZ2VzKSB7XG4gICAgICAgICAgICB2YXIgcmVxdWVzdHMgPSByZXF1ZXN0O1xuICAgICAgICAgICAgdmFyIHB2dCA9IHJlcXVlc3RzLnB2dERhdGEgfHwge307XG4gICAgICAgICAgICB2YXIgZ3JvdXBEcyA9IGRhdGEuZ3JvdXBEcztcbiAgICAgICAgICAgIGlmICh4aHIgJiYgeGhyLmdldFJlc3BvbnNlSGVhZGVyKCdDb250ZW50LVR5cGUnKSAmJlxuICAgICAgICAgICAgICAgIHhoci5nZXRSZXNwb25zZUhlYWRlcignQ29udGVudC1UeXBlJykuaW5kZXhPZigneG1sJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChxdWVyeS5yZXF1aXJlc0NvdW50cyA/IHsgcmVzdWx0OiBbXSwgY291bnQ6IDAgfSA6IFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkID0gSlNPTi5wYXJzZShyZXF1ZXN0cy5kYXRhKTtcbiAgICAgICAgICAgIGlmIChkICYmIGQuYWN0aW9uID09PSAnYmF0Y2gnICYmIGRhdGEuYWRkZWRSZWNvcmRzKSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlcy5hZGRlZFJlY29yZHMgPSBkYXRhLmFkZGVkUmVjb3JkcztcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hhbmdlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLmQpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGFyZ3MgPSB7fTtcbiAgICAgICAgICAgIGlmICgnY291bnQnIGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBhcmdzLmNvdW50ID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFyZ3MucmVzdWx0ID0gZGF0YS5yZXN1bHQgPyBkYXRhLnJlc3VsdCA6IGRhdGE7XG4gICAgICAgICAgICB0aGlzLmdldEFnZ3JlZ2F0ZVJlc3VsdChwdnQsIGRhdGEsIGFyZ3MsIGdyb3VwRHMpO1xuICAgICAgICAgICAgcmV0dXJuIHV0aWxfMS5EYXRhVXRpbC5pc051bGwoYXJncy5jb3VudCkgPyBhcmdzLnJlc3VsdCA6IHsgcmVzdWx0OiBhcmdzLnJlc3VsdCwgY291bnQ6IGFyZ3MuY291bnQsIGFnZ3JlZ2F0ZXM6IGFyZ3MuYWdncmVnYXRlcyB9O1xuICAgICAgICB9O1xuICAgICAgICBVcmxBZGFwdG9yLnByb3RvdHlwZS5vbkdyb3VwID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHRoaXMucHZ0Lmdyb3VwcyA9IGU7XG4gICAgICAgIH07XG4gICAgICAgIFVybEFkYXB0b3IucHJvdG90eXBlLm9uQWdncmVnYXRlcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB0aGlzLnB2dC5hZ2dyZWdhdGVzID0gZTtcbiAgICAgICAgfTtcbiAgICAgICAgVXJsQWRhcHRvci5wcm90b3R5cGUuYmF0Y2hSZXF1ZXN0ID0gZnVuY3Rpb24gKGRtLCBjaGFuZ2VzLCBlKSB7XG4gICAgICAgICAgICB2YXIgdXJsO1xuICAgICAgICAgICAgdmFyIGtleTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogZG0uZGF0YVNvdXJjZS5iYXRjaFVybCB8fCBkbS5kYXRhU291cmNlLmNydWRVcmwgfHwgZG0uZGF0YVNvdXJjZS5yZW1vdmVVcmwgfHwgZG0uZGF0YVNvdXJjZS51cmwsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlZDogY2hhbmdlcy5jaGFuZ2VkUmVjb3JkcyxcbiAgICAgICAgICAgICAgICAgICAgYWRkZWQ6IGNoYW5nZXMuYWRkZWRSZWNvcmRzLFxuICAgICAgICAgICAgICAgICAgICBkZWxldGVkOiBjaGFuZ2VzLmRlbGV0ZWRSZWNvcmRzLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdiYXRjaCcsXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlOiBlW3VybF0sXG4gICAgICAgICAgICAgICAgICAgIGtleTogZVtrZXldXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIFVybEFkYXB0b3IucHJvdG90eXBlLmJlZm9yZVNlbmQgPSBmdW5jdGlvbiAoZG0sIHJlcXVlc3QpIHtcbiAgICAgICAgfTtcbiAgICAgICAgVXJsQWRhcHRvci5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24gKGRtLCBkYXRhLCB0YWJsZU5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdXJsOiBkbS5kYXRhU291cmNlLmluc2VydFVybCB8fCBkbS5kYXRhU291cmNlLmNydWRVcmwgfHwgZG0uZGF0YVNvdXJjZS51cmwsXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGU6IHRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnaW5zZXJ0J1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICBVcmxBZGFwdG9yLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZG0sIGtleUZpZWxkLCB2YWx1ZSwgdGFibGVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IGRtLmRhdGFTb3VyY2UucmVtb3ZlVXJsIHx8IGRtLmRhdGFTb3VyY2UuY3J1ZFVybCB8fCBkbS5kYXRhU291cmNlLnVybCxcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIGtleTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGtleUNvbHVtbjoga2V5RmllbGQsXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlOiB0YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3JlbW92ZSdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgVXJsQWRhcHRvci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRtLCBrZXlGaWVsZCwgdmFsdWUsIHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBkbS5kYXRhU291cmNlLnVwZGF0ZVVybCB8fCBkbS5kYXRhU291cmNlLmNydWRVcmwgfHwgZG0uZGF0YVNvdXJjZS51cmwsXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3VwZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGtleUNvbHVtbjoga2V5RmllbGQsXG4gICAgICAgICAgICAgICAgICAgIGtleTogdmFsdWVba2V5RmllbGRdLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogdGFibGVOYW1lXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIFVybEFkYXB0b3IucHJvdG90eXBlLmdldEZpbHRlcnNGcm9tID0gZnVuY3Rpb24gKGRhdGEsIHF1ZXJ5KSB7XG4gICAgICAgICAgICB2YXIga2V5ID0gcXVlcnkuZktleTtcbiAgICAgICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgICAgIHZhciBwcm9wID0ga2V5O1xuICAgICAgICAgICAgdmFyIHBLZXkgPSBxdWVyeS5rZXk7XG4gICAgICAgICAgICB2YXIgcHJlZGljYXRzID0gW107XG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFbMF0gIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgcHJvcCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdXRpbF8xLkRhdGFVdGlsLmdldE9iamVjdChwS2V5IHx8IHByb3AsIGRhdGFbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRhW2ldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcmVkaWNhdHMucHVzaChuZXcgcXVlcnlfMS5QcmVkaWNhdGUoa2V5LCAnZXF1YWwnLCB2YWx1ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5XzEuUHJlZGljYXRlLm9yKHByZWRpY2F0cyk7XG4gICAgICAgIH07XG4gICAgICAgIFVybEFkYXB0b3IucHJvdG90eXBlLmdldEFnZ3JlZ2F0ZVJlc3VsdCA9IGZ1bmN0aW9uIChwdnQsIGRhdGEsIGFyZ3MsIGdyb3VwRHMpIHtcbiAgICAgICAgICAgIHZhciBwRGF0YSA9IGRhdGE7XG4gICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHBEYXRhID0gZGF0YS5yZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHZ0ICYmIHB2dC5hZ2dyZWdhdGVzICYmIHB2dC5hZ2dyZWdhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhciBhZ2cgPSBwdnQuYWdncmVnYXRlcztcbiAgICAgICAgICAgICAgICB2YXIgZm4gPSB2b2lkIDA7XG4gICAgICAgICAgICAgICAgdmFyIGFnZ3JlZ2F0ZURhdGEgPSBwRGF0YTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0ge307XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuYWdncmVnYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZURhdGEgPSBkYXRhLmFnZ3JlZ2F0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZ2cubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZm4gPSB1dGlsXzEuRGF0YVV0aWwuYWdncmVnYXRlc1thZ2dbaV0udHlwZV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChmbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2FnZ1tpXS5maWVsZCArICcgLSAnICsgYWdnW2ldLnR5cGVdID0gZm4oYWdncmVnYXRlRGF0YSwgYWdnW2ldLmZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhcmdzLmFnZ3JlZ2F0ZXMgPSByZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHZ0ICYmIHB2dC5ncm91cHMgJiYgcHZ0Lmdyb3Vwcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBzID0gcHZ0Lmdyb3VwcztcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGV2ZWwgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVqMl9iYXNlXzEuaXNOdWxsT3JVbmRlZmluZWQoZ3JvdXBEcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwRHMgPSB1dGlsXzEuRGF0YVV0aWwuZ3JvdXAoZ3JvdXBEcywgZ3JvdXBzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwRGF0YSA9IHV0aWxfMS5EYXRhVXRpbC5ncm91cChwRGF0YSwgZ3JvdXBzW2ldLCBwdnQuYWdncmVnYXRlcywgbGV2ZWwsIGdyb3VwRHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhcmdzLnJlc3VsdCA9IHBEYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgICAgIH07XG4gICAgICAgIFVybEFkYXB0b3IucHJvdG90eXBlLmdldFF1ZXJ5UmVxdWVzdCA9IGZ1bmN0aW9uIChxdWVyeSkge1xuICAgICAgICAgICAgdmFyIHJlcSA9IHsgc29ydHM6IFtdLCBncm91cHM6IFtdLCBmaWx0ZXJzOiBbXSwgc2VhcmNoZXM6IFtdLCBhZ2dyZWdhdGVzOiBbXSB9O1xuICAgICAgICAgICAgcmVxLnNvcnRzID0gcXVlcnlfMS5RdWVyeS5maWx0ZXJRdWVyaWVzKHF1ZXJ5LnF1ZXJpZXMsICdvblNvcnRCeScpO1xuICAgICAgICAgICAgcmVxLmdyb3VwcyA9IHF1ZXJ5XzEuUXVlcnkuZmlsdGVyUXVlcmllcyhxdWVyeS5xdWVyaWVzLCAnb25Hcm91cCcpO1xuICAgICAgICAgICAgcmVxLmZpbHRlcnMgPSBxdWVyeV8xLlF1ZXJ5LmZpbHRlclF1ZXJpZXMocXVlcnkucXVlcmllcywgJ29uV2hlcmUnKTtcbiAgICAgICAgICAgIHJlcS5zZWFyY2hlcyA9IHF1ZXJ5XzEuUXVlcnkuZmlsdGVyUXVlcmllcyhxdWVyeS5xdWVyaWVzLCAnb25TZWFyY2gnKTtcbiAgICAgICAgICAgIHJlcS5hZ2dyZWdhdGVzID0gcXVlcnlfMS5RdWVyeS5maWx0ZXJRdWVyaWVzKHF1ZXJ5LnF1ZXJpZXMsICdvbkFnZ3JlZ2F0ZXMnKTtcbiAgICAgICAgICAgIHJldHVybiByZXE7XG4gICAgICAgIH07XG4gICAgICAgIFVybEFkYXB0b3IucHJvdG90eXBlLmFkZFBhcmFtcyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgcmVxID0gb3B0aW9ucy5yZXFQYXJhbXM7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJhbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmVxLnBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IG9wdGlvbnMucGFyYW1zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciB0bXAgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgaWYgKHJlcVt0bXAua2V5XSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1F1ZXJ5KCkgLSBhZGRQYXJhbXM6IEN1c3RvbSBQYXJhbSBpcyBjb25mbGljdGluZyBvdGhlciByZXF1ZXN0IGFyZ3VtZW50cycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXFbdG1wLmtleV0gPSB0bXAudmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHRtcC5mbikge1xuICAgICAgICAgICAgICAgICAgICByZXFbdG1wLmtleV0gPSB0bXAuZm4uY2FsbChvcHRpb25zLnF1ZXJ5LCB0bXAua2V5LCBvcHRpb25zLnF1ZXJ5LCBvcHRpb25zLmRtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVxLnBhcmFtc1t0bXAua2V5XSA9IHJlcVt0bXAua2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFVybEFkYXB0b3I7XG4gICAgfShBZGFwdG9yKSk7XG4gICAgZXhwb3J0cy5VcmxBZGFwdG9yID0gVXJsQWRhcHRvcjtcbiAgICB2YXIgT0RhdGFBZGFwdG9yID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKE9EYXRhQWRhcHRvciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gT0RhdGFBZGFwdG9yKCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgICAgIF90aGlzLm9wdGlvbnMgPSBlajJfYmFzZV8xLmV4dGVuZCh7fSwgX3RoaXMub3B0aW9ucywge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RUeXBlOiAnZ2V0JyxcbiAgICAgICAgICAgICAgICBhY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uO29kYXRhPWxpZ2h0O3E9MSxhcHBsaWNhdGlvbi9qc29uO29kYXRhPXZlcmJvc2U7cT0wLjUnLFxuICAgICAgICAgICAgICAgIG11bHRpcGFydEFjY2VwdDogJ211bHRpcGFydC9taXhlZCcsXG4gICAgICAgICAgICAgICAgc29ydEJ5OiAnJG9yZGVyYnknLFxuICAgICAgICAgICAgICAgIHNlbGVjdDogJyRzZWxlY3QnLFxuICAgICAgICAgICAgICAgIHNraXA6ICckc2tpcCcsXG4gICAgICAgICAgICAgICAgdGFrZTogJyR0b3AnLFxuICAgICAgICAgICAgICAgIGNvdW50OiAnJGlubGluZWNvdW50JyxcbiAgICAgICAgICAgICAgICB3aGVyZTogJyRmaWx0ZXInLFxuICAgICAgICAgICAgICAgIGV4cGFuZDogJyRleHBhbmQnLFxuICAgICAgICAgICAgICAgIGJhdGNoOiAnJGJhdGNoJyxcbiAgICAgICAgICAgICAgICBjaGFuZ2VTZXQ6ICctLWNoYW5nZXNldF8nLFxuICAgICAgICAgICAgICAgIGJhdGNoUHJlOiAnYmF0Y2hfJyxcbiAgICAgICAgICAgICAgICBjb250ZW50SWQ6ICdDb250ZW50LUlkOiAnLFxuICAgICAgICAgICAgICAgIGJhdGNoQ29udGVudDogJ0NvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L21peGVkOyBib3VuZGFyeT0nLFxuICAgICAgICAgICAgICAgIGNoYW5nZVNldENvbnRlbnQ6ICdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2h0dHBcXG5Db250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiaW5hcnkgJyxcbiAgICAgICAgICAgICAgICBiYXRjaENoYW5nZVNldENvbnRlbnRUeXBlOiAnQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04ICdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgX3RoaXMuZ2V0TW9kdWxlTmFtZSA9IGVqMl9iYXNlXzEuZ2V0VmFsdWUoJ2dldE1vZHVsZW5hbWUnLCBfdGhpcyk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgT0RhdGFBZGFwdG9yLnByb3RvdHlwZS5vblByZWRpY2F0ZSA9IGZ1bmN0aW9uIChwcmVkaWNhdGUsIHF1ZXJ5LCByZXF1aXJlc0Nhc3QpIHtcbiAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9ICcnO1xuICAgICAgICAgICAgdmFyIG9wZXJhdG9yO1xuICAgICAgICAgICAgdmFyIGd1aWQ7XG4gICAgICAgICAgICB2YXIgdmFsID0gcHJlZGljYXRlLnZhbHVlO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsO1xuICAgICAgICAgICAgdmFyIGZpZWxkID0gcHJlZGljYXRlLmZpZWxkID8gT0RhdGFBZGFwdG9yLmdldEZpZWxkKHByZWRpY2F0ZS5maWVsZCkgOiBudWxsO1xuICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgICAgICB2YWwgPSAnZGF0ZXRpbWVcXCcnICsgdXRpbF8xLkRhdGFVdGlsLnBhcnNlLnJlcGxhY2VyKHZhbCkgKyAnXFwnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHZhbCA9ICdcXCcnICsgdmFsICsgJ1xcJyc7XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVzQ2FzdCkge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZCA9ICdjYXN0KCcgKyBmaWVsZCArICcsIFxcJ0VkbS5TdHJpbmdcXCcpJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHV0aWxfMS5EYXRhVXRpbC5wYXJzZS5pc0d1aWQodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICBndWlkID0gJ2d1aWQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocHJlZGljYXRlLmlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFndWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9ICd0b2xvd2VyKCcgKyBmaWVsZCArICcpJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcGVyYXRvciA9IHV0aWxfMS5EYXRhVXRpbC5vZEJpT3BlcmF0b3JbcHJlZGljYXRlLm9wZXJhdG9yXTtcbiAgICAgICAgICAgIGlmIChvcGVyYXRvcikge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlICs9IGZpZWxkO1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlICs9IG9wZXJhdG9yO1xuICAgICAgICAgICAgICAgIGlmIChndWlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlICs9IGd1aWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZSArIHZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZWoyX2Jhc2VfMS5pc051bGxPclVuZGVmaW5lZCh0aGlzLmdldE1vZHVsZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0TW9kdWxlTmFtZSgpID09PSAnT0RhdGFWNEFkYXB0b3InKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yID0gdXRpbF8xLkRhdGFVdGlsLm9kdjRVbmlPcGVyYXRvcltwcmVkaWNhdGUub3BlcmF0b3JdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wZXJhdG9yID0gdXRpbF8xLkRhdGFVdGlsLm9kVW5pT3BlcmF0b3JbcHJlZGljYXRlLm9wZXJhdG9yXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gJ3N1YnN0cmluZ29mJykge1xuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gdmFsO1xuICAgICAgICAgICAgICAgIHZhbCA9IGZpZWxkO1xuICAgICAgICAgICAgICAgIGZpZWxkID0gdGVtcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVyblZhbHVlICs9IG9wZXJhdG9yICsgJygnO1xuICAgICAgICAgICAgcmV0dXJuVmFsdWUgKz0gZmllbGQgKyAnLCc7XG4gICAgICAgICAgICBpZiAoZ3VpZCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlICs9IGd1aWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm5WYWx1ZSArPSB2YWwgKyAnKSc7XG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUub25Db21wbGV4UHJlZGljYXRlID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgcXVlcnksIHJlcXVpcmVzQ2FzdCkge1xuICAgICAgICAgICAgdmFyIHJlcyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVkaWNhdGUucHJlZGljYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJlcy5wdXNoKCcoJyArIHRoaXMub25FYWNoV2hlcmUocHJlZGljYXRlLnByZWRpY2F0ZXNbaV0sIHF1ZXJ5LCByZXF1aXJlc0Nhc3QpICsgJyknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXMuam9pbignICcgKyBwcmVkaWNhdGUuY29uZGl0aW9uICsgJyAnKTtcbiAgICAgICAgfTtcbiAgICAgICAgT0RhdGFBZGFwdG9yLnByb3RvdHlwZS5vbkVhY2hXaGVyZSA9IGZ1bmN0aW9uIChmaWx0ZXIsIHF1ZXJ5LCByZXF1aXJlc0Nhc3QpIHtcbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXIuaXNDb21wbGV4ID8gdGhpcy5vbkNvbXBsZXhQcmVkaWNhdGUoZmlsdGVyLCBxdWVyeSwgcmVxdWlyZXNDYXN0KSA6IHRoaXMub25QcmVkaWNhdGUoZmlsdGVyLCBxdWVyeSwgcmVxdWlyZXNDYXN0KTtcbiAgICAgICAgfTtcbiAgICAgICAgT0RhdGFBZGFwdG9yLnByb3RvdHlwZS5vbldoZXJlID0gZnVuY3Rpb24gKGZpbHRlcnMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnB2dC5zZWFyY2gpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJzLnB1c2godGhpcy5vbkVhY2hXaGVyZSh0aGlzLnB2dC5zZWFyY2gsIG51bGwsIHRydWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJzLmpvaW4oJyBhbmQgJyk7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUub25FYWNoU2VhcmNoID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmZpZWxkcyAmJiBlLmZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB1dGlsXzEuRGF0YVV0aWwudGhyb3dFcnJvcignUXVlcnkoKSAtIFNlYXJjaCA6IG9EYXRhIHNlYXJjaCByZXF1aXJlcyBsaXN0IG9mIGZpZWxkIG5hbWVzIHRvIHNlYXJjaCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZpbHRlciA9IHRoaXMucHZ0LnNlYXJjaCB8fCBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS5maWVsZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXIucHVzaChuZXcgcXVlcnlfMS5QcmVkaWNhdGUoZS5maWVsZHNbaV0sIGUub3BlcmF0b3IsIGUua2V5LCBlLmlnbm9yZUNhc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucHZ0LnNlYXJjaCA9IGZpbHRlcjtcbiAgICAgICAgfTtcbiAgICAgICAgT0RhdGFBZGFwdG9yLnByb3RvdHlwZS5vblNlYXJjaCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB0aGlzLnB2dC5zZWFyY2ggPSBxdWVyeV8xLlByZWRpY2F0ZS5vcih0aGlzLnB2dC5zZWFyY2gpO1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLm9uRWFjaFNvcnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIHJlcyA9IFtdO1xuICAgICAgICAgICAgaWYgKGUubmFtZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLm5hbWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goT0RhdGFBZGFwdG9yLmdldEZpZWxkKGUubmFtZVtpXSkgKyAoZS5kaXJlY3Rpb24gPT09ICdkZXNjZW5kaW5nJyA/ICcgZGVzYycgOiAnJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlcy5wdXNoKE9EYXRhQWRhcHRvci5nZXRGaWVsZChlLm5hbWUpICsgKGUuZGlyZWN0aW9uID09PSAnZGVzY2VuZGluZycgPyAnIGRlc2MnIDogJycpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXMuam9pbignLCcpO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLm9uU29ydEJ5ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBlLnJldmVyc2UoKS5qb2luKCcsJyk7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUub25Hcm91cCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB0aGlzLnB2dC5ncm91cHMgPSBlO1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLm9uU2VsZWN0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGVbaV0gPSBPRGF0YUFkYXB0b3IuZ2V0RmllbGQoZVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZS5qb2luKCcsJyk7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUub25BZ2dyZWdhdGVzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHRoaXMucHZ0LmFnZ3JlZ2F0ZXMgPSBlO1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLm9uQ291bnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGUgPT09IHRydWUgPyAnYWxscGFnZXMnIDogJyc7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUuYmVmb3JlU2VuZCA9IGZ1bmN0aW9uIChkbSwgcmVxdWVzdCwgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgIGlmICh1dGlsXzEuRGF0YVV0aWwuZW5kc1dpdGgoc2V0dGluZ3MudXJsLCB0aGlzLm9wdGlvbnMuYmF0Y2gpICYmIHNldHRpbmdzLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3Bvc3QnKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdBY2NlcHQnLCB0aGlzLm9wdGlvbnMubXVsdGlwYXJ0QWNjZXB0KTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0RhdGFTZXJ2aWNlVmVyc2lvbicsICcyLjAnKTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUoJ3RleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgdGhpcy5vcHRpb25zLmFjY2VwdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0RhdGFTZXJ2aWNlVmVyc2lvbicsICcyLjAnKTtcbiAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignTWF4RGF0YVNlcnZpY2VWZXJzaW9uJywgJzIuMCcpO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLnByb2Nlc3NSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhLCBkcywgcXVlcnksIHhociwgcmVxdWVzdCwgY2hhbmdlcykge1xuICAgICAgICAgICAgdmFyIHB2dERhdGEgPSAncHZ0RGF0YSc7XG4gICAgICAgICAgICBpZiAoIWVqMl9iYXNlXzEuaXNOdWxsT3JVbmRlZmluZWQoZGF0YS5kKSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhQ29weSA9IChxdWVyeSAmJiBxdWVyeS5yZXF1aXJlc0NvdW50cykgPyBkYXRhLmQucmVzdWx0cyA6IGRhdGEuZDtcbiAgICAgICAgICAgICAgICB2YXIgbWV0YURhdGEgPSAnX19tZXRhZGF0YSc7XG4gICAgICAgICAgICAgICAgaWYgKCFlajJfYmFzZV8xLmlzTnVsbE9yVW5kZWZpbmVkKGRhdGFDb3B5KSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFDb3B5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVqMl9iYXNlXzEuaXNOdWxsT3JVbmRlZmluZWQoZGF0YUNvcHlbaV1bbWV0YURhdGFdKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhQ29weVtpXVttZXRhRGF0YV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcHZ0ID0gcmVxdWVzdCAmJiByZXF1ZXN0W3B2dERhdGFdO1xuICAgICAgICAgICAgdmFyIGVtcHR5QW5kQmF0Y2ggPSB0aGlzLnByb2Nlc3NCYXRjaFJlc3BvbnNlKGRhdGEsIHF1ZXJ5LCB4aHIsIHJlcXVlc3QsIGNoYW5nZXMpO1xuICAgICAgICAgICAgaWYgKGVtcHR5QW5kQmF0Y2gpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW1wdHlBbmRCYXRjaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB2ZXJzaW9uQ2hlY2sgPSB4aHIgJiYgcmVxdWVzdC5nZXRSZXNwb25zZUhlYWRlcignRGF0YVNlcnZpY2VWZXJzaW9uJyk7XG4gICAgICAgICAgICB2YXIgY291bnQgPSBudWxsO1xuICAgICAgICAgICAgdmFyIHZlcnNpb24gPSAodmVyc2lvbkNoZWNrICYmIHBhcnNlSW50KHZlcnNpb25DaGVjaywgMTApKSB8fCAyO1xuICAgICAgICAgICAgaWYgKHF1ZXJ5ICYmIHF1ZXJ5LnJlcXVpcmVzQ291bnRzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9EYXRhQ291bnQgPSAnX19jb3VudCc7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGFbb0RhdGFDb3VudF0gfHwgZGF0YVsnb2RhdGEuY291bnQnXSkge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IGRhdGFbb0RhdGFDb3VudF0gfHwgZGF0YVsnb2RhdGEuY291bnQnXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGF0YVtvRGF0YUNvdW50XSB8fCBkYXRhWydvZGF0YS5jb3VudCddKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gZGF0YVtvRGF0YUNvdW50XSB8fCBkYXRhWydvZGF0YS5jb3VudCddO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2ZXJzaW9uID09PSAzICYmIGRhdGEudmFsdWUpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS52YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLmQpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZlcnNpb24gPCAzICYmIGRhdGEucmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYXJncyA9IHt9O1xuICAgICAgICAgICAgYXJncy5jb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgYXJncy5yZXN1bHQgPSBkYXRhO1xuICAgICAgICAgICAgdGhpcy5nZXRBZ2dyZWdhdGVSZXN1bHQocHZ0LCBkYXRhLCBhcmdzKTtcbiAgICAgICAgICAgIHJldHVybiB1dGlsXzEuRGF0YVV0aWwuaXNOdWxsKGNvdW50KSA/IGFyZ3MucmVzdWx0IDogeyByZXN1bHQ6IGFyZ3MucmVzdWx0LCBjb3VudDogYXJncy5jb3VudCwgYWdncmVnYXRlczogYXJncy5hZ2dyZWdhdGVzIH07XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUuY29udmVydFRvUXVlcnlTdHJpbmcgPSBmdW5jdGlvbiAocmVxdWVzdCwgcXVlcnksIGRtKSB7XG4gICAgICAgICAgICB2YXIgcmVzID0gW107XG4gICAgICAgICAgICB2YXIgdGFibGUgPSAndGFibGUnO1xuICAgICAgICAgICAgdmFyIHRhYmxlTmFtZSA9IHJlcXVlc3RbdGFibGVdIHx8ICcnO1xuICAgICAgICAgICAgdmFyIGZvcm1hdCA9ICckZm9ybWF0JztcbiAgICAgICAgICAgIGRlbGV0ZSByZXF1ZXN0W3RhYmxlXTtcbiAgICAgICAgICAgIGlmIChkbS5kYXRhU291cmNlLnJlcXVpcmVzRm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdFtmb3JtYXRdID0gJ2pzb24nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhyZXF1ZXN0KTtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwga2V5c180ID0ga2V5czsgX2kgPCBrZXlzXzQubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb3AgPSBrZXlzXzRbX2ldO1xuICAgICAgICAgICAgICAgIHJlcy5wdXNoKHByb3AgKyAnPScgKyByZXF1ZXN0W3Byb3BdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcyA9IHJlcy5qb2luKCcmJyk7XG4gICAgICAgICAgICBpZiAoZG0uZGF0YVNvdXJjZS51cmwgJiYgZG0uZGF0YVNvdXJjZS51cmwuaW5kZXhPZignPycpICE9PSAtMSAmJiAhdGFibGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXMubGVuZ3RoID8gdGFibGVOYW1lICsgJz8nICsgcmVzIDogdGFibGVOYW1lIHx8ICcnO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChkbSwgZGF0YSwgdGFibGVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVybDogZG0uZGF0YVNvdXJjZS51cmwucmVwbGFjZSgvXFwvKiQvLCB0YWJsZU5hbWUgPyAnLycgKyB0YWJsZU5hbWUgOiAnJyksXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGRtLCBrZXlGaWVsZCwgdmFsdWUsIHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgICAgICB1cmw6IGRtLmRhdGFTb3VyY2UudXJsLnJlcGxhY2UoL1xcLyokLywgdGFibGVOYW1lID8gJy8nICsgdGFibGVOYW1lIDogJycpICsgJygnICsgdmFsdWUgKyAnKSdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRtLCBrZXlGaWVsZCwgdmFsdWUsIHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICB1cmw6IGRtLmRhdGFTb3VyY2UudXJsLnJlcGxhY2UoL1xcLyokLywgdGFibGVOYW1lID8gJy8nICsgdGFibGVOYW1lIDogJycpICsgJygnICsgdmFsdWVba2V5RmllbGRdICsgJyknLFxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHZhbHVlKSxcbiAgICAgICAgICAgICAgICBhY2NlcHQ6IHRoaXMub3B0aW9ucy5hY2NlcHRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUuYmF0Y2hSZXF1ZXN0ID0gZnVuY3Rpb24gKGRtLCBjaGFuZ2VzLCBlKSB7XG4gICAgICAgICAgICB2YXIgaW5pdGlhbEd1aWQgPSBlLmd1aWQgPSB1dGlsXzEuRGF0YVV0aWwuZ2V0R3VpZCh0aGlzLm9wdGlvbnMuYmF0Y2hQcmUpO1xuICAgICAgICAgICAgdmFyIHVybCA9IGRtLmRhdGFTb3VyY2UudXJsLnJlcGxhY2UoL1xcLyokLywgJy8nICsgdGhpcy5vcHRpb25zLmJhdGNoKTtcbiAgICAgICAgICAgIHZhciBhcmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogZS51cmwsXG4gICAgICAgICAgICAgICAga2V5OiBlLmtleSxcbiAgICAgICAgICAgICAgICBjaWQ6IDEsXG4gICAgICAgICAgICAgICAgY1NldDogdXRpbF8xLkRhdGFVdGlsLmdldEd1aWQodGhpcy5vcHRpb25zLmNoYW5nZVNldClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgcmVxID0gJy0tJyArIGluaXRpYWxHdWlkICsgJ1xcbic7XG4gICAgICAgICAgICByZXEgKz0gJ0NvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L21peGVkOyBib3VuZGFyeT0nICsgYXJncy5jU2V0LnJlcGxhY2UoJy0tJywgJycpICsgJ1xcbic7XG4gICAgICAgICAgICB0aGlzLnB2dC5jaGFuZ2VTZXQgPSAwO1xuICAgICAgICAgICAgcmVxICs9IHRoaXMuZ2VuZXJhdGVJbnNlcnRSZXF1ZXN0KGNoYW5nZXMuYWRkZWRSZWNvcmRzLCBhcmdzKTtcbiAgICAgICAgICAgIHJlcSArPSB0aGlzLmdlbmVyYXRlVXBkYXRlUmVxdWVzdChjaGFuZ2VzLmNoYW5nZWRSZWNvcmRzLCBhcmdzKTtcbiAgICAgICAgICAgIHJlcSArPSB0aGlzLmdlbmVyYXRlRGVsZXRlUmVxdWVzdChjaGFuZ2VzLmRlbGV0ZWRSZWNvcmRzLCBhcmdzKTtcbiAgICAgICAgICAgIHJlcSArPSBhcmdzLmNTZXQgKyAnLS1cXG4nO1xuICAgICAgICAgICAgcmVxICs9ICctLScgKyBpbml0aWFsR3VpZCArICctLSc7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnbXVsdGlwYXJ0L21peGVkOyBjaGFyc2V0PVVURi04O2JvdW5kYXJ5PScgKyBpbml0aWFsR3VpZCxcbiAgICAgICAgICAgICAgICBkYXRhOiByZXFcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUuZ2VuZXJhdGVEZWxldGVSZXF1ZXN0ID0gZnVuY3Rpb24gKGFyciwgZSkge1xuICAgICAgICAgICAgaWYgKCFhcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVxID0gJyc7XG4gICAgICAgICAgICB2YXIgc3RhdCA9IHtcbiAgICAgICAgICAgICAgICAnbWV0aG9kJzogJ0RFTEVURSAnLFxuICAgICAgICAgICAgICAgICd1cmwnOiBmdW5jdGlvbiAoZGF0YSwgaSwga2V5KSB7IHJldHVybiAnKCcgKyBkYXRhW2ldW2tleV0gKyAnKSc7IH0sXG4gICAgICAgICAgICAgICAgJ2RhdGEnOiBmdW5jdGlvbiAoZGF0YSwgaSkgeyByZXR1cm4gJyc7IH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXEgPSB0aGlzLmdlbmVyYXRlQm9keUNvbnRlbnQoYXJyLCBlLCBzdGF0KTtcbiAgICAgICAgICAgIHJldHVybiByZXEgKyAnXFxuJztcbiAgICAgICAgfTtcbiAgICAgICAgT0RhdGFBZGFwdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUluc2VydFJlcXVlc3QgPSBmdW5jdGlvbiAoYXJyLCBlKSB7XG4gICAgICAgICAgICBpZiAoIWFycikge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXEgPSAnJztcbiAgICAgICAgICAgIHZhciBzdGF0ID0ge1xuICAgICAgICAgICAgICAgICdtZXRob2QnOiAnUE9TVCAnLFxuICAgICAgICAgICAgICAgICd1cmwnOiBmdW5jdGlvbiAoZGF0YSwgaSwga2V5KSB7IHJldHVybiAnJzsgfSxcbiAgICAgICAgICAgICAgICAnZGF0YSc6IGZ1bmN0aW9uIChkYXRhLCBpKSB7IHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhW2ldKSArICdcXG5cXG4nOyB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVxID0gdGhpcy5nZW5lcmF0ZUJvZHlDb250ZW50KGFyciwgZSwgc3RhdCk7XG4gICAgICAgICAgICByZXR1cm4gcmVxO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YUFkYXB0b3IucHJvdG90eXBlLmdlbmVyYXRlVXBkYXRlUmVxdWVzdCA9IGZ1bmN0aW9uIChhcnIsIGUpIHtcbiAgICAgICAgICAgIGlmICghYXJyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlcSA9ICcnO1xuICAgICAgICAgICAgdmFyIHN0YXQgPSB7XG4gICAgICAgICAgICAgICAgJ21ldGhvZCc6ICdQVVQgJyxcbiAgICAgICAgICAgICAgICAndXJsJzogZnVuY3Rpb24gKGRhdGEsIGksIGtleSkgeyByZXR1cm4gJygnICsgZGF0YVtpXVtrZXldICsgJyknOyB9LFxuICAgICAgICAgICAgICAgICdkYXRhJzogZnVuY3Rpb24gKGRhdGEsIGkpIHsgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGFbaV0pICsgJ1xcblxcbic7IH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXEgPSB0aGlzLmdlbmVyYXRlQm9keUNvbnRlbnQoYXJyLCBlLCBzdGF0KTtcbiAgICAgICAgICAgIHJldHVybiByZXE7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5nZXRGaWVsZCA9IGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJvcC5yZXBsYWNlKC9cXC4vZywgJy8nKTtcbiAgICAgICAgfTtcbiAgICAgICAgT0RhdGFBZGFwdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUJvZHlDb250ZW50ID0gZnVuY3Rpb24gKGFyciwgZSwgc3RhdCkge1xuICAgICAgICAgICAgdmFyIHJlcSA9ICcnO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICByZXEgKz0gJ1xcbicgKyBlLmNTZXQgKyAnXFxuJztcbiAgICAgICAgICAgICAgICByZXEgKz0gdGhpcy5vcHRpb25zLmNoYW5nZVNldENvbnRlbnQgKyAnXFxuXFxuJztcbiAgICAgICAgICAgICAgICByZXEgKz0gc3RhdC5tZXRob2Q7XG4gICAgICAgICAgICAgICAgcmVxICs9IGUudXJsICsgc3RhdC51cmwoYXJyLCBpLCBlLmtleSkgKyAnIEhUVFAvMS4xXFxuJztcbiAgICAgICAgICAgICAgICByZXEgKz0gJ0FjY2VwdDogJyArIHRoaXMub3B0aW9ucy5hY2NlcHQgKyAnXFxuJztcbiAgICAgICAgICAgICAgICByZXEgKz0gJ0NvbnRlbnQtSWQ6ICcgKyB0aGlzLnB2dC5jaGFuZ2VTZXQrKyArICdcXG4nO1xuICAgICAgICAgICAgICAgIHJlcSArPSB0aGlzLm9wdGlvbnMuYmF0Y2hDaGFuZ2VTZXRDb250ZW50VHlwZSArICdcXG5cXG4nO1xuICAgICAgICAgICAgICAgIHJlcSArPSBzdGF0LmRhdGEoYXJyLCBpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXE7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhQWRhcHRvci5wcm90b3R5cGUucHJvY2Vzc0JhdGNoUmVzcG9uc2UgPSBmdW5jdGlvbiAoZGF0YSwgcXVlcnksIHhociwgcmVxdWVzdCwgY2hhbmdlcykge1xuICAgICAgICAgICAgaWYgKHhociAmJiB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ0NvbnRlbnQtVHlwZScpICYmIHhoci5nZXRSZXNwb25zZUhlYWRlcignQ29udGVudC1UeXBlJykuaW5kZXhPZigneG1sJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChxdWVyeS5yZXF1aXJlc0NvdW50cyA/IHsgcmVzdWx0OiBbXSwgY291bnQ6IDAgfSA6IFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0ICYmIHRoaXMub3B0aW9ucy5iYXRjaCAmJiB1dGlsXzEuRGF0YVV0aWwuZW5kc1dpdGgocmVxdWVzdC51cmwsIHRoaXMub3B0aW9ucy5iYXRjaCkgJiYgcmVxdWVzdC50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwb3N0Jykge1xuICAgICAgICAgICAgICAgIHZhciBndWlkID0geGhyLmdldFJlc3BvbnNlSGVhZGVyKCdDb250ZW50LVR5cGUnKTtcbiAgICAgICAgICAgICAgICB2YXIgY0lkeCA9IHZvaWQgMDtcbiAgICAgICAgICAgICAgICB2YXIganNvbk9iaiA9IHZvaWQgMDtcbiAgICAgICAgICAgICAgICBndWlkID0gZ3VpZC5zdWJzdHJpbmcoZ3VpZC5pbmRleE9mKCc9YmF0Y2hyZXNwb25zZScpICsgMSk7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEuc3BsaXQoZ3VpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhWzFdO1xuICAgICAgICAgICAgICAgIHZhciBleFZhbCA9IC8oPzpcXGJDb250ZW50LVR5cGUuK2JvdW5kYXJ5PSkoY2hhbmdlc2V0cmVzcG9uc2UuKykvaS5leGVjKGRhdGEpO1xuICAgICAgICAgICAgICAgIGlmIChleFZhbCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlcGxhY2UoZXhWYWxbMF0sICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGNoYW5nZUd1aWQgPSBleFZhbCA/IGV4VmFsWzFdIDogJyc7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEuc3BsaXQoY2hhbmdlR3VpZCk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IGRhdGEubGVuZ3RoOyBpID4gLTE7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIS9cXGJDb250ZW50LUlEOi9pLnRlc3QoZGF0YVtpXSkgfHwgIS9cXGJIVFRQLisyMDEvLnRlc3QoZGF0YVtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNJZHggPSBwYXJzZUludCgvXFxiQ29udGVudC1JRDogKFxcZCspL2kuZXhlYyhkYXRhW2ldKVsxXSwgMTApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlcy5hZGRlZFJlY29yZHNbY0lkeF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25PYmogPSB1dGlsXzEuRGF0YVV0aWwucGFyc2UucGFyc2VKc29uKC9eXFx7LitcXH0vbS5leGVjKGRhdGFbaV0pWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVqMl9iYXNlXzEuZXh0ZW5kKHt9LCBjaGFuZ2VzLmFkZGVkUmVjb3Jkc1tjSWR4XSwgdGhpcy5wcm9jZXNzUmVzcG9uc2UoanNvbk9iaikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjaGFuZ2VzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBPRGF0YUFkYXB0b3I7XG4gICAgfShVcmxBZGFwdG9yKSk7XG4gICAgZXhwb3J0cy5PRGF0YUFkYXB0b3IgPSBPRGF0YUFkYXB0b3I7XG4gICAgdmFyIE9EYXRhVjRBZGFwdG9yID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKE9EYXRhVjRBZGFwdG9yLCBfc3VwZXIpO1xuICAgICAgICBmdW5jdGlvbiBPRGF0YVY0QWRhcHRvcigpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMub3B0aW9ucyA9IGVqMl9iYXNlXzEuZXh0ZW5kKHt9LCBfdGhpcy5vcHRpb25zLCB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdFR5cGU6ICdnZXQnLFxuICAgICAgICAgICAgICAgIGFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCwgKi8qOyBxPTAuMDEnLFxuICAgICAgICAgICAgICAgIG11bHRpcGFydEFjY2VwdDogJ211bHRpcGFydC9taXhlZCcsXG4gICAgICAgICAgICAgICAgc29ydEJ5OiAnJG9yZGVyYnknLFxuICAgICAgICAgICAgICAgIHNlbGVjdDogJyRzZWxlY3QnLFxuICAgICAgICAgICAgICAgIHNraXA6ICckc2tpcCcsXG4gICAgICAgICAgICAgICAgdGFrZTogJyR0b3AnLFxuICAgICAgICAgICAgICAgIGNvdW50OiAnJGNvdW50JyxcbiAgICAgICAgICAgICAgICBzZWFyY2g6ICckc2VhcmNoJyxcbiAgICAgICAgICAgICAgICB3aGVyZTogJyRmaWx0ZXInLFxuICAgICAgICAgICAgICAgIGV4cGFuZDogJyRleHBhbmQnLFxuICAgICAgICAgICAgICAgIGJhdGNoOiAnJGJhdGNoJyxcbiAgICAgICAgICAgICAgICBjaGFuZ2VTZXQ6ICctLWNoYW5nZXNldF8nLFxuICAgICAgICAgICAgICAgIGJhdGNoUHJlOiAnYmF0Y2hfJyxcbiAgICAgICAgICAgICAgICBjb250ZW50SWQ6ICdDb250ZW50LUlkOiAnLFxuICAgICAgICAgICAgICAgIGJhdGNoQ29udGVudDogJ0NvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L21peGVkOyBib3VuZGFyeT0nLFxuICAgICAgICAgICAgICAgIGNoYW5nZVNldENvbnRlbnQ6ICdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2h0dHBcXG5Db250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiaW5hcnkgJyxcbiAgICAgICAgICAgICAgICBiYXRjaENoYW5nZVNldENvbnRlbnRUeXBlOiAnQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04ICdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG4gICAgICAgIE9EYXRhVjRBZGFwdG9yLnByb3RvdHlwZS5nZXRNb2R1bGVuYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICdPRGF0YVY0QWRhcHRvcic7XG4gICAgICAgIH07XG4gICAgICAgIDtcbiAgICAgICAgT0RhdGFWNEFkYXB0b3IucHJvdG90eXBlLm9uQ291bnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGUgPT09IHRydWUgPyAndHJ1ZScgOiAnJztcbiAgICAgICAgfTtcbiAgICAgICAgT0RhdGFWNEFkYXB0b3IucHJvdG90eXBlLm9uUHJlZGljYXRlID0gZnVuY3Rpb24gKHByZWRpY2F0ZSwgcXVlcnksIHJlcXVpcmVzQ2FzdCkge1xuICAgICAgICAgICAgdmFyIHJldHVyblZhbHVlID0gJyc7XG4gICAgICAgICAgICB2YXIgdmFsID0gcHJlZGljYXRlLnZhbHVlO1xuICAgICAgICAgICAgdmFyIGlzRGF0ZSA9IHZhbCBpbnN0YW5jZW9mIERhdGU7XG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9IF9zdXBlci5wcm90b3R5cGUub25QcmVkaWNhdGUuY2FsbCh0aGlzLCBwcmVkaWNhdGUsIHF1ZXJ5LCByZXF1aXJlc0Nhc3QpO1xuICAgICAgICAgICAgaWYgKGlzRGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmV0dXJuVmFsdWUucmVwbGFjZSgvZGF0ZXRpbWUnKC4qKSckLywgJyQxJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhVjRBZGFwdG9yLnByb3RvdHlwZS5vbkVhY2hTZWFyY2ggPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIHNlYXJjaCA9IHRoaXMucHZ0LnNlYXJjaGVzIHx8IFtdO1xuICAgICAgICAgICAgc2VhcmNoLnB1c2goZS5rZXkpO1xuICAgICAgICAgICAgdGhpcy5wdnQuc2VhcmNoZXMgPSBzZWFyY2g7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhVjRBZGFwdG9yLnByb3RvdHlwZS5vblNlYXJjaCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wdnQuc2VhcmNoZXMuam9pbignIE9SICcpO1xuICAgICAgICB9O1xuICAgICAgICBPRGF0YVY0QWRhcHRvci5wcm90b3R5cGUuYmVmb3JlU2VuZCA9IGZ1bmN0aW9uIChkbSwgcmVxdWVzdCwgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgdGhpcy5vcHRpb25zLmFjY2VwdCk7XG4gICAgICAgIH07XG4gICAgICAgIE9EYXRhVjRBZGFwdG9yLnByb3RvdHlwZS5wcm9jZXNzUmVzcG9uc2UgPSBmdW5jdGlvbiAoZGF0YSwgZHMsIHF1ZXJ5LCB4aHIsIHJlcXVlc3QsIGNoYW5nZXMpIHtcbiAgICAgICAgICAgIHZhciBwdnREYXRhID0gJ3B2dERhdGEnO1xuICAgICAgICAgICAgdmFyIHB2dCA9IHJlcXVlc3QgJiYgcmVxdWVzdFtwdnREYXRhXTtcbiAgICAgICAgICAgIHZhciBlbXB0eUFuZEJhdGNoID0gX3N1cGVyLnByb3RvdHlwZS5wcm9jZXNzQmF0Y2hSZXNwb25zZS5jYWxsKHRoaXMsIGRhdGEsIHF1ZXJ5LCB4aHIsIHJlcXVlc3QsIGNoYW5nZXMpO1xuICAgICAgICAgICAgaWYgKGVtcHR5QW5kQmF0Y2gpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW1wdHlBbmRCYXRjaDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjb3VudCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgZGF0YUNvdW50ID0gJ0BvZGF0YS5jb3VudCc7XG4gICAgICAgICAgICBpZiAocXVlcnkgJiYgcXVlcnkucmVxdWlyZXNDb3VudHMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YUNvdW50IGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSBkYXRhW2RhdGFDb3VudF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0YSA9IGRhdGEudmFsdWU7XG4gICAgICAgICAgICB2YXIgYXJncyA9IHt9O1xuICAgICAgICAgICAgYXJncy5jb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgYXJncy5yZXN1bHQgPSBkYXRhO1xuICAgICAgICAgICAgdGhpcy5nZXRBZ2dyZWdhdGVSZXN1bHQocHZ0LCBkYXRhLCBhcmdzKTtcbiAgICAgICAgICAgIHJldHVybiB1dGlsXzEuRGF0YVV0aWwuaXNOdWxsKGNvdW50KSA/IGFyZ3MucmVzdWx0IDogeyByZXN1bHQ6IGFyZ3MucmVzdWx0LCBjb3VudDogY291bnQsIGFnZ3JlZ2F0ZXM6IGFyZ3MuYWdncmVnYXRlcyB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gT0RhdGFWNEFkYXB0b3I7XG4gICAgfShPRGF0YUFkYXB0b3IpKTtcbiAgICBleHBvcnRzLk9EYXRhVjRBZGFwdG9yID0gT0RhdGFWNEFkYXB0b3I7XG4gICAgdmFyIFdlYkFwaUFkYXB0b3IgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoV2ViQXBpQWRhcHRvciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gV2ViQXBpQWRhcHRvcigpIHtcbiAgICAgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgfVxuICAgICAgICBXZWJBcGlBZGFwdG9yLnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbiAoZG0sIGRhdGEsIHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBkbS5kYXRhU291cmNlLnVybCxcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgV2ViQXBpQWRhcHRvci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGRtLCBrZXlGaWVsZCwgdmFsdWUsIHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgICAgICB1cmw6IGRtLmRhdGFTb3VyY2UudXJsICsgJy8nICsgdmFsdWUsXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkodmFsdWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICBXZWJBcGlBZGFwdG9yLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZG0sIGtleUZpZWxkLCB2YWx1ZSwgdGFibGVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgICAgICAgICAgIHVybDogZG0uZGF0YVNvdXJjZS51cmwsXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkodmFsdWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICBXZWJBcGlBZGFwdG9yLnByb3RvdHlwZS5iZWZvcmVTZW5kID0gZnVuY3Rpb24gKGRtLCByZXF1ZXN0LCBzZXR0aW5ncykge1xuICAgICAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0LCAqLyo7IHE9MC4wMScpO1xuICAgICAgICB9O1xuICAgICAgICBXZWJBcGlBZGFwdG9yLnByb3RvdHlwZS5wcm9jZXNzUmVzcG9uc2UgPSBmdW5jdGlvbiAoZGF0YSwgZHMsIHF1ZXJ5LCB4aHIsIHJlcXVlc3QsIGNoYW5nZXMpIHtcbiAgICAgICAgICAgIHZhciBwdnREYXRhID0gJ3B2dERhdGEnO1xuICAgICAgICAgICAgdmFyIHB2dCA9IHJlcXVlc3QgJiYgcmVxdWVzdFtwdnREYXRhXTtcbiAgICAgICAgICAgIHZhciBjb3VudCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgYXJncyA9IHt9O1xuICAgICAgICAgICAgaWYgKHJlcXVlc3QgJiYgcmVxdWVzdC50eXBlLnRvTG93ZXJDYXNlKCkgIT09ICdwb3N0Jykge1xuICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uQ2hlY2sgPSB4aHIgJiYgcmVxdWVzdC5nZXRSZXNwb25zZUhlYWRlcignRGF0YVNlcnZpY2VWZXJzaW9uJyk7XG4gICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gPSAodmVyc2lvbkNoZWNrICYmIHBhcnNlSW50KHZlcnNpb25DaGVjaywgMTApKSB8fCAyO1xuICAgICAgICAgICAgICAgIGlmIChxdWVyeSAmJiBxdWVyeS5yZXF1aXJlc0NvdW50cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXV0aWxfMS5EYXRhVXRpbC5pc051bGwoZGF0YS5Db3VudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ID0gZGF0YS5Db3VudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbiA8IDMgJiYgZGF0YS5JdGVtcykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5JdGVtcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXJncy5jb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgICAgIGFyZ3MucmVzdWx0ID0gZGF0YTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldEFnZ3JlZ2F0ZVJlc3VsdChwdnQsIGRhdGEsIGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXJncy5yZXN1bHQgPSBhcmdzLnJlc3VsdCB8fCBkYXRhO1xuICAgICAgICAgICAgcmV0dXJuIHV0aWxfMS5EYXRhVXRpbC5pc051bGwoY291bnQpID8gYXJncy5yZXN1bHQgOiB7IHJlc3VsdDogYXJncy5yZXN1bHQsIGNvdW50OiBhcmdzLmNvdW50LCBhZ2dyZWdhdGVzOiBhcmdzLmFnZ3JlZ2F0ZXMgfTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFdlYkFwaUFkYXB0b3I7XG4gICAgfShPRGF0YUFkYXB0b3IpKTtcbiAgICBleHBvcnRzLldlYkFwaUFkYXB0b3IgPSBXZWJBcGlBZGFwdG9yO1xuICAgIHZhciBXZWJNZXRob2RBZGFwdG9yID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICAgICAgX19leHRlbmRzKFdlYk1ldGhvZEFkYXB0b3IsIF9zdXBlcik7XG4gICAgICAgIGZ1bmN0aW9uIFdlYk1ldGhvZEFkYXB0b3IoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgV2ViTWV0aG9kQWRhcHRvci5wcm90b3R5cGUucHJvY2Vzc1F1ZXJ5ID0gZnVuY3Rpb24gKGRtLCBxdWVyeSwgaGllcmFyY2h5RmlsdGVycykge1xuICAgICAgICAgICAgdmFyIG9iaiA9IG5ldyBVcmxBZGFwdG9yKCkucHJvY2Vzc1F1ZXJ5KGRtLCBxdWVyeSwgaGllcmFyY2h5RmlsdGVycyk7XG4gICAgICAgICAgICB2YXIgZ2V0RGF0YSA9ICdkYXRhJztcbiAgICAgICAgICAgIHZhciBkYXRhID0gdXRpbF8xLkRhdGFVdGlsLnBhcnNlLnBhcnNlSnNvbihvYmpbZ2V0RGF0YV0pO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gJ3ZhbHVlJztcbiAgICAgICAgICAgIGlmIChkYXRhLnBhcmFtKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLnBhcmFtLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IGRhdGEucGFyYW1baV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBPYmplY3Qua2V5cyhwYXJhbSlbMF07XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcGFyYW1ba2V5XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRbdmFsdWVdID0gZGF0YTtcbiAgICAgICAgICAgIHZhciBwdnREYXRhID0gJ3B2dERhdGEnO1xuICAgICAgICAgICAgdmFyIHVybCA9ICd1cmwnO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXN1bHQpLFxuICAgICAgICAgICAgICAgIHVybDogb2JqW3VybF0sXG4gICAgICAgICAgICAgICAgcHZ0RGF0YTogb2JqW3B2dERhdGFdLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gV2ViTWV0aG9kQWRhcHRvcjtcbiAgICB9KFVybEFkYXB0b3IpKTtcbiAgICBleHBvcnRzLldlYk1ldGhvZEFkYXB0b3IgPSBXZWJNZXRob2RBZGFwdG9yO1xuICAgIHZhciBSZW1vdGVTYXZlQWRhcHRvciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhSZW1vdGVTYXZlQWRhcHRvciwgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gUmVtb3RlU2F2ZUFkYXB0b3IoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICAgICAgZWoyX2Jhc2VfMS5zZXRWYWx1ZSgnYmVmb3JlU2VuZCcsIFVybEFkYXB0b3IucHJvdG90eXBlLmJlZm9yZVNlbmQsIF90aGlzKTtcbiAgICAgICAgICAgIGVqMl9iYXNlXzEuc2V0VmFsdWUoJ2luc2VydCcsIFVybEFkYXB0b3IucHJvdG90eXBlLmluc2VydCwgX3RoaXMpO1xuICAgICAgICAgICAgZWoyX2Jhc2VfMS5zZXRWYWx1ZSgndXBkYXRlJywgVXJsQWRhcHRvci5wcm90b3R5cGUudXBkYXRlLCBfdGhpcyk7XG4gICAgICAgICAgICBlajJfYmFzZV8xLnNldFZhbHVlKCdyZW1vdmUnLCBVcmxBZGFwdG9yLnByb3RvdHlwZS5yZW1vdmUsIF90aGlzKTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcbiAgICAgICAgfVxuICAgICAgICBSZW1vdGVTYXZlQWRhcHRvci5wcm90b3R5cGUuYmF0Y2hSZXF1ZXN0ID0gZnVuY3Rpb24gKGRtLCBjaGFuZ2VzLCBlKSB7XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaGFuZ2VzLmFkZGVkUmVjb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIEpzb25BZGFwdG9yLnByb3RvdHlwZS5pbnNlcnQoZG0sIGNoYW5nZXMuYWRkZWRSZWNvcmRzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaGFuZ2VzLmNoYW5nZWRSZWNvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgSnNvbkFkYXB0b3IucHJvdG90eXBlLnVwZGF0ZShkbSwgZS5rZXksIGNoYW5nZXMuY2hhbmdlZFJlY29yZHNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNoYW5nZXMuZGVsZXRlZFJlY29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBKc29uQWRhcHRvci5wcm90b3R5cGUucmVtb3ZlKGRtLCBlLmtleSwgY2hhbmdlcy5kZWxldGVkUmVjb3Jkc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IGRtLmRhdGFTb3VyY2UuYmF0Y2hVcmwgfHwgZG0uZGF0YVNvdXJjZS5jcnVkVXJsIHx8IGRtLmRhdGFTb3VyY2UudXJsLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWQ6IGNoYW5nZXMuY2hhbmdlZFJlY29yZHMsXG4gICAgICAgICAgICAgICAgICAgIGFkZGVkOiBjaGFuZ2VzLmFkZGVkUmVjb3JkcyxcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZDogY2hhbmdlcy5kZWxldGVkUmVjb3JkcyxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnYmF0Y2gnLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogZS51cmwsXG4gICAgICAgICAgICAgICAgICAgIGtleTogZS5rZXlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFJlbW90ZVNhdmVBZGFwdG9yO1xuICAgIH0oSnNvbkFkYXB0b3IpKTtcbiAgICBleHBvcnRzLlJlbW90ZVNhdmVBZGFwdG9yID0gUmVtb3RlU2F2ZUFkYXB0b3I7XG4gICAgdmFyIENhY2hlQWRhcHRvciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhDYWNoZUFkYXB0b3IsIF9zdXBlcik7XG4gICAgICAgIGZ1bmN0aW9uIENhY2hlQWRhcHRvcihhZGFwdG9yLCB0aW1lU3RhbXAsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMuaXNDcnVkQWN0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICBfdGhpcy5pc0luc2VydEFjdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFlajJfYmFzZV8xLmlzTnVsbE9yVW5kZWZpbmVkKGFkYXB0b3IpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2FjaGVBZGFwdG9yID0gYWRhcHRvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLnBhZ2VTaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICBfdGhpcy5ndWlkSWQgPSB1dGlsXzEuRGF0YVV0aWwuZ2V0R3VpZCgnY2FjaGVBZGFwdG9yJyk7XG4gICAgICAgICAgICB2YXIgb2JqID0geyBrZXlzOiBbXSwgcmVzdWx0czogW10gfTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShfdGhpcy5ndWlkSWQsIEpTT04uc3RyaW5naWZ5KG9iaikpO1xuICAgICAgICAgICAgdmFyIGd1aWQgPSBfdGhpcy5ndWlkSWQ7XG4gICAgICAgICAgICBpZiAoIWVqMl9iYXNlXzEuaXNOdWxsT3JVbmRlZmluZWQodGltZVN0YW1wKSkge1xuICAgICAgICAgICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSB1dGlsXzEuRGF0YVV0aWwucGFyc2UucGFyc2VKc29uKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShndWlkKSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JEZWwgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLnJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGltZSA9ICtuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RUaW1lID0gK25ldyBEYXRlKGRhdGEucmVzdWx0c1tpXS50aW1lU3RhbXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzW2ldLnRpbWVTdGFtcCA9IGN1cnJlbnRUaW1lIC0gcmVxdWVzdFRpbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFRpbWUgLSByZXF1ZXN0VGltZSA+IHRpbWVTdGFtcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvckRlbC5wdXNoKGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9yRGVsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMuc3BsaWNlKGZvckRlbFtpXSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmtleXMuc3BsaWNlKGZvckRlbFtpXSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGd1aWQpO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oZ3VpZCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgICAgIH0sIHRpbWVTdGFtcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgQ2FjaGVBZGFwdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUtleSA9IGZ1bmN0aW9uICh1cmwsIHF1ZXJ5KSB7XG4gICAgICAgICAgICB2YXIgcXVlcmllcyA9IHRoaXMuZ2V0UXVlcnlSZXF1ZXN0KHF1ZXJ5KTtcbiAgICAgICAgICAgIHZhciBzaW5nbGVzID0gcXVlcnlfMS5RdWVyeS5maWx0ZXJRdWVyeUxpc3RzKHF1ZXJ5LnF1ZXJpZXMsIFsnb25TZWxlY3QnLCAnb25QYWdlJywgJ29uU2tpcCcsICdvblRha2UnLCAnb25SYW5nZSddKTtcbiAgICAgICAgICAgIHZhciBrZXkgPSB1cmw7XG4gICAgICAgICAgICB2YXIgcGFnZSA9ICdvblBhZ2UnO1xuICAgICAgICAgICAgaWYgKHBhZ2UgaW4gc2luZ2xlcykge1xuICAgICAgICAgICAgICAgIGtleSArPSBzaW5nbGVzW3BhZ2VdLnBhZ2VJbmRleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHF1ZXJpZXMuc29ydHMuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAga2V5ICs9IG9iai5lLmRpcmVjdGlvbiArIG9iai5lLmZpZWxkTmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcXVlcmllcy5ncm91cHMuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAga2V5ICs9IG9iai5lLmZpZWxkTmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcXVlcmllcy5zZWFyY2hlcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICBrZXkgKz0gb2JqLmUuc2VhcmNoS2V5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKHZhciBmaWx0ZXIgPSAwOyBmaWx0ZXIgPCBxdWVyaWVzLmZpbHRlcnMubGVuZ3RoOyBmaWx0ZXIrKykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RmlsdGVyID0gcXVlcmllcy5maWx0ZXJzW2ZpbHRlcl07XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWx0ZXIuZS5pc0NvbXBsZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1F1ZXJ5ID0gcXVlcnkuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgbmV3UXVlcnkucXVlcmllcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cnJlbnRGaWx0ZXIuZS5wcmVkaWNhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdRdWVyeS5xdWVyaWVzLnB1c2goeyBmbjogJ29uV2hlcmUnLCBlOiBjdXJyZW50RmlsdGVyLmUucHJlZGljYXRlc1tpXSwgZmlsdGVyOiBxdWVyeS5xdWVyaWVzLmZpbHRlciB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBrZXkgKz0gY3VycmVudEZpbHRlci5lLmNvbmRpdGlvbiArIHRoaXMuZ2VuZXJhdGVLZXkodXJsLCBuZXdRdWVyeSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBrZXkgKz0gY3VycmVudEZpbHRlci5lLmZpZWxkICsgY3VycmVudEZpbHRlci5lLm9wZXJhdG9yICsgY3VycmVudEZpbHRlci5lLnZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBrZXk7XG4gICAgICAgIH07XG4gICAgICAgIENhY2hlQWRhcHRvci5wcm90b3R5cGUucHJvY2Vzc1F1ZXJ5ID0gZnVuY3Rpb24gKGRtLCBxdWVyeSwgaGllcmFyY2h5RmlsdGVycykge1xuICAgICAgICAgICAgdmFyIGtleSA9IHRoaXMuZ2VuZXJhdGVLZXkoZG0uZGF0YVNvdXJjZS51cmwsIHF1ZXJ5KTtcbiAgICAgICAgICAgIHZhciBjYWNoZWRJdGVtcztcbiAgICAgICAgICAgIGNhY2hlZEl0ZW1zID0gdXRpbF8xLkRhdGFVdGlsLnBhcnNlLnBhcnNlSnNvbih3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5ndWlkSWQpKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0gY2FjaGVkSXRlbXMgPyBjYWNoZWRJdGVtcy5yZXN1bHRzW2NhY2hlZEl0ZW1zLmtleXMuaW5kZXhPZihrZXkpXSA6IG51bGw7XG4gICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYmICF0aGlzLmlzQ3J1ZEFjdGlvbiAmJiAhdGhpcy5pc0luc2VydEFjdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pc0NydWRBY3Rpb24gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5pc0luc2VydEFjdGlvbiA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZUFkYXB0b3IucHJvY2Vzc1F1ZXJ5LmFwcGx5KHRoaXMuY2FjaGVBZGFwdG9yLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpO1xuICAgICAgICB9O1xuICAgICAgICBDYWNoZUFkYXB0b3IucHJvdG90eXBlLnByb2Nlc3NSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhLCBkcywgcXVlcnksIHhociwgcmVxdWVzdCwgY2hhbmdlcykge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbnNlcnRBY3Rpb24gfHwgKHJlcXVlc3QgJiYgdGhpcy5jYWNoZUFkYXB0b3Iub3B0aW9ucy5iYXRjaCAmJlxuICAgICAgICAgICAgICAgIHV0aWxfMS5EYXRhVXRpbC5lbmRzV2l0aChyZXF1ZXN0LnVybCwgdGhpcy5jYWNoZUFkYXB0b3Iub3B0aW9ucy5iYXRjaCkgJiYgcmVxdWVzdC50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwb3N0JykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZUFkYXB0b3IucHJvY2Vzc1Jlc3BvbnNlKGRhdGEsIGRzLCBxdWVyeSwgeGhyLCByZXF1ZXN0LCBjaGFuZ2VzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLmNhY2hlQWRhcHRvci5wcm9jZXNzUmVzcG9uc2UuYXBwbHkodGhpcy5jYWNoZUFkYXB0b3IsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSk7XG4gICAgICAgICAgICB2YXIga2V5ID0gcXVlcnkgPyB0aGlzLmdlbmVyYXRlS2V5KGRzLmRhdGFTb3VyY2UudXJsLCBxdWVyeSkgOiBkcy5kYXRhU291cmNlLnVybDtcbiAgICAgICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgICAgIG9iaiA9IHV0aWxfMS5EYXRhVXRpbC5wYXJzZS5wYXJzZUpzb24od2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuZ3VpZElkKSk7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSBvYmoua2V5cy5pbmRleE9mKGtleSk7XG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgb2JqLnJlc3VsdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICBvYmoua2V5cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqLnJlc3VsdHNbb2JqLmtleXMucHVzaChrZXkpIC0gMV0gPSB7IGtleXM6IGtleSwgcmVzdWx0OiBkYXRhLnJlc3VsdCwgdGltZVN0YW1wOiBuZXcgRGF0ZSgpLCBjb3VudDogZGF0YS5jb3VudCB9O1xuICAgICAgICAgICAgd2hpbGUgKG9iai5yZXN1bHRzLmxlbmd0aCA+IHRoaXMucGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICBvYmoucmVzdWx0cy5zcGxpY2UoMCwgMSk7XG4gICAgICAgICAgICAgICAgb2JqLmtleXMuc3BsaWNlKDAsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMuZ3VpZElkLCBKU09OLnN0cmluZ2lmeShvYmopKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9O1xuICAgICAgICBDYWNoZUFkYXB0b3IucHJvdG90eXBlLmJlZm9yZVNlbmQgPSBmdW5jdGlvbiAoZG0sIHJlcXVlc3QsIHNldHRpbmdzKSB7XG4gICAgICAgICAgICBpZiAodXRpbF8xLkRhdGFVdGlsLmVuZHNXaXRoKHNldHRpbmdzLnVybCwgdGhpcy5jYWNoZUFkYXB0b3Iub3B0aW9ucy5iYXRjaCkgJiYgc2V0dGluZ3MudHlwZS50b0xvd2VyQ2FzZSgpID09PSAncG9zdCcpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsIHRoaXMuY2FjaGVBZGFwdG9yLm9wdGlvbnMubXVsdGlwYXJ0QWNjZXB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZG0uZGF0YVNvdXJjZS5jcm9zc0RvbWFpbikge1xuICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgdGhpcy5jYWNoZUFkYXB0b3Iub3B0aW9ucy5hY2NlcHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBDYWNoZUFkYXB0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChkbSwga2V5RmllbGQsIHZhbHVlLCB0YWJsZU5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuaXNDcnVkQWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhY2hlQWRhcHRvci51cGRhdGUoZG0sIGtleUZpZWxkLCB2YWx1ZSwgdGFibGVOYW1lKTtcbiAgICAgICAgfTtcbiAgICAgICAgQ2FjaGVBZGFwdG9yLnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbiAoZG0sIGRhdGEsIHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgdGhpcy5pc0luc2VydEFjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZUFkYXB0b3IuaW5zZXJ0KGRtLCBkYXRhLCB0YWJsZU5hbWUpO1xuICAgICAgICB9O1xuICAgICAgICBDYWNoZUFkYXB0b3IucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChkbSwga2V5RmllbGQsIHZhbHVlLCB0YWJsZU5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuaXNDcnVkQWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhY2hlQWRhcHRvci5yZW1vdmUoZG0sIGtleUZpZWxkLCB2YWx1ZSwgdGFibGVOYW1lKTtcbiAgICAgICAgfTtcbiAgICAgICAgQ2FjaGVBZGFwdG9yLnByb3RvdHlwZS5iYXRjaFJlcXVlc3QgPSBmdW5jdGlvbiAoZG0sIGNoYW5nZXMsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhY2hlQWRhcHRvci5iYXRjaFJlcXVlc3QoZG0sIGNoYW5nZXMsIGUpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gQ2FjaGVBZGFwdG9yO1xuICAgIH0oVXJsQWRhcHRvcikpO1xuICAgIGV4cG9ydHMuQ2FjaGVBZGFwdG9yID0gQ2FjaGVBZGFwdG9yO1xufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9hZGFwdG9ycy5qc1xuLy8gbW9kdWxlIGlkID0gNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9"]}