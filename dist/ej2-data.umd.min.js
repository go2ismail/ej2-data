/*!
*  filename: ej2-data.umd.min.js
*  version : 15.4.23
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base"],t):t(e.ej={},e.ej2Base)}(this,function(e,t){"use strict";var r=function(){function e(e){return this.subQuery=null,this.isChild=!1,this.queries=[],this.key="",this.fKey="","string"==typeof e?this.fromTable=e:e&&e instanceof Array&&(this.lookups=e),this.expands=[],this.sortedColumns=[],this.groupedColumns=[],this.subQuery=null,this.isChild=!1,this.params=[],this}return e.prototype.setKey=function(e){return this.key=e,this},e.prototype.using=function(e){return this.dataManager=e,this},e.prototype.execute=function(e,t,r,n){return(e=e||this.dataManager)?e.executeQuery(this,t,r,n):s.throwError('Query - execute() : dataManager needs to be is set using "using" function or should be passed as argument')},e.prototype.executeLocal=function(e){return(e=e||this.dataManager)?e.executeLocal(this):s.throwError('Query - executeLocal() : dataManager needs to be is set using "using" function or should be passed as argument')},e.prototype.clone=function(){var t=new e;return t.queries=this.queries.slice(0),t.key=this.key,t.isChild=this.isChild,t.dataManager=this.dataManager,t.fromTable=this.fromTable,t.params=this.params.slice(0),t.expands=this.expands.slice(0),t.sortedColumns=this.sortedColumns.slice(0),t.groupedColumns=this.groupedColumns.slice(0),t.subQuerySelector=this.subQuerySelector,t.subQuery=this.subQuery,t.fKey=this.fKey,t.isCountRequired=this.isCountRequired,t},e.prototype.from=function(e){return this.fromTable=e,this},e.prototype.addParams=function(e,t){return"function"==typeof t?this.params.push({key:e,fn:t}):this.params.push({key:e,value:t}),this},e.prototype.expand=function(e){return this.expands="string"==typeof e?[].slice.call([e],0):e.slice(0),this},e.prototype.where=function(e,t,r,o){t=t?t.toLowerCase():null;var s=null;return"string"==typeof e?s=new n(e,t,r,o):e instanceof n&&(s=e),this.queries.push({fn:"onWhere",e:s}),this},e.prototype.search=function(e,t,r,n){"string"==typeof t&&(t=[t]),r=r||"contains";var o=s.fnOperators[r];return this.queries.push({fn:"onSearch",e:{fieldNames:t,operator:r,searchKey:e,ignoreCase:n,comparer:o}}),this},e.prototype.sortBy=function(t,r,n){var o,a,i="ascending";if("string"==typeof t&&s.endsWith(t.toLowerCase()," desc")&&(t=t.replace(/ desc$/i,""),r="descending"),r&&"string"!=typeof r||(i=r?r.toLowerCase():"ascending",r=s.fnSort(r)),n){o=e.filterQueries(this.queries,"onSortBy");for(var u=0;u<o.length;u++)if("string"==typeof(a=o[u].e.fieldName)){if(a===t)return this}else if(a instanceof Array)for(var c=0;c<a.length;c++)if(a[c]===t||t.toLowerCase()===a[c]+" desc")return this}return this.queries.push({fn:"onSortBy",e:{fieldName:t,comparer:r,direction:i}}),this},e.prototype.sortByDesc=function(e){return this.sortBy(e,"descending")},e.prototype.group=function(e,t,r){return this.sortBy(e,null,!0),this.queries.push({fn:"onGroup",e:{fieldName:e,comparer:t||null,format:r||null}}),this},e.prototype.page=function(e,t){return this.queries.push({fn:"onPage",e:{pageIndex:e,pageSize:t}}),this},e.prototype.range=function(e,t){return this.queries.push({fn:"onRange",e:{start:e,end:t}}),this},e.prototype.take=function(e){return this.queries.push({fn:"onTake",e:{nos:e}}),this},e.prototype.skip=function(e){return this.queries.push({fn:"onSkip",e:{nos:e}}),this},e.prototype.select=function(e){return"string"==typeof e&&(e=[].slice.call([e],0)),this.queries.push({fn:"onSelect",e:{fieldNames:e}}),this},e.prototype.hierarchy=function(e,t){return this.subQuerySelector=t,this.subQuery=e,this},e.prototype.foreignKey=function(e){return this.fKey=e,this},e.prototype.requiresCount=function(){return this.isCountRequired=!0,this},e.prototype.aggregate=function(e,t){return this.queries.push({fn:"onAggregates",e:{field:t,type:e}}),this},e.filterQueries=function(e,t){return e.filter(function(e){return e.fn===t})},e.filterQueryLists=function(e,t){for(var r=e.filter(function(e){return-1!==t.indexOf(e.fn)}),n={},o=0;o<r.length;o++)n[r[o].fn]||(n[r[o].fn]=r[o].e);return n},e}(),n=function(){function e(t,r,n,o){return void 0===o&&(o=!1),this.isComplex=!1,"string"==typeof t?(this.field=t,this.operator=r.toLowerCase(),this.value=n,this.ignoreCase=o,this.isComplex=!1,this.comparer=s.fnOperators.processOperator(this.operator)):(t instanceof e&&n instanceof e||n instanceof Array)&&(this.isComplex=!0,this.condition=r.toLowerCase(),this.predicates=[t],n instanceof Array?[].push.apply(this.predicates,n):this.predicates.push(n)),this}return e.and=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.combinePredicates([].slice.call(t,0),"and")},e.prototype.and=function(t,r,n,o){return e.combine(this,t,r,n,"and",o)},e.or=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.combinePredicates([].slice.call(t,0),"or")},e.prototype.or=function(t,r,n,o){return e.combine(this,t,r,n,"or",o)},e.fromJson=function(e){if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t.push(this.fromJSONData(e[r]));return t}var o=e;return this.fromJSONData(o)},e.prototype.validate=function(e){var t,r,n=this.predicates?this.predicates:[];if(!this.isComplex&&this.comparer)return this.comparer.call(this,s.getObject(this.field,e),this.value,this.ignoreCase);t="and"===this.condition;for(var o=0;o<n.length;o++)if(r=n[o].validate(e),t){if(!r)return!1}else if(r)return!0;return t},e.prototype.toJson=function(){var e,t;if(this.isComplex){e=[],t=this.predicates;for(var r=0;r<t.length;r++)e.push(t[r].toJson())}return{isComplex:this.isComplex,field:this.field,operator:this.operator,value:this.value,ignoreCase:this.ignoreCase,condition:this.condition,predicates:e}},e.combinePredicates=function(t,r){if(1===t.length){if(!(t[0]instanceof Array))return t[0];t=t[0]}return new e(t[0],r,t.slice(1))},e.combine=function(t,r,n,o,a,i){return r instanceof e?e[a](t,r):"string"==typeof r?e[a](t,new e(r,n,o,i)):s.throwError("Predicate - "+a+" : invalid arguments")},e.fromJSONData=function(t){for(var r=t.predicates||[],n=r.length,o=[],s=0;s<n;s++)o.push(this.fromJSONData(r[s]));return t.isComplex?new e(o[0],t.condition,o.slice(1)):new e(t.field,t.operator,t.value,t.ignoreCase)},e}(),o={GroupGuid:"{271bbba0-1ee7}"},s=function(){function e(){}return e.getValue=function(e,t){return"function"==typeof e?e.call(t||{}):e},e.endsWith=function(e,t){return e.slice(-t.length)===t},e.startsWith=function(e,t){return e.slice(0,t.length)===t},e.fnSort=function(e){return"ascending"===(e=e?e.toLowerCase():"ascending")?this.fnAscending:this.fnDescending},e.fnAscending=function(e,t){return null===t||void 0===t?-1:"string"==typeof e?e.localeCompare(t):null===e||void 0===e?1:e-t},e.fnDescending=function(e,t){return null===t||void 0===t?1:"string"==typeof e?-1*e.localeCompare(t):null===e||void 0===e?-1:t-e},e.extractFields=function(e,t){var r={};if(1===t.length)return this.getObject(t[0],e);for(var n=0;n<t.length;n++)r[t[n].replace(".","_")]=this.getObject(t[n],e);return r},e.select=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(this.extractFields(e[n],t));return r},e.group=function(r,n,s,a,i,u){a=a||1;var c=r;if(c.GroupGuid===o.GroupGuid){for(var p=function(e){if(t.isNullOrUndefined(i))c[e].items=l.group(c[e].items,n,s,c.level+1,null,u),c[e].count=c[e].items.length;else{var r=-1,o=i.filter(function(t){return t.key===c[e].key});r=i.indexOf(o[0]),c[e].items=l.group(c[e].items,n,s,c.level+1,i[r].items,u),c[e].count=i[r].count}},l=this,d=0;d<c.length;d++)p(d);return c.childLevels+=1,c}var h={},f=[];f.GroupGuid=o.GroupGuid,f.level=a,f.childLevels=0,f.records=c;for(var g=function(e){var r=y.getVal(c,e,n);if(t.isNullOrUndefined(u)||(r=u(r,n)),!h[r]&&(h[r]={key:r,count:0,items:[],aggregates:{},field:n},f.push(h[r]),!t.isNullOrUndefined(i))){var o=i.filter(function(e){return e.key===h[r].key});h[r].count=o[0].count}h[r].count=t.isNullOrUndefined(i)?h[r].count+=1:h[r].count,h[r].items.push(c[e])},y=this,v=0;v<c.length;v++)g(v);if(s&&s.length){var m=function(r){for(var n={},o=void 0,a=s,u=0;u<s.length;u++)if(o=e.aggregates[s[u].type],t.isNullOrUndefined(i))o&&(n[a[u].field+" - "+a[u].type]=o(f[r].items,a[u].field));else{var c=i.filter(function(e){return e.key===f[r].key});o&&(n[a[u].field+" - "+a[u].type]=o(c[0].items,a[u].field))}f[r].aggregates=n};for(v=0;v<f.length;v++)m(v)}return f},e.buildHierarchy=function(e,t,r,n,o){var s,a={};for(n.result&&(n=n.result),n.GroupGuid&&this.throwError("DataManager: Do not have support Grouping in hierarchy"),s=0;s<n.length;s++){(a[i=this.getObject(e,n[s])]||(a[i]=[])).push(n[s])}for(s=0;s<r.length;s++){var i=this.getObject(o||e,r[s]);r[s][t]=a[i]}},e.getFieldList=function(e,t,r){if(void 0===r&&(r=""),void 0===t||null===t)return this.getFieldList(e,[],r);for(var n=e,o=0,s=Object.keys(e);o<s.length;o++){var a=s[o];"object"!=typeof n[a]||n[a]instanceof Array?t.push(r+a):this.getFieldList(n[a],t,r+a+".")}return t},e.getObject=function(e,t){if(!e)return t;if(-1===e.indexOf("."))return t[e];for(var r=t,n=e.split("."),o=0;o<n.length&&null!=r;o++)r=r[n[o]];return r},e.sort=function(e,t,r){if(e.length<=1)return e;var n=parseInt((e.length/2).toString(),10),o=e.slice(0,n),s=e.slice(n);return o=this.sort(o,t,r),s=this.sort(s,t,r),this.merge(o,s,t,r)},e.merge=function(e,t,r,n){for(var o,s=[];e.length>0||t.length>0;)o=e.length>0&&t.length>0?n?n(this.getVal(e,0,r),this.getVal(t,0,r))<=0?e:t:e[0][r]<e[0][r]?e:t:e.length>0?e:t,s.push(o.shift());return s},e.getVal=function(e,t,r){return r?this.getObject(r,e[t]):e[t]},e.toLowerCase=function(e){return e?"string"==typeof e?e.toLowerCase():e.toString():0===e||!1===e?e.toString():""},e.callAdaptorFunction=function(e,t,r,n){if(t in e){var o=e[t](r,n);this.fnOperators.isnull(o)||(r=o)}return r},e.isPlainObject=function(e){return!!e&&e.constructor===Object},e.isCors=function(){var e=null;try{e=new window.XMLHttpRequest}catch(e){}return!!e&&"withCredentials"in e},e.getGuid=function(e){var t;return(e||"")+"00000000-0000-4000-0000-000000000000".replace(/0/g,function(e,r){if("crypto"in window&&"getRandomValues"in crypto){var n=new Uint8Array(1);window.crypto.getRandomValues(n),t=n[0]%16|0}else t=16*Math.random()|0;return"0123456789abcdef"[19===r?3&t|8:t]})},e.isNull=function(e){return void 0===e||null===e},e.getItemFromComparer=function(r,n,o){var s,a,i,u=0,c="string"==typeof e.getVal(r,0,n);if(r.length)for(;t.isNullOrUndefined(s)&&u<r.length;)s=e.getVal(r,u,n),i=r[u++];for(;u<r.length;u++)a=e.getVal(r,u,n),t.isNullOrUndefined(a)||(c&&(s=+s,a=+a),o(s,a)>0&&(s=a,i=r[u]));return i},e.distinct=function(r,n,o){o=!t.isNullOrUndefined(o)&&o;var s,a=[],i={};return r.forEach(function(t,u){(s=e.getVal(r,u,n))in i||(a.push(o?r[u]:s),i[s]=1)}),a},e.serverTimezoneOffset=0,e.throwError=function(e){try{throw new Error(e)}catch(e){throw e.message+"\n"+e.stack}},e.aggregates={sum:function(t,r){for(var n,o=0,s="number"!=typeof e.getVal(t,0,r),a=0;a<t.length;a++)n=e.getVal(t,a,r),isNaN(n)||null===n||(s&&(n=+n),o+=n);return o},average:function(t,r){return e.aggregates.sum(t,r)/t.length},min:function(t,r){var n;return"function"==typeof r&&(n=r,r=null),e.getObject(r,e.getItemFromComparer(t,r,n||e.fnAscending))},max:function(t,r){var n;return"function"==typeof r&&(n=r,r=null),e.getObject(r,e.getItemFromComparer(t,r,n||e.fnDescending))},truecount:function(e,t){return new y(e).executeLocal((new r).where(t,"equal",!0,!0)).length},falsecount:function(e,t){return new y(e).executeLocal((new r).where(t,"equal",!1,!0)).length},count:function(e,t){return e.length}},e.operatorSymbols={"<":"lessthan",">":"greaterthan","<=":"lessthanorequal",">=":"greaterthanorequal","==":"equal","!=":"notequal","*=":"contains","$=":"endswith","^=":"startswith"},e.odBiOperator={"<":" lt ",">":" gt ","<=":" le ",">=":" ge ","==":" eq ","!=":" ne ",lessthan:" lt ",lessthanorequal:" le ",greaterthan:" gt ",greaterthanorequal:" ge ",equal:" eq ",notequal:" ne "},e.odUniOperator={"$=":"endswith","^=":"startswith","*=":"substringof",endswith:"endswith",startswith:"startswith",contains:"substringof"},e.odv4UniOperator={"$=":"endswith","^=":"startswith","*=":"contains",endswith:"endswith",startswith:"startswith",contains:"contains"},e.fnOperators={equal:function(t,r,n){return n?e.toLowerCase(t)===e.toLowerCase(r):t===r},notequal:function(t,r,n){return!e.fnOperators.equal(t,r,n)},lessthan:function(t,r,n){return n?e.toLowerCase(t)<e.toLowerCase(r):t<r},greaterthan:function(t,r,n){return n?e.toLowerCase(t)>e.toLowerCase(r):t>r},lessthanorequal:function(t,r,n){return n?e.toLowerCase(t)<=e.toLowerCase(r):t<=r},greaterthanorequal:function(t,r,n){return n?e.toLowerCase(t)>=e.toLowerCase(r):t>=r},contains:function(r,n,o){return o?!t.isNullOrUndefined(r)&&!t.isNullOrUndefined(n)&&-1!==e.toLowerCase(r).indexOf(e.toLowerCase(n)):!t.isNullOrUndefined(r)&&!t.isNullOrUndefined(n)&&-1!==r.toString().indexOf(n)},notnull:function(e){return null!==e},isnull:function(e){return null===e},startswith:function(t,r,n){return n?t&&r&&e.startsWith(t.toLowerCase(),r.toLowerCase()):t&&r&&e.startsWith(t,r)},endswith:function(t,r,n){return n?t&&r&&e.endsWith(t.toLowerCase(),r.toLowerCase()):t&&r&&e.endsWith(t,r)},processSymbols:function(t){var r=e.operatorSymbols[t];if(r){return e.fnOperators[r]}return e.throwError("Query - Process Operator : Invalid operator")},processOperator:function(t){var r=e.fnOperators[t];return r||e.fnOperators.processSymbols(t)}},e.parse={parseJson:function(t){return"string"==typeof t?t=JSON.parse(t,e.parse.jsonReviver):t instanceof Array?e.parse.iterateAndReviveArray(t):"object"==typeof t&&e.parse.iterateAndReviveJson(t),t},iterateAndReviveArray:function(t){for(var r=0;r<t.length;r++)"object"==typeof t[r]?e.parse.iterateAndReviveJson(t[r]):"string"!=typeof t[r]||/^[\s]*\[|^[\s]*\{|\"/g.test(t[r])?t[r]=e.parse.parseJson(t[r]):t[r]=e.parse.jsonReviver("",t[r])},iterateAndReviveJson:function(t){for(var r,n=0,o=Object.keys(t);n<o.length;n++){var s=o[n];e.startsWith(s,"__")||("object"==typeof(r=t[s])?r instanceof Array?e.parse.iterateAndReviveArray(r):r&&e.parse.iterateAndReviveJson(r):t[s]=e.parse.jsonReviver(t[s],r))}},jsonReviver:function(t,r){var n=r;if("string"==typeof r){var o=/^\/Date\(([+-]?[0-9]+)([+-][0-9]{4})?\)\/$/.exec(r);if(o)return e.parse.jsonReplacer({value:new Date(parseInt(o[1],10))},!1).value;if(/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*){1})([zZ]|([+\-])(\d\d):?(\d\d))?$/.test(r)){var s=n.split(/[^0-9]/);r=e.parse.jsonReplacer({value:new Date(parseInt(s[0],10),parseInt(s[1],10)-1,parseInt(s[2],10),parseInt(s[3],10),parseInt(s[4],10),parseInt(s[5],10))},!1).value}}return r},isJson:function(t){return"string"==typeof t[0]?t:e.parse.parseJson(t)},isGuid:function(e){return null!=/[A-Fa-f0-9]{8}(?:-[A-Fa-f0-9]{4}){3}-[A-Fa-f0-9]{12}/i.exec(e)},replacer:function(t,r){return e.isPlainObject(t)?e.parse.jsonReplacer(t,r):t instanceof Array?e.parse.arrayReplacer(t):t instanceof Date?e.parse.jsonReplacer({val:t},r).val:t},jsonReplacer:function(t,r){void 0===r&&(r=!0);for(var n,o=0,s=Object.keys(t);o<s.length;o++){var a=s[o];if((n=t[a])instanceof Date){var i=+n-6e4*n.getTimezoneOffset();t[a]=new Date(i-36e5*e.serverTimezoneOffset),r&&(t[a]=t[a].toJSON())}}return t},arrayReplacer:function(t){for(var r=0;r<t.length;r++)e.isPlainObject(t[r])?t[r]=e.parse.jsonReplacer(t[r]):t[r]instanceof Date&&(t[r]=e.parse.jsonReplacer({date:t[r]}).date);return t}},e}(),a=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=function(){function e(t){this.options={from:"table",requestType:"json",sortBy:"sorted",select:"select",skip:"skip",group:"group",take:"take",search:"search",count:"requiresCounts",where:"where",aggregates:"aggregates"},this.type=e,this.dataSource=t,this.pvt={}}return e.prototype.processResponse=function(e,t,r,n){return e},e}(),u=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return a(n,e),n.prototype.processQuery=function(e,t){for(var r,n,o=e.dataSource.json.slice(0),s=o.length,a=!0,i={},u=0;u<t.queries.length;u++)r=this[(n=t.queries[u]).fn].call(this,o,n.e,t),"onAggregates"===n.fn?i[n.e.field+" - "+n.e.type]=r:o=void 0!==r?r:o,"onPage"!==n.fn&&"onSkip"!==n.fn&&"onTake"!==n.fn&&"onRange"!==n.fn||(a=!1),a&&(s=o.length);return t.isCountRequired&&(o={result:o,count:s,aggregates:i}),o},n.prototype.batchRequest=function(e,t,r){var n;for(n=0;n<t.addedRecords.length;n++)this.insert(e,t.addedRecords[n]);for(n=0;n<t.changedRecords.length;n++)this.update(e,r.key,t.changedRecords[n]);for(n=0;n<t.deletedRecords.length;n++)this.remove(e,r.key,t.deletedRecords[n]);return t},n.prototype.onWhere=function(e,t){return e&&e.length?e.filter(function(e){if(t)return t.validate(e)}):e},n.prototype.onAggregates=function(e,t){var r=s.aggregates[t.type];return e&&r&&0!==e.length?r(e,t.field):null},n.prototype.onSearch=function(e,t){return e&&e.length?(0===t.fieldNames.length&&s.getFieldList(e[0],t.fieldNames),e.filter(function(e){for(var r=0;r<t.fieldNames.length;r++)if(t.comparer.call(e,s.getObject(t.fieldNames[r],e),t.searchKey,t.ignoreCase))return!0;return!1})):e},n.prototype.onSortBy=function(e,t,r){if(!e||!e.length)return e;var n,o=s.getValue(t.fieldName,r);if(!o)return e.sort(t.comparer);if(o instanceof Array){for(var a=(o=o.slice(0)).length-1;a>=0;a--)o[a]&&(n=t.comparer,s.endsWith(o[a]," desc")&&(n=s.fnSort("descending"),o[a]=o[a].replace(" desc","")),e=s.sort(e,o[a],n));return e}return s.sort(e,o,t.comparer)},n.prototype.onGroup=function(e,t,n){if(!e||!e.length)return e;var o=r.filterQueries(n.queries,"onAggregates"),a=[];if(o.length)for(var i=void 0,u=0;u<o.length;u++)i=o[u].e,a.push({type:i.type,field:s.getValue(i.field,n)});return s.group(e,s.getValue(t.fieldName,n),a,null,null,t.comparer)},n.prototype.onPage=function(e,t,r){var n=s.getValue(t.pageSize,r),o=(s.getValue(t.pageIndex,r)-1)*n,a=o+n;return e&&e.length?e.slice(o,a):e},n.prototype.onRange=function(e,t){return e&&e.length?e.slice(s.getValue(t.start),s.getValue(t.end)):e},n.prototype.onTake=function(e,t){return e&&e.length?e.slice(0,s.getValue(t.nos)):e},n.prototype.onSkip=function(e,t){return e&&e.length?e.slice(s.getValue(t.nos)):e},n.prototype.onSelect=function(e,t){return e&&e.length?s.select(e,s.getValue(t.fieldNames)):e},n.prototype.insert=function(e,r,n,o,s){return t.isNullOrUndefined(s)?e.dataSource.json.push(r):e.dataSource.json.splice(s,0,r)},n.prototype.remove=function(e,t,r,n){var o,s=e.dataSource.json;for("object"==typeof r&&(r=r[t]),o=0;o<s.length&&s[o][t]!==r;o++);return o!==s.length?s.splice(o,1):null},n.prototype.update=function(e,r,n,o){var s,a=e.dataSource.json,i=n[r];for(s=0;s<a.length&&a[s][r]!==i;s++);return s<a.length?t.merge(a[s],n):null},n}(i),c=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return a(o,e),o.prototype.processQuery=function(e,t,n){var o,a,i=this.getQueryRequest(t),u=r.filterQueryLists(t.queries,["onSelect","onPage","onSkip","onTake","onRange"]),c=t.params,p=e.dataSource.url,l=null,d=this.options,h={sorts:[],groups:[],filters:[],searches:[],aggregates:[]};"onPage"in u?(o=u.onPage,a=((a=s.getValue(o.pageIndex,t))-1)*(l=s.getValue(o.pageSize,t))):"onRange"in u&&(a=(o=u.onRange).start,l=o.end-o.start);for(var f=0;f<i.sorts.length;f++)o=s.getValue(i.sorts[f].e.fieldName,t),h.sorts.push(s.callAdaptorFunction(this,"onEachSort",{name:o,direction:i.sorts[f].e.direction},t));n&&(o=this.getFiltersFrom(n,t))&&h.filters.push(s.callAdaptorFunction(this,"onEachWhere",o.toJson(),t));for(f=0;f<i.filters.length;f++){h.filters.push(s.callAdaptorFunction(this,"onEachWhere",i.filters[f].e.toJson(),t));for(var g=0,y="object"==typeof h.filters[f]?Object.keys(h.filters[f]):[];g<y.length;g++){var v=y[g];s.isNull(h[v])&&delete h[v]}}for(f=0;f<i.searches.length;f++)o=i.searches[f].e,h.searches.push(s.callAdaptorFunction(this,"onEachSearch",{fields:o.fieldNames,operator:o.operator,key:o.searchKey,ignoreCase:o.ignoreCase},t));for(f=0;f<i.groups.length;f++)h.groups.push(s.getValue(i.groups[f].e.fieldName,t));for(f=0;f<i.aggregates.length;f++)o=i.aggregates[f].e,h.aggregates.push({type:o.type,field:s.getValue(o.field,t)});var m={};this.getRequestQuery(d,t,u,h,m),s.callAdaptorFunction(this,"addParams",{dm:e,query:t,params:c,reqParams:m});for(var S=0,b=Object.keys(m);S<b.length;S++){v=b[S];(s.isNull(m[v])||""===m[v]||0===m[v].length)&&delete m[v]}d.skip in m&&d.take in m||null===l||(m[d.skip]=s.callAdaptorFunction(this,"onSkip",a,t),m[d.take]=s.callAdaptorFunction(this,"onTake",l,t));var R=this.pvt;return this.pvt={},"json"===this.options.requestType?{data:JSON.stringify(m),url:p,pvtData:R,type:"POST",contentType:"application/json; charset=utf-8"}:(o=this.convertToQueryString(m,t,e),o=(-1!==e.dataSource.url.indexOf("?")?"&":"/")+o,{type:"GET",url:o.length?p.replace(/\/*$/,o):p,pvtData:R})},o.prototype.getRequestQuery=function(e,t,r,n,o){var a=o;a[e.from]=t.fromTable,e.expand&&(a[e.expand]=t.expands),a[e.select]="onSelect"in r?s.callAdaptorFunction(this,"onSelect",s.getValue(r.onSelect.fieldNames,t),t):"",a[e.count]=t.isCountRequired?s.callAdaptorFunction(this,"onCount",t.isCountRequired,t):"",a[e.search]=n.searches.length?s.callAdaptorFunction(this,"onSearch",n.searches,t):"",a[e.skip]="onSkip"in r?s.callAdaptorFunction(this,"onSkip",s.getValue(r.onSkip.nos,t),t):"",a[e.take]="onTake"in r?s.callAdaptorFunction(this,"onTake",s.getValue(r.onTake.nos,t),t):"",a[e.where]=n.filters.length||n.searches.length?s.callAdaptorFunction(this,"onWhere",n.filters,t):"",a[e.sortBy]=n.sorts.length?s.callAdaptorFunction(this,"onSortBy",n.sorts,t):"",a[e.group]=n.groups.length?s.callAdaptorFunction(this,"onGroup",n.groups,t):"",a[e.aggregates]=n.aggregates.length?s.callAdaptorFunction(this,"onAggregates",n.aggregates,t):"",a.param=[]},o.prototype.convertToQueryString=function(e,t,r){return""},o.prototype.processResponse=function(e,t,r,n,o,a){var i=o,u=i.pvtData||{},c=e.groupDs;if(n&&n.getResponseHeader("Content-Type")&&-1!==n.getResponseHeader("Content-Type").indexOf("xml"))return r.isCountRequired?{result:[],count:0}:[];var p=JSON.parse(i.data);if(p&&"batch"===p.action&&e.addedRecords)return a.addedRecords=e.addedRecords,a;e.d&&(e=e.d);var l={};return"count"in e&&(l.count=e.count),l.result=e.result?e.result:e,this.getAggregateResult(u,e,l,c),s.isNull(l.count)?l.result:{result:l.result,count:l.count,aggregates:l.aggregates}},o.prototype.onGroup=function(e){return this.pvt.groups=e,e},o.prototype.onAggregates=function(e){this.pvt.aggregates=e},o.prototype.batchRequest=function(e,t,r){return{type:"POST",url:e.dataSource.batchUrl||e.dataSource.crudUrl||e.dataSource.removeUrl||e.dataSource.url,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({changed:t.changedRecords,added:t.addedRecords,deleted:t.deletedRecords,action:"batch",table:r[void 0],key:r[void 0]})}},o.prototype.beforeSend=function(e,t){},o.prototype.insert=function(e,t,r){return{url:e.dataSource.insertUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify({value:t,table:r,action:"insert"})}},o.prototype.remove=function(e,t,r,n){return{type:"POST",url:e.dataSource.removeUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify({key:r,keyColumn:t,table:n,action:"remove"})}},o.prototype.update=function(e,t,r,n){return{type:"POST",url:e.dataSource.updateUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify({value:r,action:"update",keyColumn:t,key:r[t],table:n})}},o.prototype.getFiltersFrom=function(e,t){var r,o=t.fKey,a=o,i=t.key,u=[];"object"!=typeof e[0]&&(a=null);for(var c=0;c<e.length;c++)r="object"==typeof e[0]?s.getObject(i||a,e[c]):e[c],u.push(new n(o,"equal",r));return n.or(u)},o.prototype.getAggregateResult=function(e,r,n,o){var a=r;if(r&&r.result&&(a=r.result),e&&e.aggregates&&e.aggregates.length){var i=e.aggregates,u=void 0,c=a,p={};r.aggregate&&(c=r.aggregate);for(var l=0;l<i.length;l++)(u=s.aggregates[i[l].type])&&(p[i[l].field+" - "+i[l].type]=u(c,i[l].field));n.aggregates=p}if(e&&e.groups&&e.groups.length){var d=e.groups;for(l=0;l<d.length;l++){t.isNullOrUndefined(o)||(o=s.group(o,d[l])),a=s.group(a,d[l],e.aggregates,null,o)}n.result=a}return n},o.prototype.getQueryRequest=function(e){var t={sorts:[],groups:[],filters:[],searches:[],aggregates:[]};return t.sorts=r.filterQueries(e.queries,"onSortBy"),t.groups=r.filterQueries(e.queries,"onGroup"),t.filters=r.filterQueries(e.queries,"onWhere"),t.searches=r.filterQueries(e.queries,"onSearch"),t.aggregates=r.filterQueries(e.queries,"onAggregates"),t},o.prototype.addParams=function(e){var t=e.reqParams;e.params.length&&(t.params={});for(var r=0,n=e.params;r<n.length;r++){var o=n[r];if(t[o.key])throw new Error("Query() - addParams: Custom Param is conflicting other request arguments");t[o.key]=o.value,o.fn&&(t[o.key]=o.fn.call(e.query,o.key,e.query,e.dm)),t.params[o.key]=t[o.key]}},o}(i),p=function(e){function r(){var r=e.call(this)||this;return r.options=t.extend({},r.options,{requestType:"get",accept:"application/json;odata=light;q=1,application/json;odata=verbose;q=0.5",multipartAccept:"multipart/mixed",sortBy:"$orderby",select:"$select",skip:"$skip",take:"$top",count:"$inlinecount",where:"$filter",expand:"$expand",batch:"$batch",changeSet:"--changeset_",batchPre:"batch_",contentId:"Content-Id: ",batchContent:"Content-Type: multipart/mixed; boundary=",changeSetContent:"Content-Type: application/http\nContent-Transfer-Encoding: binary ",batchChangeSetContentType:"Content-Type: application/json; charset=utf-8 "}),r.getModuleName=t.getValue("getModulename",r),r}return a(r,e),r.prototype.onPredicate=function(e,n,o){var a,i,u="",c=e.value,p=typeof c,l=e.field?r.getField(e.field):null;if(c instanceof Date&&(c="datetime'"+s.parse.replacer(c)+"'"),"string"===p&&(c="'"+c+"'",o&&(l="cast("+l+", 'Edm.String')"),s.parse.isGuid(c)&&(i="guid"),e.ignoreCase&&(i||(l="tolower("+l+")"),c=c.toLowerCase())),a=s.odBiOperator[e.operator])return u+=l,u+=a,i&&(u+=i),u+c;if(t.isNullOrUndefined(this.getModuleName)?a=s.odUniOperator[e.operator]:"ODataV4Adaptor"===this.getModuleName()&&(a=s.odv4UniOperator[e.operator]),"substringof"===a){var d=c;c=l,l=d}return u+=a+"(",u+=l+",",i&&(u+=i),u+=c+")"},r.prototype.onComplexPredicate=function(e,t,r){for(var n=[],o=0;o<e.predicates.length;o++)n.push("("+this.onEachWhere(e.predicates[o],t,r)+")");return n.join(" "+e.condition+" ")},r.prototype.onEachWhere=function(e,t,r){return e.isComplex?this.onComplexPredicate(e,t,r):this.onPredicate(e,t,r)},r.prototype.onWhere=function(e){return this.pvt.search&&e.push(this.onEachWhere(this.pvt.search,null,!0)),e.join(" and ")},r.prototype.onEachSearch=function(e){e.fields&&0===e.fields.length&&s.throwError("Query() - Search : oData search requires list of field names to search");for(var t=this.pvt.search||[],r=0;r<e.fields.length;r++)t.push(new n(e.fields[r],e.operator,e.key,e.ignoreCase));this.pvt.search=t},r.prototype.onSearch=function(e){return this.pvt.search=n.or(this.pvt.search),""},r.prototype.onEachSort=function(e){var t=[];if(e.name instanceof Array)for(var n=0;n<e.name.length;n++)t.push(r.getField(e.name[n])+("descending"===e.direction?" desc":""));else t.push(r.getField(e.name)+("descending"===e.direction?" desc":""));return t.join(",")},r.prototype.onSortBy=function(e){return e.reverse().join(",")},r.prototype.onGroup=function(e){return this.pvt.groups=e,[]},r.prototype.onSelect=function(e){for(var t=0;t<e.length;t++)e[t]=r.getField(e[t]);return e.join(",")},r.prototype.onAggregates=function(e){return this.pvt.aggregates=e,""},r.prototype.onCount=function(e){return!0===e?"allpages":""},r.prototype.beforeSend=function(e,t,r){s.endsWith(r.url,this.options.batch)&&"post"===r.type.toLowerCase()?(t.setRequestHeader("Accept",this.options.multipartAccept),t.setRequestHeader("DataServiceVersion","2.0"),t.overrideMimeType("text/plain; charset=x-user-defined")):t.setRequestHeader("Accept",this.options.accept),t.setRequestHeader("DataServiceVersion","2.0"),t.setRequestHeader("MaxDataServiceVersion","2.0")},r.prototype.processResponse=function(e,r,n,o,a,i){if(!t.isNullOrUndefined(e.d)){var u=n&&n.isCountRequired?e.d.results:e.d;if(!t.isNullOrUndefined(u))for(var c=0;c<u.length;c++)t.isNullOrUndefined(u[c].__metadata)||delete u[c].__metadata}var p=a&&a.pvtData,l=this.processBatchResponse(e,n,o,a,i);if(l)return l;var d=o&&a.getResponseHeader("DataServiceVersion"),h=null,f=d&&parseInt(d,10)||2;if(n&&n.isCountRequired){var g="__count";(e[g]||e["odata.count"])&&(h=e[g]||e["odata.count"]),e.d&&(e=e.d),(e[g]||e["odata.count"])&&(h=e[g]||e["odata.count"])}3===f&&e.value&&(e=e.value),e.d&&(e=e.d),f<3&&e.results&&(e=e.results);var y={};return y.count=h,y.result=e,this.getAggregateResult(p,e,y),s.isNull(h)?y.result:{result:y.result,count:y.count,aggregates:y.aggregates}},r.prototype.convertToQueryString=function(e,t,r){var n=[],o=e.table||"";delete e.table,r.dataSource.requiresFormat&&(e.$format="json");for(var s=0,a=Object.keys(e);s<a.length;s++){var i=a[s];n.push(i+"="+e[i])}return n=n.join("&"),r.dataSource.url&&-1!==r.dataSource.url.indexOf("?")&&!o?n:n.length?o+"?"+n:o||""},r.prototype.insert=function(e,t,r){return{url:e.dataSource.url.replace(/\/*$/,r?"/"+r:""),data:JSON.stringify(t)}},r.prototype.remove=function(e,t,r,n){return{type:"DELETE",url:e.dataSource.url.replace(/\/*$/,n?"/"+n:"")+"("+r+")"}},r.prototype.update=function(e,t,r,n){return{type:"PUT",url:e.dataSource.url.replace(/\/*$/,n?"/"+n:"")+"("+r[t]+")",data:JSON.stringify(r),accept:this.options.accept}},r.prototype.batchRequest=function(e,t,r){var n=r.guid=s.getGuid(this.options.batchPre),o=e.dataSource.url.replace(/\/*$/,"/"+this.options.batch),a={url:r.url,key:r.key,cid:1,cSet:s.getGuid(this.options.changeSet)},i="--"+n+"\n";return i+="Content-Type: multipart/mixed; boundary="+a.cSet.replace("--","")+"\n",this.pvt.changeSet=0,i+=this.generateInsertRequest(t.addedRecords,a),i+=this.generateUpdateRequest(t.changedRecords,a),i+=this.generateDeleteRequest(t.deletedRecords,a),i+=a.cSet+"--\n",i+="--"+n+"--",{type:"POST",url:o,dataType:"json",contentType:"multipart/mixed; charset=UTF-8;boundary="+n,data:i}},r.prototype.generateDeleteRequest=function(e,t){if(!e)return"";return this.generateBodyContent(e,t,{method:"DELETE ",url:function(e,t,r){return"("+e[t][r]+")"},data:function(e,t){return""}})+"\n"},r.prototype.generateInsertRequest=function(e,t){if(!e)return"";var r={method:"POST ",url:function(e,t,r){return""},data:function(e,t){return JSON.stringify(e[t])+"\n\n"}};return this.generateBodyContent(e,t,r)},r.prototype.generateUpdateRequest=function(e,t){if(!e)return"";var r={method:"PUT ",url:function(e,t,r){return"("+e[t][r]+")"},data:function(e,t){return JSON.stringify(e[t])+"\n\n"}};return this.generateBodyContent(e,t,r)},r.getField=function(e){return e.replace(/\./g,"/")},r.prototype.generateBodyContent=function(e,t,r){for(var n="",o=0;o<e.length;o++)n+="\n"+t.cSet+"\n",n+=this.options.changeSetContent+"\n\n",n+=r.method,n+=t.url+r.url(e,o,t.key)+" HTTP/1.1\n",n+="Accept: "+this.options.accept+"\n",n+="Content-Id: "+this.pvt.changeSet+++"\n",n+=this.options.batchChangeSetContentType+"\n\n",n+=r.data(e,o);return n},r.prototype.processBatchResponse=function(e,r,n,o,a){if(n&&n.getResponseHeader("Content-Type")&&-1!==n.getResponseHeader("Content-Type").indexOf("xml"))return r.isCountRequired?{result:[],count:0}:[];if(o&&this.options.batch&&s.endsWith(o.url,this.options.batch)&&"post"===o.type.toLowerCase()){var i=n.getResponseHeader("Content-Type"),u=void 0,c=void 0,p=e+"";if(i=i.substring(i.indexOf("=batchresponse")+1),(p=p.split(i)).length<2)return{};p=p[1];var l=/(?:\bContent-Type.+boundary=)(changesetresponse.+)/i.exec(p);l&&p.replace(l[0],"");for(var d=l?l[1]:"",h=(p=p.split(d)).length;h>-1;h--)/\bContent-ID:/i.test(p[h])&&/\bHTTP.+201/.test(p[h])&&(u=parseInt(/\bContent-ID: (\d+)/i.exec(p[h])[1],10),a.addedRecords[u]&&(c=s.parse.parseJson(/^\{.+\}/m.exec(p[h])[0]),t.extend({},a.addedRecords[u],this.processResponse(c))));return a}return null},r}(c),l=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.options=t.extend({},r.options,{requestType:"get",accept:"application/json, text/javascript, */*; q=0.01",multipartAccept:"multipart/mixed",sortBy:"$orderby",select:"$select",skip:"$skip",take:"$top",count:"$count",search:"$search",where:"$filter",expand:"$expand",batch:"$batch",changeSet:"--changeset_",batchPre:"batch_",contentId:"Content-Id: ",batchContent:"Content-Type: multipart/mixed; boundary=",changeSetContent:"Content-Type: application/http\nContent-Transfer-Encoding: binary ",batchChangeSetContentType:"Content-Type: application/json; charset=utf-8 "}),r}return a(r,e),r.prototype.getModulename=function(){return"ODataV4Adaptor"},r.prototype.onCount=function(e){return!0===e?"true":""},r.prototype.onPredicate=function(t,r,n){var o="",s=t.value instanceof Date;return o=e.prototype.onPredicate.call(this,t,r,n),s&&(o=o.replace(/datetime'(.*)'$/,"$1")),o},r.prototype.onEachSearch=function(e){var t=this.pvt.searches||[];t.push(e.key),this.pvt.searches=t},r.prototype.onSearch=function(e){return this.pvt.searches.join(" OR ")},r.prototype.beforeSend=function(e,t,r){t.setRequestHeader("Accept",this.options.accept)},r.prototype.processResponse=function(t,r,n,o,a,i){var u=a&&a.pvtData,c=e.prototype.processBatchResponse.call(this,t,n,o,a,i);if(c)return c;var p=null;n&&n.isCountRequired&&"@odata.count"in t&&(p=t["@odata.count"]),t=t.value;var l={};return l.count=p,l.result=t,this.getAggregateResult(u,t,l),s.isNull(p)?l.result:{result:l.result,count:p,aggregates:l.aggregates}},r}(p),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.insert=function(e,t,r){return{type:"POST",url:e.dataSource.url,data:JSON.stringify(t)}},t.prototype.remove=function(e,t,r,n){return{type:"DELETE",url:e.dataSource.url+"/"+r,data:JSON.stringify(r)}},t.prototype.update=function(e,t,r,n){return{type:"PUT",url:e.dataSource.url,data:JSON.stringify(r)}},t.prototype.beforeSend=function(e,t,r){t.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01")},t.prototype.processResponse=function(e,t,r,n,o,a){var i=o&&o.pvtData,u=null,c={};if(o&&"post"!==o.type.toLowerCase()){var p=n&&o.getResponseHeader("DataServiceVersion"),l=p&&parseInt(p,10)||2;r&&r.isCountRequired&&(s.isNull(e.Count)||(u=e.Count)),l<3&&e.Items&&(e=e.Items),c.count=u,c.result=e,this.getAggregateResult(i,e,c)}return c.result=c.result||e,s.isNull(u)?c.result:{result:c.result,count:c.count,aggregates:c.aggregates}},t}(p),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.processQuery=function(e,t,r){var n=(new c).processQuery(e,t,r),o=s.parse.parseJson(n.data),a={};if(o.param)for(var i=0;i<o.param.length;i++){var u=o.param[i],p=Object.keys(u)[0];a[p]=u[p]}a.value=o;return{data:JSON.stringify(a),url:n.url,pvtData:n.pvtData,type:"POST",contentType:"application/json; charset=utf-8"}},t}(c),f=function(e){function r(){var r=e.call(this)||this;return t.setValue("beforeSend",c.prototype.beforeSend,r),t.setValue("insert",c.prototype.insert,r),t.setValue("update",c.prototype.update,r),t.setValue("remove",c.prototype.remove,r),r}return a(r,e),r.prototype.batchRequest=function(e,t,r){var n;for(n=0;n<t.addedRecords.length;n++)u.prototype.insert(e,t.addedRecords[n]);for(n=0;n<t.changedRecords.length;n++)u.prototype.update(e,r.key,t.changedRecords[n]);for(n=0;n<t.deletedRecords.length;n++)u.prototype.remove(e,r.key,t.deletedRecords[n]);return{type:"POST",url:e.dataSource.batchUrl||e.dataSource.crudUrl||e.dataSource.url,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({changed:t.changedRecords,added:t.addedRecords,deleted:t.deletedRecords,action:"batch",table:r.url,key:r.key})}},r}(u),g=function(e){function n(r,n,o){var a=e.call(this)||this;a.isCrudAction=!1,a.isInsertAction=!1,t.isNullOrUndefined(r)||(a.cacheAdaptor=r),a.pageSize=o,a.guidId=s.getGuid("cacheAdaptor");window.localStorage.setItem(a.guidId,JSON.stringify({keys:[],results:[]}));var i=a.guidId;return t.isNullOrUndefined(n)||setInterval(function(){var e;e=s.parse.parseJson(window.localStorage.getItem(i));for(var t=[],r=0;r<e.results.length;r++){var o=+new Date,a=+new Date(e.results[r].timeStamp);e.results[r].timeStamp=o-a,o-a>n&&t.push(r)}for(r=0;r<t.length;r++)e.results.splice(t[r],1),e.keys.splice(t[r],1);window.localStorage.removeItem(i),window.localStorage.setItem(i,JSON.stringify(e))},n),a}return a(n,e),n.prototype.generateKey=function(e,t){var n=this.getQueryRequest(t),o=r.filterQueryLists(t.queries,["onSelect","onPage","onSkip","onTake","onRange"]),s=e;"onPage"in o&&(s+=o.onPage.pageIndex),n.sorts.forEach(function(e){s+=e.e.direction+e.e.fieldName}),n.groups.forEach(function(e){s+=e.e.fieldName}),n.searches.forEach(function(e){s+=e.e.searchKey});for(var a=0;a<n.filters.length;a++){var i=n.filters[a];if(i.e.isComplex){var u=t.clone();u.queries=[];for(var c=0;c<i.e.predicates.length;c++)u.queries.push({fn:"onWhere",e:i.e.predicates[c],filter:t.queries.filter});s+=i.e.condition+this.generateKey(e,u)}else s+=i.e.field+i.e.operator+i.e.value}return s},n.prototype.processQuery=function(e,t,r){var n,o=this.generateKey(e.dataSource.url,t),a=(n=s.parse.parseJson(window.localStorage.getItem(this.guidId)))?n.results[n.keys.indexOf(o)]:null;return null==a||this.isCrudAction||this.isInsertAction?(this.isCrudAction=null,this.isInsertAction=null,this.cacheAdaptor.processQuery.apply(this.cacheAdaptor,[].slice.call(arguments,0))):a},n.prototype.processResponse=function(e,t,r,n,o,a){if(this.isInsertAction||o&&this.cacheAdaptor.options.batch&&s.endsWith(o.url,this.cacheAdaptor.options.batch)&&"post"===o.type.toLowerCase())return this.cacheAdaptor.processResponse(e,t,r,n,o,a);e=this.cacheAdaptor.processResponse.apply(this.cacheAdaptor,[].slice.call(arguments,0));var i=r?this.generateKey(t.dataSource.url,r):t.dataSource.url,u={},c=(u=s.parse.parseJson(window.localStorage.getItem(this.guidId))).keys.indexOf(i);for(-1!==c&&(u.results.splice(c,1),u.keys.splice(c,1)),u.results[u.keys.push(i)-1]={keys:i,result:e.result,timeStamp:new Date,count:e.count};u.results.length>this.pageSize;)u.results.splice(0,1),u.keys.splice(0,1);return window.localStorage.setItem(this.guidId,JSON.stringify(u)),e},n.prototype.beforeSend=function(e,t,r){s.endsWith(r.url,this.cacheAdaptor.options.batch)&&"post"===r.type.toLowerCase()&&t.setRequestHeader("Accept",this.cacheAdaptor.options.multipartAccept),e.dataSource.crossDomain||t.setRequestHeader("Accept",this.cacheAdaptor.options.accept)},n.prototype.update=function(e,t,r,n){return this.isCrudAction=!0,this.cacheAdaptor.update(e,t,r,n)},n.prototype.insert=function(e,t,r){return this.isInsertAction=!0,this.cacheAdaptor.insert(e,t,r)},n.prototype.remove=function(e,t,r,n){return this.isCrudAction=!0,this.cacheAdaptor.remove(e,t,r,n)},n.prototype.batchRequest=function(e,t,r){return this.cacheAdaptor.batchRequest(e,t,r)},n}(c),y=function(){function e(e,n,o){var a=this;this.dateParse=!0,this.requests=[],e||this.dataSource||(e=[]),o=o||e.adaptor;var i;return e instanceof Array?i={json:e,offline:!0}:"object"==typeof e?(e.json||(e.json=[]),i={url:e.url,insertUrl:e.insertUrl,removeUrl:e.removeUrl,updateUrl:e.updateUrl,crudUrl:e.crudUrl,batchUrl:e.batchUrl,json:e.json,headers:e.headers,accept:e.accept,data:e.data,timeTillExpiration:e.timeTillExpiration,cachingPageSize:e.cachingPageSize,enableCaching:e.enableCaching,requestType:e.requestType,key:e.key,crossDomain:e.crossDomain,jsonp:e.jsonp,dataType:e.dataType,offline:void 0!==e.offline?e.offline:!(e.adaptor instanceof f)&&!e.url,requiresFormat:e.requiresFormat}):s.throwError("DataManager: Invalid arguments"),void 0!==i.requiresFormat||s.isCors()||(i.requiresFormat=!!t.isNullOrUndefined(i.crossDomain)||i.crossDomain),void 0===i.dataType&&(i.dataType="json"),this.dataSource=i,this.defaultQuery=n,i.url&&i.offline&&!i.json.length?(this.isDataAvailable=!1,this.adaptor=o||new p,this.dataSource.offline=!1,this.ready=this.executeQuery(n||new r),this.ready.then(function(e){a.dataSource.offline=!0,a.isDataAvailable=!0,i.json=e.result,a.adaptor=new u})):this.adaptor=i.offline?new u:new p,!i.jsonp&&this.adaptor instanceof p&&(i.jsonp="callback"),this.adaptor=o||this.adaptor,i.enableCaching&&(this.adaptor=new g(this.adaptor,i.timeTillExpiration,i.cachingPageSize)),this}return e.prototype.setDefaultQuery=function(e){return this.defaultQuery=e,this},e.prototype.executeLocal=function(n){this.defaultQuery||n instanceof r||s.throwError("DataManager - executeLocal() : A query is required to execute"),this.dataSource.json||s.throwError("DataManager - executeLocal() : Json data is required to execute"),n=n||this.defaultQuery;var o=this.adaptor.processQuery(this,n);if(n.subQuery){var a=n.subQuery.fromTable,i=n.subQuery.lookups,u=n.isCountRequired?o.result:o;i&&i instanceof Array&&s.buildHierarchy(n.subQuery.fKey,a,u,i,n.subQuery.key);for(var c=0;c<u.length;c++)u[c][a]instanceof Array&&(u[c]=t.extend({},{},u[c]),u[c][a]=this.adaptor.processResponse(n.subQuery.using(new e(u[c][a].slice(0))).executeLocal(),this,n))}return this.adaptor.processResponse(o,this,n)},e.prototype.executeQuery=function(t,n,o,a){var i=this;"function"==typeof t&&(o,o=n,n=t,t=null),t||(t=this.defaultQuery),t instanceof r||s.throwError("DataManager - executeQuery() : A query is required to execute");var u=new v,c={query:t};if(this.dataSource.offline||void 0===this.dataSource.url)e.nextTick(function(){var r=i.executeLocal(t);c=e.getDeferedArgs(t,r,c),u.resolve(c)});else{var p=this.adaptor.processQuery(this,t);this.makeRequest(p,u,c,t)}return u.promise},e.getDeferedArgs=function(e,t,r){return e.isCountRequired?(r.result=t.result,r.count=t.count,r.aggregates=t.aggregates):r.result=t,r},e.nextTick=function(e){(window.setImmediate||window.setTimeout)(e,0)},e.prototype.extendRequest=function(e,r,n){return t.extend({},{type:"GET",dataType:this.dataSource.dataType,crossDomain:this.dataSource.crossDomain,jsonp:this.dataSource.jsonp,cache:!0,processData:!1,onSuccess:r,onFailure:n},e)},e.prototype.makeRequest=function(e,r,n,o){var a=this,i=!!o.subQuerySelector,u=function(e){n.error=e,r.reject(n)},c=function(e,t,o,s,a,i,u){n.xhr=o,n.count=t?parseInt(t.toString(),10):0,n.result=e,n.request=s,n.aggregates=i,n.actual=a,n.virtualSelectRecords=u,r.resolve(n)},p=function(e,t){var r=new v,p={parent:n};o.subQuery.isChild=!0;var l=a.adaptor.processQuery(a,o.subQuery,e?a.adaptor.processResponse(e):t),d=a.makeRequest(l,r,p,o.subQuery);return i||r.then(function(t){e&&(s.buildHierarchy(o.subQuery.fKey,o.subQuery.fromTable,e,t,o.subQuery.key),c(e,t.count,t.xhr))},u),d},l=this.extendRequest(e,function(e,t){-1===t.httpRequest.getResponseHeader("Content-Type").indexOf("xml")&&a.dateParse&&(e=s.parse.parseJson(e));var r=a.adaptor.processResponse(e,a,o,t.httpRequest,t),n=0,u=null,l=e.virtualSelectRecords;o.isCountRequired&&(n=r.count,u=r.aggregates,r=r.result),o.subQuery?i||p(r,t):c(r,n,t.httpRequest,t.type,e,u,l)},u),d=new t.Ajax(l);if(d.beforeSend=function(){a.beforeSend(d.httpRequest,d)},(l=d.send()).catch(function(e){return!0}),this.requests.push(d),i){var h=o.subQuerySelector.call(this,{query:o.subQuery,parent:o});h&&h.length?Promise.all([l,p(null,h)]).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],n=a.adaptor.processResponse(r[0],a,o,a.requests[0].httpRequest,a.requests[0]),u=0;o.isCountRequired&&(u=n.count,n=n.result);var p=a.adaptor.processResponse(r[1],a,o.subQuery,a.requests[1].httpRequest,a.requests[1]);u=0,o.subQuery.isCountRequired&&(u=p.count,p=p.result),s.buildHierarchy(o.subQuery.fKey,o.subQuery.fromTable,n,p,o.subQuery.key),i=!1,c(n,u,a.requests[0].httpRequest)}):i=!1}return l},e.prototype.beforeSend=function(e,t){this.adaptor.beforeSend(this,e,t);for(var r,n=this.dataSource.headers,o=0;n&&o<n.length;o++){r=[];for(var s=0,a=Object.keys(n[o]);s<a.length;s++){var i=a[s];r.push(i),e.setRequestHeader(i,n[o][i])}}},e.prototype.saveChanges=function(e,n,o,s){var a=this;o instanceof r&&(s=o,o=null);var i={url:o,key:n||this.dataSource.key},u=this.adaptor.batchRequest(this,e,i,s);if(this.dataSource.offline)return u;var c=new v,p=new t.Ajax(u);return p.beforeSend=function(){a.beforeSend(p.httpRequest,p)},p.onSuccess=function(t,r){c.resolve(a,[a.adaptor.processResponse(t,a,null,r.httpRequest,r,e)])},p.onFailure=function(e){c.reject([{error:e}])},p.send().catch(function(e){return!0}),c.promise},e.prototype.insert=function(e,t,n,o){e=s.parse.replacer(e),t instanceof r&&(n=t,t=null);var a=this.adaptor.insert(this,e,t,n,o);return this.dataSource.offline?a:this.doAjaxRequest(a)},e.prototype.remove=function(e,t,n,o){"object"==typeof t&&(t=t[e]),n instanceof r&&(o=n,n=null);var s=this.adaptor.remove(this,e,t,n,o);return this.dataSource.offline?s:this.doAjaxRequest(s)},e.prototype.update=function(e,t,n,o){t=s.parse.replacer(t,!this.dataSource.offline),n instanceof r&&(o=n,n=null);var a=this.adaptor.update(this,e,t,n,o);return this.dataSource.offline?a:this.doAjaxRequest(a)},e.prototype.doAjaxRequest=function(e){var r=this,n=new v;e=t.extend({},{type:"POST",contentType:"application/json; charset=utf-8",processData:!1},e);var o=new t.Ajax(e);return o.beforeSend=function(){r.beforeSend(o.httpRequest,o)},o.onSuccess=function(e,t){try{s.parse.parseJson(e)}catch(t){e=[]}e=r.adaptor.processResponse(s.parse.parseJson(e),r,null,t.httpRequest,t),n.resolve(r,[{record:e,dataManager:r}])},o.onFailure=function(e){n.reject([{error:e}])},o.send().catch(function(e){return!0}),n.promise},e}(),v=function(){return function(){var e=this;this.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),this.then=this.promise.then.bind(this.promise),this.catch=this.promise.catch.bind(this.promise)}}();e.DataManager=y,e.Deferred=v,e.Query=r,e.Predicate=n,e.Adaptor=i,e.JsonAdaptor=u,e.UrlAdaptor=c,e.ODataAdaptor=p,e.ODataV4Adaptor=l,e.WebApiAdaptor=d,e.WebMethodAdaptor=h,e.RemoteSaveAdaptor=f,e.CacheAdaptor=g,e.DataUtil=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-data.umd.min.js.map
